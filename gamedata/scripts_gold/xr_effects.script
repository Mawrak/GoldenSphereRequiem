-- ----------------------------------------------------------------------------------------------------
-- Общие функции
-- ----------------------------------------------------------------------------------------------------


local mob = level_object_by_sid(8155)
local disable_npp_earthshaking = true

function disable_ui_elements(actor, npc, p)
    local i, v = 0, 0
    for i, v in pairs(p) do
        if v == "all" then
            db.actor:hide_weapon()
            level.disable_input()
            level.hide_indicators()
            break
        elseif v == "weapon" then
            db.actor:hide_weapon()
        elseif v == "input" then
            level.disable_input()
        elseif v == "hud" then
            level.hide_indicators()
        end
    end
    --printf("xr_effects <disable_ui_elements>")
end

function enable_ui_elements(actor, npc, p)
    local i, v = 0, 0
    for i, v in pairs(p) do
        if v == "all" then
            level.show_indicators()
            level.enable_input()
            db.actor:restore_weapon()
            break
        elseif v == "hud" then
            level.show_indicators()
        elseif v == "input" then
            level.enable_input()
        elseif v == "weapon" then
            db.actor:restore_weapon()
        end
    end
end

function disable_ui(actor, npc)
    db.actor:hide_weapon()
    level.disable_input()
    level.hide_indicators()
    --printf("xr_effects <disable_ui>")
end

function enable_ui(actor, npc)
    level.show_indicators()
    level.enable_input()
    db.actor:restore_weapon()
    --printf("xr_effects <enable_ui>")
end

function run_cam_effector(actor, npc, p)
    if p[1] then
        local loop, num = false, (1000 + math.random(100))
        
        if p[2] and type(p[2]) == "number" and p[2] > 0 then
            num = p[2]
        end

        if p[3] and p[3] == "true" then
            loop = true
        end
        
        --level.add_pp_effector(p[1] .. ".ppe", num, loop)
	    level.add_cam_effector("camera_effects\\" .. p[1] .. ".anm", num, loop, "")	                  
    end
end

function stop_cam_effector(actor, npc, p)
    if p[1] and type(p[1]) == "number" and p[1] > 0 then
        level.remove_cam_effector(p[1])
    end
end

function run_postprocess(actor, npc, p)
    if p[1] then
        local loop, num = false, (2000 + math.random(100))
        
        if p[2] and type(p[2]) == "number" and p[2] > 0 then
            num = p[2]
        end

        if p[3] and p[3] == "true" then
            loop = true
        end
        
        level.add_pp_effector(p[1] .. ".ppe", num, loop)
    end
end

function stop_postprocess(actor, npc, p)
    if p[1] and type(p[1]) == "number" and p[1] > 0 then
        level.remove_pp_effector(p[1])
    end
end

function run_tutorial(actor, npc, p)
	game.start_tutorial(p[1])
end
function run_tutorial_if_newbie(actor, npc, p)
	if has_alife_info("esc_trader_newbie") then
		game.start_tutorial(p[1])
	end
end

function teleport_actor(actor, npc, p)
	local point = patrol(p[1])
	local look = patrol(p[2])
	
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())	
end

-----------------------------------------------------------------------------
local drop_point, drop_object = 0, 0
local function drop_object_item(item)
    drop_object:drop_item_and_teleport(item, drop_point)
end

function drop_actor_inventory(actor, npc, p)
    if p[1] then
        drop_point  = patrol(p[1]):point(0)
        drop_object = actor
        actor:inventory_for_each(drop_object_item)
    end
end

-- FIXME: drop_npc_inventory doesn't work
function drop_npc_inventory(actor, npc, p)
    if p[1] then
        drop_point  = patrol(p[1]):point(0)
        drop_object = npc
        npc:inventory_for_each(drop_object_item)
    end
end

function drop_npc_item(actor, npc, p) -- уронить порписанный предмет
    if p[1] then
        local item = npc:object(p[1])
        if item then
		    npc:drop_item(item)
		end
    end
end

function remove_npc_item(actor, npc, p) -- удалить прописанный пердмет
    if p and p[1] then
        amk.remove_item(npc:object(p[1]))
    end
end

function drop_npc_items(actor, npc, p)
    local item = 0
	for i, v in pairs(p) do
        item = npc:object(v)
        if item then
		    npc:drop_item(item)
        end
    end
end

function give_item(actor, npc, p)
    if p[1] then
        alife():create(p[1], npc:position(), npc:level_vertex_id(), npc:game_vertex_id(), npc:id())
    end
end

function remove_item(actor, npc, p) 
    if p[1] then
        amk.remove_item(db.actor:object(p[1]))
    end
end

function give_items(actor, npc, p)
    local pos, lv_id, gv_id, npc_id = npc:position(), npc:level_vertex_id(), npc:game_vertex_id(), npc:id()
	for i, v in pairs(p) do
        alife():create(v, pos, lv_id, gv_id, npc_id)
    end
end

function give_items_to_actor(actor, npc, p)
    local pos, lv_id, gv_id, npc_id = db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id()
	for i, v in pairs(p) do
        alife():create(v, pos, lv_id, gv_id, npc_id)
    end
end

function respawner_spawn(actor, npc, p)
    if p[1] then
		se_respawn.spawn(p[1])
    end
end

function play_particle_on_path(actor, npc, p)
    local name = p[1]
    local path = p[2]
    local point_prob = p[3]
    if name == nil or path == nil then
        return
    end

    if point_prob == nil then
        point_prob = 100
    end
    
    local path = patrol(path)
    local count = path:count()
    for a = 0,count-1,1 do   
        local particle = particles_object(name)
        if math.random(100) <= point_prob then
            particle:play_at_pos(path:point(a))
        end
    end   
end


-----------------------------------------------------------------------------
function monster_berserk(actor, npc)
    npc:berserk()
end

function activate_bolt(actor, npc)
	db.actor:activate_slot(5)
end

--[[
send_tip(news_id:sender:sender_id)
    1. news_id
    2. sender*
    3. sender_id*
    * - not necessary
--]]
function send_tip(actor, npc, p)
    news_manager.send_tip(actor, p[1], nil, p[2], nil, p[3])
end



--[[
Дать сталкеру небольшой пинок. Например чтоб скинуть его с возвышения.
параметры: actor, npc, p[direction,bone,power,impulse,reverse=false]
    1. direction - если строка, то считается, что это имя пути и в сторону
        первой точки производится толчек. Если же это число, то оно
        рассматривается как story_id персонажа от которого должен поступить хит.
    2. bone - строка. Имя кости, по которой наносится удар.
    3. power - сила удара
    4. impulse - импульс
    5. reverse (true/false) - изменение направления удара. по умолчанию false
--]]
function hit_npc(actor, npc, p)
	local h = hit()
	local rev = p[5] and p[5] == 'true'
	h.draftsman = npc
	h.type = hit.wound
	if type(p[1]) == 'number' then
		local hitter = level_object_by_sid(p[1])
		if not hitter then return end
	    if rev then
	        h.draftsman = hitter
		    h.direction = hitter:position():sub(npc:position())
	    else
		    h.direction = npc:position():sub(hitter:position())
	    end
	else
	    if rev then
	        h.draftsman = nil
		    h.direction = npc:position():sub(patrol(p[1]):point(0))
	    else
		    h.direction = patrol(p[1]):point(0):sub(npc:position())
	    end
	end
	h:bone(p[2])
	h.power = p[3]
	h.impulse = p[4]
	--printf("HIT EFFECT: (%s, %s,%d,%d) health(%s)", npc:name(), p[2], h.power, h.impulse, npc.health)
	npc:hit(h)
end

--[[
Дать обьекту, заданному story_id, хит.
параметры: actor, npc, p[sid,bone,power,impulse,hit_src=npc:position()]
    1. sid - story_id обьекта, по которому наносится хит.
    2. bone - строка. Имя кости, по которой наносится удар.
    3. power - сила удара
    4. impulse - импульс
    5. hit_src - если число, то рассматривается как story_id обьекта, со стороны
        которого наносится хит (он же является и инициатором хита), иначе это
        точка (waypoint), из которой по объекту наносится хит.
        Если не задано, то берется позиция обьекта, из которого была вызвана
        данная функция.
--]]
function hit_obj(actor, npc, p)
	local h = hit()
	local obj = level_object_by_sid(p[1])
	local sid = nil

	if not obj then
--		abort("HIT_OBJ [%s]. Target object does not exist", npc:name())
		return
	end

	h:bone(p[2])
	h.power = p[3]
	h.impulse = p[4]

	if p[5] then
	    sid = tonumber(p[5])
	    if sid then
	        sid = level_object_by_sid(sid)
	        if sid then
	            h.direction = vector():sub(sid:position(), obj:position())
	        end
	    end
	    if not sid then
	        h.direction = vector():sub(patrol(p[5]):point(0), obj:position())
	    end
	else
	    h.direction = vector():sub(npc:position(), obj:position())
	end

	h.draftsman = sid or npc
	h.type = hit.wound
	obj:hit(h)
end

-- Дать телепатический хит объекту по SID:
function telepatic_hit_obj(actor, npc, p)
	local h = hit()
	local obj = level_object_by_sid(p[1])
	local sid = nil

	if not obj then
--		abort("HIT_OBJ [%s]. Target object does not exist", npc:name())
		return
	end

	h:bone(p[2])
	h.power = p[3]
	h.impulse = p[4]

	if p[5] then
	    sid = tonumber(p[5])
	    if sid then
	        sid = level_object_by_sid(sid)
	        if sid then
	            h.direction = vector():sub(sid:position(), obj:position())
	        end
	    end
	    if not sid then
	        h.direction = vector():sub(patrol(p[5]):point(0), obj:position())
	    end
	else
	    h.direction = vector():sub(npc:position(), obj:position())
	end

	h.draftsman = sid or npc
	h.type = hit.telepatic
	obj:hit(h)
end


-- Дать электрический хит объекту по SID:
function electric_hit_obj(actor, npc, p)
	local h = hit()
	local obj = level_object_by_sid(p[1])
	local sid = nil

	if not obj then
--		abort("HIT_OBJ [%s]. Target object does not exist", npc:name())
		return
	end

	h:bone(p[2])
	h.power = p[3]
	h.impulse = p[4]

	if p[5] then
	    sid = tonumber(p[5])
	    if sid then
	        sid = level_object_by_sid(sid)
	        if sid then
	            h.direction = vector():sub(sid:position(), obj:position())
	        end
	    end
	    if not sid then
	        h.direction = vector():sub(patrol(p[5]):point(0), obj:position())
	    end
	else
	    h.direction = vector():sub(npc:position(), obj:position())
	end

	h.draftsman = sid or npc
	h.type = hit.shock
	obj:hit(h)
end


-- Дать радиоактивный хит объекту по SID:
function radiation_hit_obj(actor, npc, p)
	local h = hit()
	local obj = level_object_by_sid(p[1])
	local sid = nil

	if not obj then
--		abort("HIT_OBJ [%s]. Target object does not exist", npc:name())
		return
	end

	h:bone(p[2])
	h.power = p[3]
	h.impulse = p[4]

	if p[5] then
	    sid = tonumber(p[5])
	    if sid then
	        sid = level_object_by_sid(sid)
	        if sid then
	            h.direction = vector():sub(sid:position(), obj:position())
	        end
	    end
	    if not sid then
	        h.direction = vector():sub(patrol(p[5]):point(0), obj:position())
	    end
	else
	    h.direction = vector():sub(npc:position(), obj:position())
	end

	h.draftsman = sid or npc
	h.type = hit.radiation
	obj:hit(h)
end


-- Дать кислотный хит объекту по SID:
function acidic_hit_obj(actor, npc, p)
	local h = hit()
	local obj = level_object_by_sid(p[1])
	local sid = nil

	if not obj then
--		abort("HIT_OBJ [%s]. Target object does not exist", npc:name())
		return
	end

	h:bone(p[2])
	h.power = p[3]
	h.impulse = p[4]

	if p[5] then
	    sid = tonumber(p[5])
	    if sid then
	        sid = level_object_by_sid(sid)
	        if sid then
	            h.direction = vector():sub(sid:position(), obj:position())
	        end
	    end
	    if not sid then
	        h.direction = vector():sub(patrol(p[5]):point(0), obj:position())
	    end
	else
	    h.direction = vector():sub(npc:position(), obj:position())
	end

	h.draftsman = sid or npc
	h.type = hit.chemical_burn
	obj:hit(h)
end


-- Дать хит в обратном направлении:
function hit_obj_back(actor, npc, p)
	local h = hit()
	local obj = level_object_by_sid(p[1])

	h:bone(p[2])
	h.power = p[3]
	h.impulse = p[4]

	h.direction = vector():sub(obj:position(), npc:position())

	h.draftsman = npc
	h.type = hit.wound
	obj:hit(h)
end


--[[
Дать сталкеру небольшой пинок после смерти. Аналогично предыдущему, только направление хита теперь
вычисляется через убийцу. Поэтому параметра direction нет.
параметры: actor, npc, p[bone,power,impulse]
FIXME: killer:position() isn't working
--]]
function hit_by_killer(actor, npc, p)
	if not npc then return end
	local t = db.storage[npc:id()].death
	if t == nil or t.killer == -1 then return end
	local killer = db.storage[t.killer]
	if killer == nil then return end
	local p1, p2
	p1 = npc:position()
	p2 = killer:position()
	local h = hit()
	h.draftsman = npc
	h.type = hit.wound
	h.direction = utils.vector_copy_by_val(p1):sub(p2)
	h.bone = p[1]
	h.power = p[2]
	h.impulse = p[3]
	npc:hit(h)
end

function set_friends(actor, npc, p)
    local npc1
	for i, v in pairs(p) do
		npc1 = level_object_by_sid(v)
		if npc1 and npc1:alive() then
			--printf("_bp: %d:set_friends(%d)", npc:id(), npc1:id())
			npc:set_relation(game_object.friend, npc1)
			npc1:set_relation(game_object.friend, npc)
		end
	end
end

function set_enemies(actor, npc, p)
    local npc1
	for i, v in pairs(p) do
		--printf("_bp: set_enemies(%d)", v)
		npc1 = level_object_by_sid(v)
		if npc1 and npc1:alive() then
			npc:set_relation(game_object.enemy, npc1)
			npc1:set_relation(game_object.enemy, npc)
		end
	end
end


function set_enemy_to_actor(actor, npc, p) -- сделать указанного по SID персонажа врагом актору
    local npc1
	for i, v in pairs(p) do
		--printf("_bp: set_enemies(%d)", v)
		npc1 = level_object_by_sid(v)
		if npc1 and npc1:alive() then
			-- npc:set_relation(game_object.enemy, npc1)
			npc1:set_relation(game_object.enemy, db.actor)
			relation_registry.set_community_goodwill (npc1, db.actor:id(), -5000)
		end
	end
end

function make_invulnerable_from_sid(actor, npc, p)
    local npc
	for i, v in pairs(p) do
		npc = level_object_by_sid(v)
		if npc and npc:alive() then
			npc:invulnerable(true)
		end
	end
end

function unmake_invulnerable_from_sid(actor, npc, p)
    local npc
	for i, v in pairs(p) do
		npc = level_object_by_sid(v)
		if npc and npc:alive() then
			npc:invulnerable(false)
		end
	end
end

-- играть звук в голове актёра
function play_snd(actor, npc, p)
	if p[1] then
		local snd_obj = xr_sound.get_safe_sound_object(p[1])
		--snd_obj:play(actor, p[2] or 0, sound_object.s2d)
		if snd_obj then
			snd_obj:play_no_feedback(actor, sound_object.s2d, p[2] or 0, vector(), 1.0)
		end
	end
end

-- играть звук от указанного объекта
function play_snd_from_obj(actor, npc, p)
	if p[1] and p[2] then
		local snd_obj = xr_sound.get_safe_sound_object(p[2])
		local obj     = level_object_by_sid(p[1])
        if obj ~= nil then
           -- printf("can't find object with story id %s", tostring(p[1]))
        
--		snd_obj:play_at_pos(obj, obj:position(), sound_object.s3d)
		if snd_obj then
			snd_obj:play_no_feedback(obj, sound_object.s3d, 0, obj:position(), 1.0)
		end
		end
	end
end

-- играть звук от указанного объекта
function play_snd_now(actor, npc, p)
	xr_sound.set_sound_play(npc, p[1])
end


-- прибавить к указанному счётчику актёра 1
function inc_counter(actor, npc, p)
	if p[1] then
		-- printf( "inc_counter '%s'", p[1] )
		xr_logic.pstor_store(actor, p[1], xr_logic.pstor_retrieve(actor, p[1], 0) + 1)
	end
end

function dec_counter(actor, npc, p)
	if p[1] then
		-- printf( "dec_counter '%s'", p[1] )
		xr_logic.pstor_store(actor, p[1], xr_logic.pstor_retrieve(actor, p[1], 0) - 1)
	end
end


-- переключает камеру на монстра или на актёра
function alien_control( actor, npc, p )
	-- printf( "alien_control(%s)", p[1] )
	npc:set_alien_control( p[1] == "true" )
end

-- слелать актёра врагом персонажам, которые в онлайне под указанным смартом
function set_gulag_enemy_actor( actor, npc, p )
	if p[1] then
		xr_gulag.setGulagEnemy(p[1], actor)
	end
end

-- принудительное обновление смарта. Использовать только в КРАЙНИХ случаях!!!
-- каждое использование согласовывать со мной. Чугай.
function smart_terrain_force_update(actor, npc, p)
	-- printf( "xr_effects.smart_terrain_force_update called" )

	if p[1] then
		local gulag = xr_gulag.get_gulag(p[1])

		if gulag then
			gulag.smrttrn:update()
		end
	end
end

------------------------------------------------------------------------------------------------------------------------

-- постпроцесс и влияние удара в морду
function actor_punch(npc)
	if db.actor:position():distance_to_sqr(npc:position()) > 4 then
		return
	end

	local active_slot = db.actor:active_slot()
	if active_slot ~= 1 and
	   active_slot ~= 2
	then
		return 
	end

	local active_item = db.actor:active_item()
	if active_item then
		db.actor:drop_item(active_item)
	end
	
	set_inactivate_input_time(30)
	local snd_obj = xr_sound.get_safe_sound_object([[affects\hit_fist]])
	
	if snd_obj then
		snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end

	level.add_cam_effector("camera_effects\\fusker.anm", 999, false, "")		
end

-- Принудительное усыпание игрока на радаре.
function force_actor_sleep(npc)
	db.actor:actor_sleep(24, 0)
end


-- забывание обиды
function clearAbuse(npc)
	-- printf("CLEAR_ABUSE")
	xr_abuse.clear_abuse(npc)
end


---Выключение динамической лампочки (hanging_lamp)
function turn_off(actor, npc, p)
	local obj = level_object_by_sid(p[1])

	if not obj then
		abort("TURN_OFF [%s]. Target object does not exist", npc:name())
		return
	end
	obj:get_hanging_lamp():turn_off()
end
function turn_off_object(actor, npc)
	npc:get_hanging_lamp():turn_off()
end

---Включение динамической лампочки (hanging_lamp)
function turn_on(actor, npc, p)
	local obj = level_object_by_sid(p[1])

	if not obj then
		abort("TURN_ON [%s]. Target object does not exist", npc:name())
		return
	end
	obj:get_hanging_lamp():turn_on()
end
function turn_on_object(actor, npc)
	npc:get_hanging_lamp():turn_on()
end

---------------------------------------------------------------------------------------
function play_snd_on_me(actor, npc, p)
 if p[1] then
  local snd_obj = xr_sound.get_safe_sound_object(p[1])
  snd_obj:play_no_feedback(npc, sound_object.s3d, 0, npc:position(), 1.0)
 end
end
------------------------------------------------------------------------------------------------

-- Кто-то из участников сценки вступил в бой - теперь нужно пообижать всех на всех
function gar_dm_bandits_fight(actor, npc)
	local novice = level_object_by_sid(104)
	if not novice or not novice:alive() then
		return
	end

	local ignore_actor = distance_between(actor, novice) > 25

	local bandit1 = level_object_by_sid(101)
	if bandit1 then
		novice:set_relation(game_object.enemy, bandit1)
		if not ignore_actor then
			bandit1:set_relation(game_object.enemy, actor)
		end
		bandit1:set_relation(game_object.enemy, novice)
	end

	local bandit2 = level_object_by_sid(102)
	if bandit2 then
		novice:set_relation(game_object.enemy, bandit2)
		if not ignore_actor then
			bandit2:set_relation(game_object.enemy, actor)
		end
		bandit2:set_relation(game_object.enemy, novice)
	end

	local bandit3 = level_object_by_sid(103)
	if bandit3 then
		novice:set_relation(game_object.enemy, bandit3)
		if not ignore_actor then
			bandit3:set_relation(game_object.enemy, actor)
		end
		bandit3:set_relation(game_object.enemy, novice)
	end
end

function gar_dm_bandit_demand(actor, npc)
	-- printf("_bp: gar_dm_bandit_demand: actor=%s", actor:name())

	if has_alife_info("gar_dm_bandit1_demand") or
	   has_alife_info("gar_dm_bandit2_demand") or
	   has_alife_info("gar_dm_bandit3_demand") then
		return
	end
	local r = math.random(3)
	if r == 1 then
		actor:give_info_portion("gar_dm_bandit1_demand")
	elseif r == 2 then
		actor:give_info_portion("gar_dm_bandit2_demand")
	else
		actor:give_info_portion("gar_dm_bandit3_demand")
	end
end

function gar_send_dymon_alarm(actor, npc)
	if has_alife_info("gar_start_graveyard") then
		news_manager.send_tip(actor, "tips_gar_hellcar_alarm", 2, "stalker", 10000)
	end
end

function gar_direction_fire(actor, npc)
	if has_alife_info("gar_hellcar_help") and not has_alife_info("gar_counter_fire") and not has_alife_info("gar_open_fire") then
		news_manager.send_tip(actor, "gar_direction_fire", 0, "stalker", 0)
	end
end

function gar_hellcar_victory(actor, npc)
	if not has_alife_info("gar_hellcar_tips_end") and has_alife_info("gar_hellcar_help") and not has_alife_info("gar_hellcar_thanks") then
		news_manager.send_tip(actor, "gar_hellcar_victory", 0, "stalker", 0)
		db.actor:give_info_portion("gar_hellcar_tips_end")
	end
end

function gar_seryi_victory(actor, npc)
		news_manager.send_tip(actor, "gar_hellcar_victory", 0, "stalker", 0)
end

function gar_boars_counter(actor, npc)
	local c = xr_logic.pstor_retrieve(actor, "gar_boars_counter", 0)
	if c < 1 then
		news_manager.send_tip(actor, "gar_actor_looser", 0, "dolg", 0)
	else
		news_manager.send_tip(actor, "gar_actor_normal", 0, "dolg", 0)
		db.actor:give_info_portion("gar_kill_boars_request")
	end
end

--' Escape

function play_snd_from_radio(actor, npc)
	local snd_obj	= xr_sound.get_safe_sound_object([[characters_voice\scenario\escape\wolf_to_rangers_1]])
	local obj		= npc:object("hand_radio")
	if snd_obj then
		snd_obj:play_no_feedback(obj, sound_object.s3d, 0, obj:position(), 1.0)	
	end
end

function esc_direction_fire(actor, npc)
	if not has_alife_info("esc_fanat_die") then
		news_manager.send_tip(actor, "esc_direction_fire", 7, "stalker", 0)
	end
end

function esc_fanat_victory(actor, npc)
	if has_alife_info("escape_lager_killers_die") and not has_alife_info("esc_fanat_die") then
		news_manager.send_tip(actor, "esc_fanat_victory", 0, "stalker", 10000)
	end
end

function esc_return_dv(actor, npc)
	news_manager.send_tip(actor, "esc_return_dv", 0, "trader", 10)
end



-- function esc_lager_forgive_actor(actor, npc)
--	xr_gulag.setGulagNeutral("esc_lager", db.actor)
-- end

-- function esc_lager_promise_actor(actor, npc)
--	local gulag = xr_gulag.get_gulag_by_name ("esc_lager")
--    if (gulag) then
--       gulag:set_relation (game_object.neutral, actor)
--    end  
-- end

-- function esc_lager_rage_actor(actor, npc)
--	local gulag = xr_gulag.get_gulag_by_name ("esc_lager")
--    if (gulag) then
--       gulag:set_relation (game_object.enemy, actor)
--    end  
-- end

--' garbage

function gar_mapspot_blockpost (actor, npc)
	level_tasks.add_location(115, "green_location", "gar_dolg_blokpost_leader_name")
end


	
function actor_friend(actor, npc)
	-- printf("_bp: xr_effects: actor_friend(): npc='%s': time=%d", npc:name(), time_global())
	npc:set_relation(game_object.friend, actor)
	npc:set_goodwill(5000, actor)
end

function actor_neutral(actor, npc)
	npc:set_relation(game_object.neutral, actor)
end

function actor_enemy(actor, npc)
	npc:set_relation(game_object.enemy, actor)
end

function give_all_quests(actor, npc)
	--bar_dialogs.quests()
end

function give_rostok_quests(actor, npc)
	bar_dialogs.rostok_quests()
end


-- Вызов этой функции отключит обработчик [combat] боя для персонажа.
-- Используется в случаях, когда все необходимые действия, такие как переключение на другую секцию,
-- уже выполнены, и повторно выполнять их во время боя нельзя (а условия секции [combat] проверяются на каждом
-- апдейте, когда персонаж в бою, если, конечно, не отключены вызовом этой функции).
function disable_combat_handler(actor, npc)
	if db.storage[npc:id()].combat then
		db.storage[npc:id()].combat.enabled = false
	end
	
	if db.storage[npc:id()].mob_combat then
		db.storage[npc:id()].mob_combat.enabled = false
	end
end

-- Вызов этой функции отключит обработчик [combat_ignore] перехвата боя для персонажа.
function disable_combat_ignore_handler(actor, npc)
	if db.storage[npc:id()].combat_ignore then
		db.storage[npc:id()].combat_ignore.enabled = false
	end
end

function log_bp1(actor, npc)
	-- printf("xr_effects: log_bp1 (actor='%s', npc='%s'", actor:name(), npc:name())
end

function psi_hit_npc(actor, npc,p)
end


function mil_paul_frost_dead (actor, npc)     
    local gulag = xr_gulag.get_gulag_by_name ("mil_freedom")
    if (gulag) then
       gulag:set_relation (game_object.neutral, actor)
    end   
end

function set_freedom_actor_enemy (actor, npc)
    local luk = level_object_by_sid (707)
    this.actor_enemy (actor, luk)
end

function military_dolg_dead (actor, npc)
    -- если нет актера, то вылетаем с грохотом и треском
    if actor == nil then return end
    -- проапдейтим количество мертвых долговцев
    local mil_dolg_killed = xr_logic.pstor_retrieve(actor, "mil_dolg_killed", 0) + 1
    xr_logic.pstor_store(actor, "mil_dolg_killed", mil_dolg_killed)
    if mil_dolg_killed == 8 then
       actor:give_info_portion ("mil_dolg_dead")
	   amk.del_variable("mil_dolg_killed")
    end   
    
end

function mil_patrol_death_check (actor, npc)
    if has_alife_info("mil_patrol_man1_dead") and has_alife_info("mil_patrol_man2_dead") and has_alife_info("mil_patrol_man3_dead") then
       actor:give_info_portion ("mil_patrol_dead") 
    end
end

function mil_cook_dead (actor, npc)
    --level_tasks.set_task_state (task.fail, "mil_freedom_rg6_task", 2)
end

function search_gulag_job(actor, npc)
	xr_gulag.resetJob(npc)
end


--------------------------------------------------------- 
-- BAR-ROSTOK
--------------------------------------------------------- 

function bar_freedom_spam_1(actor, npc)
	news_manager.send_tip(actor, "bar_freedom_spam_1", nil, "killer", nil, 509)
end
function bar_freedom_spam_2(actor, npc)
	news_manager.send_tip(actor, "bar_freedom_spam_2", nil, "killer", nil, 509)
end
function bar_freedom_spam_3(actor, npc)
	news_manager.send_tip(actor, "bar_freedom_spam_3", nil, "killer", nil, 509)
end
function bar_freedom_spam_4(actor, npc)
	news_manager.send_tip(actor, "bar_freedom_spam_4", nil, "killer", nil, 509)
end
function bar_ecolog_spam_1(actor, npc)
	news_manager.send_tip(actor, "bar_ecolog_spam_1", nil, "ecolog", nil, 503)
end
function bar_ecolog_spam_2(actor, npc)
	news_manager.send_tip(actor, "bar_ecolog_spam_2", nil, "ecolog", nil, 503)
end
function bar_ecolog_spam_3(actor, npc)
	news_manager.send_tip(actor, "bar_ecolog_spam_3", nil, "ecolog", nil, 503)
end
function bar_ecolog_spam_4(actor, npc)
	news_manager.send_tip(actor, "bar_ecolog_spam_4", nil, "ecolog", nil, 503)
end
function bar_ecolog_spam_5(actor, npc)
	if not has_alife_info("bar_heli_scene_volkodav_die") and not has_alife_info("bar_ecolog_saw_chase") then
		news_manager.send_tip(actor, "bar_freedom_chase", nil, "ecolog", nil, 503)
		db.actor:give_info_portion("bar_ecolog_saw_chase")
	end
end
function bar_ecolog_hit(actor, npc)
	news_manager.send_tip(actor, "bar_ecolog_hit", nil, "ecolog", nil, 503)
end
function bar_freedom_spam_5(actor, npc)
	if not has_alife_info("bar_heli_scene_volkodav_die") then
		news_manager.send_tip(actor, "bar_ecolog_escape", nil, "killer", nil, 509)
	end
end
function bar_freedom_angry_actor(actor,npc)
	if has_alife_info("bar_ecolog_crush_actor_enemy")
	then
		npc:set_relation(game_object.enemy, db.actor)
	end
end
function bar_freedom_defence_ecolog(actor,npc)
	news_manager.send_tip(db.actor, "bar_ecolog_attack", nil, "ecolog", nil, 503)
end		
function bar_freedom_angry_actor_notify(actor,npc)
	if has_alife_info("bar_ecolog_crush_actor_enemy") then
		news_manager.send_tip(actor, "bar_freedom_attack_spy", 4, "killer", nil, 509)
	end
end
function bar_crush_heli_start(actor,npc)
	news_manager.send_tip(actor, "bar_ecolog_crush_start_heli", nil, "ecolog", nil, 503)
end
function rostok_kruglov_tip_1(actor,npc)
	news_manager.send_tip(actor, "rostok_kruglov_spam_1", nil, "ecolog", nil, 503)
end
function rostok_kruglov_tip_2(actor,npc)
	news_manager.send_tip(actor, "rostok_kruglov_spam_2", nil, "ecolog", nil, 503)
	level_tasks.add_location(597, "volkodav_location", "rostok_banda_volkodava")
end
function rostok_kruglov_attract_1(actor,npc)
	xr_sound.set_sound_play(npc, "kruglov_stop_enemy_1")
	local tips_sound = news_manager.send_tip_nosound(db.actor, "bar_freedom_chase", 0, "ecolog")
	if tips_sound ~= nil then
		--' Играем звук забитый
		tips_sound:play(db.actor, 0, sound_object.s2d)
	end
end
function rostok_kruglov_attract_2(actor,npc)
	xr_sound.set_sound_play(npc, "kruglov_stop_enemy_2",3)
	local tips_sound = news_manager.send_tip_nosound(db.actor, "rostok_kruglov_follow_2",3000, "ecolog")
	if tips_sound ~= nil then
		--' Играем звук забитый
		tips_sound:play(db.actor, 0, sound_object.s2d)
	end
end
function rostok_kruglov_ambush(actor,npc)
	xr_sound.set_sound_play(npc, "rostok_kruglov_help_5")
	local tips_sound = news_manager.send_tip_nosound(db.actor, "rostok_kruglov_follow_3", 0, "ecolog")
	if tips_sound ~= nil then
		--' Играем звук забитый
		tips_sound:play(db.actor, 0, sound_object.s2d)
	end
end
function bar_crush_heli_down(actor,npc)
	news_manager.send_tip(actor, "bar_ecolog_crush_heli_down", 1, "killer", nil, 509)
end
function bar_ecolog_crush_attract_actor(actor,npc)
	if not has_alife_info("bar_heli_scene_professor_die") then
		news_manager.send_tip(actor, "bar_ecolog_crush_attract_actor", nil, "ecolog")
	end
end
function bar_freedom_attack_attract_actor(actor,npc)
		news_manager.send_tip(actor, "bar_freedom_attack_attract_actor", nil, "killer")
	end
function bar_freedom_attack_start(actor,npc)
		if not has_alife_info("bar_freedom_defence_ecolog") then
			news_manager.send_tip(db.actor, "bar_freedom_attack", nil, "killer", nil, 509)
            db.actor:give_info_portion("bar_freedom_defence_ecolog")
		end
	end
function bar_arena_hit(actor, npc)
	local h = hit()
	h.power = 0.01
	h.direction = npc:direction()
	h.draftsman = db.actor 
	h.impulse = 1
	h.type = hit.wound
	npc:hit(h)
end
function esc_hit_from_fox(actor, npc)
	local fox = level_object_by_sid (005)
	if fox == nil then
		return
	end
	local h = hit()
	h.power = 0.01
	h.direction = npc:direction()
	h.draftsman = fox 
	h.impulse = 1
	h.type = hit.wound
	npc:hit(h)
end

function bar_territory_logic(actor, npc)
	local level = level.name()
	if 	level == "l05_bar" then
		if dialogs.actor_in_dolg(actor,npc) then
			if has_alife_info("bar_dolg_territory_kill") then
				news_manager.send_tip(actor, "bar_territory_dolg_kill", nil, "dolg", nil, 507)
				xr_gulag.setGulagEnemy("bar_dolg_general", db.actor)
				xr_gulag.setGulagEnemy("bar_dolg_veterans", db.actor)
				xr_gulag.setGulagEnemy("bar_dolg_bunker", db.actor)
				xr_gulag.setGulagEnemy("bar_zastava", db.actor)
				xr_gulag.setGulagEnemy("bar_zastava_2", db.actor)
				xr_gulag.setGulagEnemy("bar_visitors", db.actor)
				return
			end
			if has_alife_info("bar_dolg_territory_3_hit") then
				news_manager.send_tip(actor, "bar_territory_dolg_3_hit", nil, "dolg", nil, 507)
				xr_gulag.setGulagEnemy("bar_dolg_general", db.actor)
				xr_gulag.setGulagEnemy("bar_dolg_veterans", db.actor)
				xr_gulag.setGulagEnemy("bar_dolg_bunker", db.actor)
				xr_gulag.setGulagEnemy("bar_zastava", db.actor)
				xr_gulag.setGulagEnemy("bar_zastava_2", db.actor)
				return
			end
			if has_alife_info("bar_dolg_territory_2_hit") then
				news_manager.send_tip(actor, "bar_territory_dolg_2_hit", nil, "dolg", nil, 507)
				return
			end
			if has_alife_info("bar_dolg_territory_1_hit") then
				news_manager.send_tip(actor, "bar_territory_dolg_1_hit", nil, "dolg", nil, 507)
				return
			end
		else
			if has_alife_info("bar_dolg_territory_kill") then
				db.actor:give_info_portion("bar_territory_nodolg_kill")
				news_manager.send_tip(actor, "bar_territory_nodolg_kill", nil, "dolg", nil, 507)
				xr_gulag.setGulagEnemy("bar_dolg_general", db.actor)
				xr_gulag.setGulagEnemy("bar_dolg_veterans", db.actor)
				xr_gulag.setGulagEnemy("bar_dolg_bunker", db.actor)
				xr_gulag.setGulagEnemy("bar_zastava", db.actor)
				xr_gulag.setGulagEnemy("bar_zastava_2", db.actor)
				xr_gulag.setGulagEnemy("bar_visitors", db.actor)
				return
			end
			if has_alife_info("bar_dolg_territory_2_hit") then
				db.actor:give_info_portion("bar_territory_nodolg_2_hit")
				news_manager.send_tip(actor, "bar_territory_nodolg_2_hit", nil, "dolg", nil, 507)
				xr_gulag.setGulagEnemy("bar_dolg_general", db.actor)
				xr_gulag.setGulagEnemy("bar_dolg_veterans", db.actor)
				xr_gulag.setGulagEnemy("bar_dolg_bunker", db.actor)
				xr_gulag.setGulagEnemy("bar_zastava", db.actor)
				xr_gulag.setGulagEnemy("bar_zastava_2", db.actor)
				xr_gulag.setGulagEnemy("bar_visitors", db.actor)
				return
			end
			if has_alife_info("bar_dolg_territory_1_hit") then
				db.actor:give_info_portion("bar_territory_nodolg_1_hit")
				news_manager.send_tip(actor, "bar_territory_nodolg_1_hit", nil, "dolg", nil, 507)
				return
			end	
		end
	end
	return
end

function bar_territory_hit(victim, who)
	local lname = level.name()
	if lname == "l05_bar" and who and who:id() == db.actor:id() then
		-- logf("hit1")
		relation_registry.set_community_goodwill(victim:character_community(), db.actor:id(), -25)
		if victim:relation(db.actor) == game_object.neutral then
			db.actor:change_character_reputation(db.actor:character_reputation() - 25);
			amk.set_npc_relation(victim, who, "enemy")
		elseif victim:relation(db.actor) == game_object.friend then
			db.actor:change_character_reputation(db.actor:character_reputation() - 50);
			amk.set_npc_relation(victim, who, "neutral")
		end
		-- logf("hit2")
	end
end

function bar_territory_death(victim, who)
	local lname = level.name()
	if lname == "l05_bar" and who and who:id() == db.actor:id() then
		-- logf("death1")
		relation_registry.set_community_goodwill(victim:character_community(), db.actor:id(), -100)
		-- logf("death11")	
		if victim:relation(db.actor) == game_object.neutral then
			db.actor:change_character_reputation(db.actor:character_reputation() - 50);
			-- logf("death12")	
		elseif victim:relation(db.actor) == game_object.friend then
			db.actor:change_character_reputation(db.actor:character_reputation() - 100);
			-- logf("death13")	
		end
		-- logf("death14")	
		if victim:character_community() == "stalker" or victim:character_community() == "dolg" then
			-- logf("death15")	
			for id=1,65535 do
				local npc = level.object_by_id(id)
				if npc and npc:alive() and IsStalker(npc) and (npc:character_community() == "stalker" or npc:character_community() == "dolg") then
					-- logf("death16")	
					amk.set_npc_relation(npc, who, "enemy")
				end
			end
		end	
		-- logf("death2")		
	end
end

function bar_psih_come(actor, npc)
	news_manager.send_tip(actor, "bar_psih_come", nil, "barman")
end

function bar_actor_is_enemy(actor, npc)
			xr_gulag.setGulagEnemy("bar_dolg_general", db.actor)
			xr_gulag.setGulagEnemy("bar_dolg_veterans", db.actor)
			xr_gulag.setGulagEnemy("bar_dolg_bunker", db.actor)
			xr_gulag.setGulagEnemy("bar_visitors", db.actor)
end

function bar_actor_enemy_set (actor, npc)          
    local dog = level_object_by_sid (509)
    if dog ~= nil then
       dog:set_relation (game_object.enemy, db.actor) 
    end   
end

function bar_arena_weapon_spawn ()
	
	local obj = level_object_by_sid (606)
	local spawn_items = {}
	
	for i = 1,100 do
		table.insert( spawn_items, "bandit_outfit")
	end
	
	local k,v = 0,0
	
	for k,v in pairs(spawn_items) do
		alife():create(v,	
						obj:position(),
						obj:level_vertex_id(),	
						obj:game_vertex_id())
	end	
end

local function transfer_object_item(item)
    out_object:transfer_item(item, in_object)
end
function bar_arena_teleport ( actor, npc)

	inv_box_1 = level_object_by_sid (573)

	out_object = actor
    in_object  = inv_box_1
		actor:inventory_for_each(transfer_object_item) 

	local spawn_items = {}	

	if	has_alife_info("bar_arena_fight_1") then 
		table.insert(spawn_items, "wpn_pm")
		table.insert(spawn_items, "ammo_9x18_pmm")
		table.insert(spawn_items, "ammo_9x18_pmm")
		table.insert(spawn_items, "wpn_knife")
	elseif	has_alife_info("bar_arena_fight_2") then
		table.insert(spawn_items, "wpn_mp5")
		table.insert(spawn_items, "ammo_9x19_pbp")
		table.insert(spawn_items, "wpn_knife")		
	elseif	has_alife_info("bar_arena_fight_3") then
		table.insert(spawn_items, "wpn_bm16")
		table.insert(spawn_items, "ammo_12x70_buck")
		table.insert(spawn_items, "wpn_knife")
	elseif	has_alife_info("bar_arena_fight_4") then			
		table.insert(spawn_items, "wpn_ak74")
		table.insert(spawn_items, "ammo_5.45x39_ap")
		table.insert(spawn_items, "ammo_5.45x39_ap")
		table.insert(spawn_items, "wpn_knife")
		table.insert(spawn_items, "bandage")
		table.insert(spawn_items, "bandage")
	elseif	has_alife_info("bar_arena_fight_5") then	
		table.insert(spawn_items, "wpn_abakan")
		table.insert(spawn_items, "ammo_5.45x39_ap")
		table.insert(spawn_items, "ammo_5.45x39_ap")
		table.insert(spawn_items, "ammo_5.45x39_ap")
		table.insert(spawn_items, "wpn_knife")
		table.insert(spawn_items, "bandage")
		table.insert(spawn_items, "medkit")
		table.insert(spawn_items, "svoboda_light_outfit")
	elseif	has_alife_info("bar_arena_fight_6") then
		table.insert(spawn_items, "wpn_groza")
		table.insert(spawn_items, "ammo_9x39_ap")
		table.insert(spawn_items, "ammo_9x39_ap")
		table.insert(spawn_items, "ammo_9x39_ap")
		table.insert(spawn_items, "wpn_knife")
		table.insert(spawn_items, "grenade_f1")
		table.insert(spawn_items, "specops_outfit")
	elseif	has_alife_info("bar_arena_fight_7") then
		table.insert(spawn_items, "wpn_knife")
		table.insert(spawn_items, "bandage")
		table.insert(spawn_items, "grenade_f1")
		table.insert(spawn_items, "grenade_f1")
		table.insert(spawn_items, "grenade_f1")
		table.insert(spawn_items, "grenade_f1")
	elseif	has_alife_info("bar_arena_fight_8") then
		table.insert(spawn_items, "wpn_g36")
		table.insert(spawn_items, "ammo_5.56x45_ap")
		table.insert(spawn_items, "ammo_5.56x45_ap")
		table.insert(spawn_items, "ammo_5.56x45_ap")
		table.insert(spawn_items, "ammo_5.56x45_ap")
		table.insert(spawn_items, "wpn_knife")
	end
	
	local k,v = 0,0
	
	for k,v in pairs(spawn_items) do
		alife():create(v,	
						db.actor:position(),
						db.actor:level_vertex_id(),	
						db.actor:game_vertex_id(), 
						db.actor:id())
	end	
	
end

function bar_arena_weapon_slot ()
	if	has_alife_info("bar_arena_fight_1") then  
		db.actor:activate_slot(1)
	else 
		db.actor:activate_slot(2)
	end
end

function bar_arena_teleport_2 ( actor, npc)

	  level.add_pp_effector ("blink.ppe", 234, false)				
	
		db.actor:set_actor_position(patrol("t_walk_2"):point(0))
		local dir = patrol("t_look_2"):point(0):sub(patrol("t_walk_2"):point(0))
		db.actor:set_actor_direction(-dir:getH())
	
	inv_box_2 = level_object_by_sid (574)

	out_object = actor
    in_object  = inv_box_2
		actor:inventory_for_each(transfer_object_item) 
end

function barman_give_extra_task (actor, npc)
	if has_alife_info ("agroprom_military_case_done") and not has_alife_info ("bar_darklab_document_start") then
		db.actor:give_info_portion("barman_job_1")
		return
	elseif has_alife_info ("bar_darklab_document_done") and not has_alife_info ("bar_x16_documents_start") then
		db.actor:give_info_portion("barman_job_2")
		return
	elseif has_alife_info ("bar_x16_documents_done") and not has_alife_info ("bar_deactivate_radar_start") then
		db.actor:give_info_portion("barman_job_3")
		return
	end
	return	
end

function trader_extra_task (actor, npc)
	if has_alife_info ("esc_serious_talk") and not has_alife_info ("agroprom_military_case") then
		db.actor:give_info_portion("trader_job")
		return
	end
	return
end

function scientist_extra_task (actor, npc)
	if has_alife_info ("yan_find_scientist_done") and not has_alife_info ("yan_find_vasilyev_start") then
		db.actor:give_info_portion("scientist_job")
		return
	end
	return
end

function military_max_dead (actor, npc)
end

function military_lukash_dead (actor, npc)
end

function mil_courier_death (actor, npc)
    actor:give_info_portion ("mil_courier_dead")
    if has_alife_info("mil_leader_quest2_start") then
       if not has_alife_info("mil_courier_visited") then
          level_tasks.set_task_state (task.fail, "mil_courier_job", 1)
       end   
       level_tasks.set_task_state (task.completed, "mil_courier_job", 2)
       level_tasks.set_task_state (task.completed, "mil_courier_job", 0)
    end   
end

function mil_courier_quest_fail (actor, npc)
    if has_alife_info("mil_courier_quest") == false then return end
    level_tasks.set_task_state (task.fail, "mil_courier_job", 0)
    actor:give_info_portion ("mil_courier_quest_failed")
end

function mil_scull_news (actor, npc)
end

function mil_sniper_dead (actor, npc)
    if has_alife_info("mil_dolg_final_task") then
       level_tasks.remove_location (npc:story_id (), "mil_sniper_location")
    end       
end

function mil_actor_enemy_set (actor, npc)
    local sniper = level_object_by_sid (704)
    if sniper ~= nil then
       sniper:set_relation (game_object.enemy, db.actor) 
    end   
    --xr_gulag.setGulagRelation ("mil_freedom", game_object.enemy, db.actor)    
end


function mil_actor_enemy_reset (actor, npc)
    local sniper = level_object_by_sid (704)
    if sniper ~= nil then
       sniper:set_relation (game_object.neutral, db.actor) 
    end   
    --xr_gulag.setGulagRelation ("mil_freedom", game_object.neutral, db.actor)    
end

function mil_bomb_explode (actor, npc)
    local source = nil
    local sim = alife ()
    if sim then
       local se_obj = sim:story_object (723)  
       if se_obj then
          source = level.object_by_id(se_obj.id)
       end
    end

    if source == nil then
       --'abort ("Bomb with story id MIL_BOMB not found")
       return
    end

    local h = hit ();
    h.power = 1000000;
    h.direction = vector():set( 1, 0, 0 );
    h.impulse = 1;
    h.draftsman = source;
    h.type = hit.chemical_burn;
    source:hit (h);
    
    
end

function mil_set_alarm (actor, npc)
	-- printf("pl:millitary base is under attack!!!!!!!")
    actor:give_info_portion ("mil_freedom_under_attack")
    
    local skull = level_object_by_sid (708)
    if skull == nil then 
       return 
    end

    this.set_stalker_enemy (702, skull)     -- hit to Lukash
    this.set_stalker_enemy (707, skull)     -- hit to Max
    this.set_stalker_enemy (730, skull)     -- hit to Sniper1
    this.set_stalker_enemy (731, skull)     -- hit to Sniper2
    this.set_stalker_enemy (732, skull)     -- hit to Sniper3
end

function sar2_monolith_explode (actor, npc)
    local monolith = level_object_by_sid (1305)
    if monolith == nil then
       abort ("Object MONOLITH with SID 1305 not found")
    end    
    local h = hit ();
    h.power = 1000;
    h.direction = vector():set( 1, 0, 0 );
    h.impulse = 1;
    h.draftsman = actor;
    h.type = hit.chemical_burn;
    monolith:hit (h);
end

function set_stalker_enemy (sid, draftsman)
    local npc = level_object_by_sid (sid)
    if npc == nil or npc:alive () == false then
       return 
    end    
    local h = hit ()
    h.power = 0
    h.direction = vector():set( 1, 0, 0 )
    h.impulse = 0
    h.draftsman = draftsman
    h.type = hit.strike
    npc:hit (h)
end



function mil_remove_cook_map_spot (actor, npc)
    level_tasks.remove_location (728, "mil_cook_location")
end

function mil_transfer_docs_to_ara (actor, npc)
    --local ara = level_object_by_sid (719)
    --local pavlik = level_object_by_sid (710)
    --if ara == nil or pavlik == nil or pavlik:object ("mil_courier_doc") == nil then
       --return
    --end   
    --ara:transfer_item (pavlik:object ("mil_courier_doc"), pavlik)
end

function mil_emeny_nearest (actor, npc)
    if actor == nil or actor:alive () == false then
       return
    end    

    local gulag = xr_gulag.get_gulag_by_name ("mil_freedom")
    if gulag == nil then return end

    if gulag:npc_is_enemy_to_anybody(actor) then
       actor:give_info_portion ("mil_enemy_nearest")
    end
end


function mil_cap_mapspot (actor, npc)
    local cap = level_object_by_sid (724)
    if cap == nil or cap:alive () == false then
       return 
    end    
    
    if not has_alife_info("mil_fblockpost_spot_set") then
       actor:give_info_portion ("mil_fblockpost_spot") 
       actor:give_info_portion ("mil_fblockpost_spot_set")
       level_tasks.add_location (724, "mil_fblockpost_location")
    end
end

function mil_cap_mapspot_remove (stalker1, stalker2)
    if has_alife_info("mil_fblockpost_spot") then
       level_tasks.remove_location_safe (724, "mil_fblockpost_location")
       db.actor:disable_info_portion ("mil_fblockpost_spot_remove")
    end      
end

function set_actor_enemy_for_freedom (actor, npc)
    xr_gulag.setGulagEnemy ("mil_freedom", actor)
end


-- GARBAGE

function gar_send_dolg_warning()
	if db.actor then
		if xr_gulag.getGulagPopulation("gar_dolg") > 0 then
			news_manager.send_tip(db.actor, "gar_dolg_warning", 0, "dolg")
		end
	end
end


-------------------------------------------------------------------------------------
-- Функции для DarkValley
-------------------------------------------------------------------------------------
function val_escort_guard_death(actor, npc)
    --printf("xr_effects <val_escort_guard_death>: %s.", npc:name())
    local idx = string.sub(npc:name(), -1)
	local t = db.storage[npc:id()].death

    actor:disable_info_portion("val_escort_guard" .. idx .. "_combat")
    actor:give_info_portion("val_escort_guard" .. idx .. "_dead")
    
	if t ~= nil and t.killer == actor:id() then
        actor:give_info_portion("val_escort_actor_helped")
	end
    --"on_info     = %-val_escort_guard1_combat +val_escort_guard1_dead%\n" ..
    --"on_info2    = {=killed_by_actor} %+val_escort_actor_helped%\n" ..
end

function val_escort_guard_hit(actor, npc)
    local idx = string.sub(npc:name(), -1)
	local t = db.storage[npc:id()].hit

	if t ~= nil then
	    if t.who == actor:id() then
            actor:give_info_portion("val_escort_combat")
            actor:give_info_portion("val_escort_actor_helped")
            if not has_alife_info("val_escort_nap1_start_combat") then
                actor:give_info_portion("val_escort_captive_enemy")
            end
	    else
	        local npc1 = level_object_by_sid(406)
	        if npc1 ~= nil and t.who == npc1:id() then
                actor:give_info_portion("val_escort_combat")
                actor:give_info_portion("val_escort_nap1_start_combat")
	        --else
            --    actor:give_info_portion("val_escort_guard" .. idx .. "_combat")
	        end
	    end
	end
    --"on_info     = {=hit_by_actor} %+val_escort_combat +val_escort_actor_helped%, %+val_escort_guard1_combat%\n" ..
    --"on_info2    = {+val_escort_combat -val_escort_nap1_start_combat} %+val_escort_captive_enemy%\n" ..
    --"on_info3    = {=hitted_by(406) -val_escort_captive_enemy} %+val_escort_nap1_start_combat%\n" ..
end

function val_escort_guard_combat(actor, npc)
    local idx = string.sub(npc:name(), -1)

    actor:give_info_portion("val_escort_guard" .. idx .. "_combat")
    
    if npc:see(actor) then
        if not has_alife_info("val_escort_nap1_start_combat") then
            actor:give_info_portion("val_escort_captive_enemy")
        end
        actor:give_info_portion("val_escort_combat")
    end
    --"on_info     = %+val_escort_guard1_combat%\n" ..
    --"on_info2    = {=see_actor -val_escort_nap1_start_combat -val_escort_captive_enemy} %+val_escort_captive_enemy%\n" ..
    --"on_info3    = {=see_actor -val_escort_combat} %+val_escort_combat% ;remark@val_escort_guard1_fight\n" ..
end

function val_escort_guard_free(actor, npc)
    --local idx = string.sub(npc:name(), -1)

    actor:give_info_portion("val_escort_guards_free")
    actor:disable_info_portion("val_escort_guard" .. string.sub(npc:name(), -1) .. "_combat")
    --"on_info             = %+val_escort_guards_free -val_escort_guard1_combat%\n"
end


-------------------------------------------------------------------------------------
-- kill
-------------------------------------------------------------------------------------
function killactor (actor, npc)
    npc:set_relation (game_object.enemy, actor)
    --actor:give_info_portion ("mil_bodyguard_kill")
end

function kill(actor, npc)
	npc:kill( npc )
end

function kill_from_actor(actor, npc)
	local hit = hit()
	hit.direction = vector():set(0, 0, 0)
	hit.impulse = 0
	hit.draftsman = db.actor
	hit.power = 100.0
	hit.type = hit.wound
	npc:hit(hit)
end
-------------------------------------------------------------------------------------
-- Функции для Агропрома
-------------------------------------------------------------------------------------

function agr_krot_sos( actor, npc )
	news_manager.send_tip( actor, "tips_agr_krot_sos", 0, "krot", 10000 )
end

function agr_krot_sos_1_2( actor, npc )
	if not has_alife_info( "agr_help_krot_start" ) and
	   not has_alife_info( "agr_help_krot_done" ) and
	   not has_alife_info( "agr_krot_skirmish_start" ) and
	   not has_alife_info( "agr_krot_dead" ) and not(agroprom_tasks.agr_actor_enemy())
	then
		actor:give_info_portion( "agr_help_krot_start" )
		news_manager.send_tip( actor, "tips_agr_krot_sos1", 0, "krot", 10000 )

		if has_alife_info( "agr_help_stalkers_defence_dead" ) then
			news_manager.send_tip( actor, "tips_agr_krot_sos2", 0, "krot", 10000 )
		end
	end
end

function agr_knockdown ()
	local snd_obj = xr_sound.get_safe_sound_object([[affects\tinnitus3a]])
	if snd_obj then
		snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end
	level.add_cam_effector("camera_effects\\earthquake.anm", 1974, false, "")
end

function agr_contuz (actor, npc)
		local sound_obj_l		= xr_sound.get_safe_sound_object( [[affects\psy_blackout_l]] )
        local sound_obj_r		= xr_sound.get_safe_sound_object( [[affects\psy_blackout_r]] )
        if sound_obj_l then
			sound_obj_l:play_no_feedback(actor, sound_object.s2d, 0, vector():set(-1, 0, 1), 1.0)
		end
		if sound_obj_r then
			sound_obj_r:play_no_feedback(actor, sound_object.s2d, 0, vector():set( 1, 0, 1), 1.0)
		end
end

function agr_cam_effect ()
	level.add_cam_effector2("camera_effects\\agroprom_doctor_cam.anm", 123, false, "")

end

function agr_weapon(actor, npc)
	local actor = db.actor	
	if 	actor ~= nil then actor:activate_slot(2)
	end
end
function agr_hold_enemy(actor, npc)
	local gulag = xr_gulag.get_gulag_by_name("agr_factory_hold")
	
	local h  = hit()
	h.power     = 0.01
	h.direction = vector():set( 1, 0, 0 )
	h.draftsman = actor
	h.impulse   = 1
	h.type      = hit.wound
	
	for k, v in pairs(gulag.Object) do
		if v ~= true and level.object_by_id( k ) ~= nil then
			v:hit( h )
		end
	end	
end
--------------------------------------------------------- 
-- PRIPYAT
--------------------------------------------------------- 
function pri_zombied_in_combat_inc(actor, npc)
    gulag_pripyat.zombied_in_combat[npc:name()] = true
    --printf("effect <pri>: zombied in combat(%s) inc.", npc:name())
end

function pri_zombied_in_combat_dec(actor, npc)
    gulag_pripyat.zombied_in_combat[npc:name()] = nil
    --printf("effect <pri>: zombied in combat(%s) dec.", npc:name())
end

function pri_drop_rpg_ammo(actor, npc)
    local item = npc:object("ammo_og-7b")
    if item then
        npc:drop_item(item)
    -- else
        -- printf("xr_effects <pri_drop_rpg_ammo>: there is no [ammo_og-7b] in [%s] inventory.", npc:name())
    end
end

function pri_give_ammo_og7b(actor, npc)
    alife():create("ammo_og-7b", npc:position(), npc:level_vertex_id(), npc:game_vertex_id(), npc:id())
    alife():create("ammo_og-7b", npc:position(), npc:level_vertex_id(), npc:game_vertex_id(), npc:id())
end

---------------------------------------------------------
-- DeadCity
---------------------------------------------------------


---------------------------------------------------------
-- Sarcofag + Monolith
---------------------------------------------------------
function osoznanie_call(actor, npc)
	news_manager.send_tip(db.actor, "o_soznanie_text", 0, "o_soznanie")
end

function death_monolith_ghosts(actor, npc)
	db.actor:give_info_portion("sar2_death_2")
	db.actor:give_info_portion("sar2_death_5")
	db.actor:give_info_portion("sar2_death_7")
	db.actor:give_info_portion("sar2_death_9")
	db.actor:give_info_portion("sar2_death_16")
	db.actor:give_info_portion("sar2_death_25")
	db.actor:give_info_portion("sar2_death_26")
	db.actor:give_info_portion("sar2_death_27")
	db.actor:give_info_portion("sar2_death_28")
	db.actor:give_info_portion("sar2_death_29")
	db.actor:give_info_portion("sar2_death_30")
	db.actor:give_info_portion("sar2_death_35")
	db.actor:give_info_portion("sar2_death_36")
	db.actor:give_info_portion("sar2_death_37")
	db.actor:give_info_portion("sar2_death_50")
	db.actor:give_info_portion("sar2_death_51")
	db.actor:give_info_portion("sar2_death_54")
	db.actor:give_info_portion("sar2_death_57")
	db.actor:give_info_portion("sar2_death_58")
	db.actor:give_info_portion("sar2_death_59")
	db.actor:give_info_portion("sar2_death_60")
end

---------------------------------------------------------
-- Sarcofag2
---------------------------------------------------------
--[[
local sar2_heroes_list = {
    "sar2_tutorial_wounded",
    "sar2_stalker_freeman",
    "sar2_doctor",
    "sar2_dram_novice",
    "sar2_bandit_novice",
    "sar2_ranger",
    "sar2_bandit_general",
    "sar2_zombied_novice",
    "sar2_fox",
    "sar2_seriy",
    "sar2_ratcatcher",
    "sar2_wolf",
    "sar2_ecolog_professor",
    "sar2_psih",
    "sar2_stalker_explorer",
    "sar2_hellcar",
    "sar2_fanat",
    "sar2_gar_dolg_blokpost_commander",
    "sar2_krot",
    "sar2_bandit_borov",
    "sar2_arena_manager",
    "sar2_zastava_commander_1",
    "sar2_bandit_leader",
    "sar2_svoboda_zombi_stalker",
    "sar2_monolith_regular2",
    "sar2_monolith_regular",
    "sar2_bandit_veteran",
    "sar2_soldier_regular",
    "sar2_killer_regular",
    "sar2_killer_informator",
    "sar2_svoboda_cook",
    "sar2_svoboda_bodyguard",
    "sar2_svoboda_stukach",
    "sar2_esc_soldier_commander",
    "sar2_zombied_stalker",
    "sar2_soldier_specnaz",
    "sar2_killer_specnaz",
    "sar2_dolg_specnaz_cherep",
    "sar2_svoboda_blockpost_leader",
    "sar2_dolg_guard_commander",
    "sar2_dolg_ivancov",
    "sar2_dolg_petrenko",
    "sar2_dolg_leader",
    "sar2_svoboda_attack_commander",
    "sar2_crazy_veterans_lucky",
    "sar2_svoboda_engineer",
    "sar2_svoboda_leader",
    "sar2_svoboda_trader",
    "sar2_svoboda_master_max",
    "sar2_monolith_specnaz2",
    "sar2_monolith_specnaz",
    "sar2_svoboda_master_ugrumiy",
    "sar2_arena_savage",
    "sar2_zombied_exo",
    "sar2_monolith_leader",
    "sar2_killer_ambush_tiran",
    "sar2_killer_exo",
    "sar2_soldier_stalker",
    "sar2_monolith_exo",
    "sar2_monolith_exo2"
}
--]]

local sar2_heroes_sel_number, sar2_heroes_number = 0, 60
local sar2_heroes_count, sar2_heroes_max_count = 0, 6
local sar2_hero_next_free_id = 1
local sar2_heroes_sel = {}

function sar2_scene_start(actor, npc)
    -- printf("effects <sar2>: scene start initializing.")
    local i = 0
    
    sar2_heroes_sel = {}
    sar2_heroes_sel_number = 0
    sar2_hero_next_free_id = 1
    for i = 1, sar2_heroes_number do
        if has_alife_info("sar2_death_" .. i) then
            table.insert(sar2_heroes_sel, i)
            sar2_heroes_sel_number = sar2_heroes_sel_number + 1
        end
    end

    -- print_table(sar2_heroes_sel)
    -- printf("effects <sar2>: scene end initializing.")
end

function sar_hero_dead(actor, npc)
    actor:give_info_portion("sar2_monolith_rock")

    if sar2_heroes_count > 0 then
        sar2_heroes_count = sar2_heroes_count - 1
    end

    if sar2_heroes_count == 0 and sar2_hero_next_free_id > sar2_heroes_sel_number then
        actor:give_info_portion("sar2_monolith_end")
    end

    printf("effects <sar2>: hero dead.")
end

function sar2_hero_spawn(actor, npc)
    printf("effects <sar2>: hero count - %d, max - %d.", sar2_heroes_count, sar2_heroes_max_count)
    local c = sar2_heroes_max_count - sar2_heroes_count

    -- check if we need to spawn stalkers
    if sar2_hero_next_free_id <= sar2_heroes_sel_number and c > 0 then
        local i, n = 0, math.min(sar2_hero_next_free_id + c - 1, sar2_heroes_sel_number)

        for i = sar2_hero_next_free_id, n do
            actor:give_info_portion("sar2_spawn_" .. sar2_heroes_sel[i])
        end

        if n >= sar2_hero_next_free_id then
            printf("effects <sar2>: hero spawn.")
        end
        
        sar2_heroes_count = sar2_heroes_count + (n - sar2_hero_next_free_id + 1)
        sar2_hero_next_free_id = n + 1
    end
end

-------------------------------------------------------------------------------------
-- Функции для работы с вертолётами
-------------------------------------------------------------------------------------

function heli_set_enemy_actor(actor, npc)
	local st = db.storage[npc:id()]
	if not st.combat.enemy_id and actor:alive() then
		st.combat.enemy_id = actor:id()

		heli_snd.play_snd( st, heli_snd.snd_see_enemy, 1 )
	end 
end

function heli_set_enemy(actor, npc, p)
	local st  = db.storage[npc:id()]
	local obj = level_object_by_sid( p[1] )

	if not st.combat.enemy_id and obj:alive() then
		st.combat.enemy_id = obj:id()

		heli_snd.play_snd( st, heli_snd.snd_see_enemy, 1 )
	end
end

function heli_clear_enemy(actor, npc)
    db.storage[npc:id()].combat:forget_enemy()
end

function heli_start_flame(actor, npc)
	bind_heli.heli_start_flame( npc )
end

function heli_die(actor, npc)
	bind_heli.heli_die( npc )
end


-------------------------------------------------------------------------------------
-- Функции для работы с погодными эффектами
-------------------------------------------------------------------------------------
function start_small_reject (actor, npc)
    level.set_weather_fx ("surge_day")
	level.add_pp_effector ("vibros_p.ppe", 1974, false)
	this.aes_earthshake (npc)
    --set_postprocess ("scripts\\postprocess1.ltx")
end

function start_full_reject (actor, npc)
    level.set_weather_fx ("surge_day")
    level.remove_pp_effector (1974)
    level.add_pp_effector ("vibros.ppe", 1974, false)
    --set_postprocess ("scripts\\postprocess.ltx")
end


function aes_grenade_explode (actor, npc)
    local obj = level_object_by_sid (1101)
    if obj == nil then return end
    local h = hit ();
    h.power = 1000;
    h.direction = vector():set (1, 0, 0);
    h.impulse = 1;
    h.draftsman = obj;
    h.type = hit.chemical_burn;
    obj:hit (h);
end

function aes_kill_actor (actor, npc)
    if actor ~= nil and actor.health > 0 then 
       actor:kill (actor)
    end   
end

function set_sidorovich_animation (npc)
    local sidor = level_object_by_sid (1118)
    if sidor == nil then
       abort ("SIDOROVICH NOT FOUND !!!")
    end
    --sidor:clear_animations ()
    sidor:play_cycle ("wonder", true)
    --sidor:add_animation ("idle_looped", true, false)
end

function aes_zombie_hit1 (npc)
    --local npc = level_object_by_sid (1119)
    --local force = vector ():set (0, 0, 0.02)
    --local pshell = npc:get_physics_shell ()
    
    --local joint = pshell:get_joint_by_bone_name ("head2")
    --joint:set_max_force_and_velocity (0.5 + math.random (), 0.1 * -1, 0)
    --joint:set_max_force_and_velocity (0.5 + math.random(), 0.1 * -1,  2)
    
    --local npc = level_object_by_sid (1119)
    --local force = vector ():set (0, 0, 50)
    --local pshell = npc:get_physics_shell ()
    --local element = pshell:get_element_by_bone_name ("foot_right")
    --element:apply_force (force.x, force.y, force.z)
    
    -- foot_right, foot_left, left_hand, right_hand
        
    
    --local dir = npc:direction ()
    --dir.y = 0.0
    --dir:normalize ()
	--npc:set_const_force (dir, 2000, 3)
	
    --npc = level_object_by_sid (1120)
    --dir = npc:direction ()
    --dir.y = 0.0
    --dir:normalize ()   
	--npc:set_const_force (dir, 2000, 3)
	
    --npc = level_object_by_sid (1121)
    --dir = npc:direction ()
    --dir.y = 0.0
    --dir:normalize ()   
	--npc:set_const_force (dir, 2000, 3)
	
    --npc = level_object_by_sid (1122)
    --dir = npc:direction ()
    --dir.y = 0.0
    --dir:normalize ()   
	--npc:set_const_force (dir, 2000, 3)
	
    --npc = level_object_by_sid (1123)
    --dir = npc:direction ()
    --dir.y = 0.0
    --dir:normalize ()   
	--npc:set_const_force (dir, 2000, 3)
end

function aes_zombie_hit2 (npc)
    --local npc = level_object_by_sid (1119)
    --local force = vector ():set (0, 0, 50)
    --local pshell = npc:get_physics_shell ()
    --local element = pshell:get_element_by_bone_name ("foot_right")
    --element:apply_force (force.x, force.y, force.z)
    
    
    --local npc = level_object_by_sid (1119)
    --local force = vector ():set (0, 0, 0.02)
    --local pshell = npc:get_physics_shell ()
    
    --local joint = pshell:get_joint_by_bone_name ("head2")
    --joint:set_max_force_and_velocity (0.5 + math.random (), 0.1 * 1, 0)
    --joint:set_max_force_and_velocity (0.5 + math.random(), 0.1 * 1,  2)
                --self.dir_x_axis  = self.dir_x_axis * (-1)
                --self.dir_z_axis = self.dir_z_axis * (-1)
                --self.time    = device():time_global() + math.random(800, 1000)
        --end
    
    --local element = pshell:get_element_by_bone_name ("foot_right")
    --element:apply_force (force.x, force.y, force.z)
    --local npc = level_object_by_sid (1119)
    --local dir = npc:direction ()
    --dir.y = 0.0
    --dir.x = -dir.x
    --dir.z = -dir.z
    --dir:normalize ()
	--npc:set_const_force (dir, 2000, 3)
	
    --npc = level_object_by_sid (1120)
    --dir = npc:direction ()
    --dir.y = 0.0
    --dir.x = -dir.x
    --dir.z = -dir.z
    --dir:normalize ()   
	--npc:set_const_force (dir, 2000, 3)
	
    --npc = level_object_by_sid (1121)
    --dir = npc:direction ()
    --dir.y = 0.0
    --dir.x = -dir.x
    --dir.z = -dir.z
    --dir:normalize ()   
	--npc:set_const_force (dir, 2000, 3)
	
    --npc = level_object_by_sid (1122)
    --dir = npc:direction ()
    --dir.y = 0.0
    --dir.x = -dir.x
    --dir.z = -dir.z
    --dir:normalize ()   
	--npc:set_const_force (dir, 2000, 3)
	
    --npc = level_object_by_sid (1123)
    --dir = npc:direction ()
    --dir.x = -dir.x
    --dir.z = -dir.z
    --dir.y = 0.0
    --dir:normalize ()   
	--npc:set_const_force (dir, 2000, 3)
end

-- постпроцесс и влияние удара в морду
function aes_earthshake (npc)
	if not has_alife_info("freeplay") then
		local snd_obj = xr_sound.get_safe_sound_object([[ambient\earthquake]])
		if snd_obj then
			snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
		end
		-- nv080417 permit disabling of earthshake
		if disable_npp_earthshaking then return end
		level.add_cam_effector("camera_effects\\earthquake.anm", 1974, false, "")
		--set_postprocess ("scripts\\earthshake.ltx")
	end
end

function vovan_camera_test (npc)
	level.add_cam_effector("camera_effects\\test.anm", "")	                  
end
-------------------------------------------------------------------------------------
-- Функции для Янтаря
----------------------------------------------------------------------------------
function yan_actor_sleep (actor, npc)
	db.actor:set_actor_position(patrol("yan_actor_sleep"):point(0))
	local dir = patrol("yan_actor_sleep"):point(1):sub(patrol("yan_actor_sleep"):point(0))
	db.actor:set_actor_direction(-dir:getH())
end

function yan_actor_sleep_1 (actor, npc)
	db.actor:set_actor_position(patrol("yan_actor_sleep_1"):point(0))
	local dir = patrol("yan_actor_sleep_1"):point(1):sub(patrol("yan_actor_sleep_1"):point(0))
	db.actor:set_actor_direction(-dir:getH())
end

function yan_dream_voices (actor, npc)
        local sound_obj_l		= xr_sound.get_safe_sound_object( [[characters_voice\scenario\yantar\dream_talk_l]] )
        local sound_obj_r		= xr_sound.get_safe_sound_object( [[characters_voice\scenario\yantar\dream_talk_r]] )
        if sound_obj_l then
			sound_obj_l:play_no_feedback(actor, sound_object.s2d, 0, vector():set(-1, 0, 1), 1.0)
		end
		if sound_obj_r then
			sound_obj_r:play_no_feedback(actor, sound_object.s2d, 0, vector():set( 1, 0, 1), 1.0)
		end
end

function yan_gluk (actor, npc)
		
		local sound_obj_l		= xr_sound.get_safe_sound_object( [[affects\psy_blackout_l]] )
        local sound_obj_r		= xr_sound.get_safe_sound_object( [[affects\psy_blackout_r]] )
        
		if sound_obj_l then
			sound_obj_l:play_no_feedback(actor, sound_object.s2d, 0, vector():set(-1, 0, 1), 1.0)
		end
		if sound_obj_r then
			sound_obj_r:play_no_feedback(actor, sound_object.s2d, 0, vector():set( 1, 0, 1), 1.0)
		end
	level.add_cam_effector("camera_effects\\earthquake.anm", 1974, false, "")

end
function x18_gluk (actor, npc)
		level.add_pp_effector ("blink.ppe", 234, false)
		local sound_obj_l		= xr_sound.get_safe_sound_object( [[affects\psy_blackout_l]] )
        local sound_obj_r		= xr_sound.get_safe_sound_object( [[affects\psy_blackout_r]] )
        local snd_obj			= xr_sound.get_safe_sound_object( [[affects\tinnitus3a]] )
		
		if snd_obj then
			snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
		end
		if sound_obj_l then
			sound_obj_l:play_no_feedback(actor, sound_object.s2d, 0, vector():set(-1, 0, 1), 1.0)
		end
		if sound_obj_r then
			sound_obj_r:play_no_feedback(actor, sound_object.s2d, 0, vector():set( 1, 0, 1), 1.0)
		end
		
	level.add_cam_effector("camera_effects\\earthquake.anm", 1974, false, "")

end



function yan_sleep_not_relocate (actor, npc)
		db.actor:actor_sleep(0, 180)
end
function yantar_kruglov_talk(actor,npc)
	xr_sound.set_sound_play(npc, "rostok_kruglov_help_6")
end

function yantar_professor_spam_1 (actor, npc)
    news_manager.send_tip(db.actor, "general_ecolog_tip_1", nil, "saharov", nil, 902)
end

function yantar_professor_spam_2 (actor, npc)
    news_manager.send_tip(db.actor, "general_ecolog_tip_2", nil, "saharov", nil, 902)
end

function yantar_vasilyev_spam (actor, npc)
    news_manager.send_tip(db.actor, "storyline_vasilyev_tip", nil, "ecolog", nil, 903)
end
function yan_saharov_message (actor, npc)
    news_manager.send_tip(db.actor, "yan_saharov_message", nil, "saharov", nil, 902)
    db.actor:give_info_portion("labx16_find")
end

function yan_saharov_message_2 (actor, npc)
    news_manager.send_tip(db.actor, "yan_saharov_message_2", nil, "saharov", nil, 902)
end
function yan_saharov_message_3 (actor, npc)
    news_manager.send_tip(db.actor, "yan_saharov_message_3", nil, "saharov", nil, 902)
end
function yan_ghost_pda (actor, npc)
    if has_alife_info("agr_gunslinger_flash_have") then 
        db.actor:give_info_portion("yan_provodnik_spawn")
    end
    news_manager.send_tip(db.actor, "storyline_ghost_tip", nil, "wolf")
end

function start_yantar_dream(actor, npc)
	game.start_tutorial("yantar_dream")
end

function end_yantar_dream(actor, npc)
	db.actor:give_info_portion("yantar_find_ghost_task_start")
end
-----------------------------radar
function rad_sos_spam(actor, npc)
	news_manager.send_tip(actor, "tips_rad_sos_suicide", nil, "stalker", nil, 1004)
end


function monolith_generator_hit (actor, npc)
    printf ("ON GENERATOR HIT !!!")
end


function start_x18_dream(actor, npc)
	game.start_tutorial("x18_dream")
end
function end_x18_dream(actor, npc)
	db.actor:give_info_portion("dar_x18_dream")
end

function aes_final_movie(actor, npc)
	db.actor:give_info_portion("game_end")
	game.start_tutorial("mov_refuse_osoznanie")
end
------------------------------------------------------------------------------------
-- Функции для Радара
------------------------------------------------------------------------------------
function rad_psi_hit (actor, npc)
	level.add_pp_effector ("radar_psi.ppe", 2006, false)
end

function start_radar_dream(actor, npc)
	game.start_tutorial("radar_dream")
end

function end_radar_dream(actor, npc)
	db.actor:give_info_portion("bun_patrol_start")
end
------------------------------------------------------------------------------------
-- Функции для саркофага
------------------------------------------------------------------------------------
function destroy_monolith_generator(actor, npc)
    local source = nil
    local sim = alife()
    if sim then
       local se_obj = sim:story_object(1305)  
       if se_obj then
          source = level.object_by_id(se_obj.id)
       end
    end

    if source == nil then
       abort ("MONOLITH GENERATOR story id 1305 not found")
       return
    end

    local h = hit ();
    h.power = 1000000;
    h.direction = vector():set( 1, 0, 0 );
    h.impulse = 1;
    h.draftsman = source;
    h.type = hit.chemical_burn;
    source:hit (h);        
end

function sar_monolith_miracle(actor, npc)
	--' Убил лидеров группировок
	if has_alife_info("mil_lukash_dead") and
	   has_alife_info("bar_voronin_dead")
	then
		game.start_tutorial("mov_desire_3")
		return
	end

	--' Много денег
	if db.actor:money() >= 200000 then
		game.start_tutorial("mov_desire_2")	
		return
	end

	--' Хорошая репутация
	if db.actor:character_reputation() >= 1000 then
		game.start_tutorial("mov_desire_1")	
		return
	end

	--' плохая репутация
	if db.actor:character_reputation() <= -1000 then
		game.start_tutorial("mov_desire_4")	
		return
	end

	game.start_tutorial("mov_desire_5")	
end

function game_credits(actor, npc)
	db.gameover_credits_started = true
	game.start_tutorial("credits_seq")
end

function game_over(actor, npc)
	if db.gameover_credits_started ~= true then
		return
	end
	local c = get_console()
--	c:execute("disconnect")
	printf("main_menu on console command is executed")
	c:execute("main_menu on")
end

function after_credits(actor, npc)
	if db.gameover_credits_started ~= true then
		return
	end
	local c = get_console()
	c:execute("disconnect")
end


function pri_game_over(actor, npc)
	local c = get_console()
--	c:execute("disconnect")
	printf("main_menu on console command is executed")
	c:execute("main_menu on")
end

function esc_init_dialod ()
	local trader = level_object_by_sid(003)
	db.actor:run_talk_dialog(trader)
end

function oso_init_dialod ()
	-- local oso = level_object_by_sid(1307)
	-- db.actor:run_talk_dialog(oso)
end
-- DELME:only for presentation!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

function actor_inventory_by_levels ()
	local level = level.name()
    local spawn_items = {}
    local start_point = ""
    
	if level == "l03_agroprom" then
		start_point = "agr_start_actor"	
	elseif level == "l05_bar" then
		start_point = "bar_way_if_reject_to_gar"			
	elseif level == "l08_yantar" then
		start_point = "yan_start_actor"			
	elseif 	level == "l11_pripyat" then
		start_point = "pri_way_if_reject_to_rad"	
	end
	db.actor:set_actor_position(patrol(start_point):point(0))
	local dir = patrol(start_point):point(1):sub(patrol(start_point):point(0))
	db.actor:set_actor_direction(-dir:getH())
	
end

function presentation_tutorial ()
		
end

function presentation_task ()
	
end






function change_leader(actor, npc)
	if xr_gulag.getGulagPopulation(823) == 0 then
		db.actor:give_info_portion("pri_followers_all_dead")
	end
end

function on_tutor_gameover_stop()
	local c = get_console()
--	c:execute("disconnect")
	printf("main_menu on console command is executed")
	c:execute("main_menu on")
end

function actor_stop_sleeping()
	sleep_manager.stopper()
end

function esc_actor_is_enemy(actor, npc)			
    xr_gulag.setGulagEnemy("esc_lager", db.actor)
end

------------------------------------------------------------------------------------------------------------------------------

function disable_trading(actor, npc)
  npc:disable_trade()
end

function enable_trading(actor, npc)
  npc:enable_trade()
end

function disable_trading_by_sid(actor, npc, p)
    local npc
	for i, v in pairs(p) do
		npc = level_object_by_sid(v)
		if npc and npc:alive() then
			npc:disable_trade()
		end
	end
end

------------------------------------------------------------------------------------------------------------------------------
function make_invulnerable(actor, npc)
  npc:invulnerable(true)
end

function unmake_invulnerable(actor, npc)
  npc:invulnerable(false)
end
------------------------------------------------------------------------------------------------------------------------------

function esc_heli_crash_death()
local pos = db.actor:position()
if db.actor:alive() then
	local fx_particle_1 = "anomaly2\\group_items\\electra2_flash"
	fx_particle_1 = particles_object(fx_particle_1)
	fx_particle_1:play_at_pos(pos)
	db.actor:kill(db.actor)
	soundtrack.heli_crash_death()
end
end

function esc_heli_crash_ppe()
	if db.actor:dont_has_info("esc_heli_crash_uncharged") then
	level.add_pp_effector("escape.ppe", 999, false)
	end
end
----------------------------------------------------------------------------------------------------------------------------
function esc_underbridge_zone_death()
if db.actor:object("af_guider") == nil then
local pos = db.actor:position()
local fx_particle_1 = "anomaly2\\group_items\\body_tear_blood_01"
fx_particle_1 = particles_object(fx_particle_1)
	if ( db.actor:dont_has_info("helicrash_survival_free") and db.actor:dont_has_info("helicrash_survival_free") ) then 
	fx_particle_1:play_at_pos(pos)
	db.actor:kill(db.actor)
	soundtrack.esc_underbridge_death()
	soundtrack.bone_breaking()
	end
end
end

function esc_underbridge_zone_ppe()
if db.actor:object("af_guider") == nil then
	if db.actor:dont_has_info("underbridge_zone_uncharged") then
	level.add_pp_effector("dead_zone.ppe", 9, false)
	end
end
end
--------------------------------------------------------------------------------------------------------------------------------

function abdul_wound_effect()
local fx_particle = "anomaly2\\burer_shield_01"
local obj = level_object_by_sid(8070)
local pos = obj:position()
snd = sound_object([[weapons\whine_4]])
fx_particle = particles_object(fx_particle)
fx_particle:play_at_pos(pos)
snd:play_no_feedback(obj, sound_object.s3d, 0, obj:position(), 1.0)
end



function sleep_place_use()
	local murder = starvation.get_murder()
	if murder<0.4 then
		soundtrack.actor_sleep_place_use_snd()
		sleep_manager.use_matras()
	elseif murder>0.4 then
		soundtrack.arts_activation_interface_acess()
		local st = get_hud():GetCustomStatic("actor_cant_sleep_think") or get_hud():AddCustomStatic("actor_cant_sleep_think",true)
		st.m_endTime = time_global()/1000 + 5
		news_manager.send_tip(db.actor, "doll_try_to_sleep_tip", nil, "doll", 7000)
	end
end



function drop_npc_item2(actor, npc, p)
    if p[1] then
for i = 0, db.actor:object_count() - 1 do
local obj = db.actor:object(i)
        if obj and not (system_ini():line_exist(obj:section(), "quest_item") and system_ini():r_bool(obj:section(), "quest_item"))
			and not (system_ini():line_exist(obj:section(), "is_torch") and system_ini():r_bool(obj:section(), "is_torch"))
			and not (system_ini():line_exist(obj:section(), "is_pda") and system_ini():r_bool(obj:section(), "is_pda"))
			and not (system_ini():line_exist(obj:section(), "is_gps") and system_ini():r_bool(obj:section(), "is_gps"))
			and not (system_ini():line_exist(obj:section(), "is_knife") and system_ini():r_bool(obj:section(), "is_knife"))
			and not (system_ini():line_exist(obj:section(), "is_bino") and system_ini():r_bool(obj:section(), "is_bino")) then
		    db.actor:drop_item(obj)
	end
        end
    end
end


--function drop_npc_item2(actor, npc, p)
-- local pos = p and p[1] and patrol(p[1]):point( 0 ) or actor:position()
-- local ini = system_ini()
-- actor:iterate_inventory(function(_,obj) 
--  if not utils.cfg_get_bool(ini, obj:section(), "quest_item", obj, false, false)
--or not utils.cfg_get_bool(ini, obj:section(), "is_bino", obj, false, false)
--or not utils.cfg_get_bool(ini, obj:section(), "is_torch", obj, false, false)
--or not utils.cfg_get_bool(ini, obj:section(), "is_pda", obj, false, false)
--or not utils.cfg_get_bool(ini, obj:section(), "is_gps", obj, false, false)
--or not utils.cfg_get_bool(ini, obj:section(), "is_knife", obj, false, false)  then
--   actor:drop_item_and_teleport(obj, pos)
--  end
-- end)
--end


function actor_goto_post_prison()
	db.actor:set_actor_position(vector():set(-117.88,-30.03,-389.25), 136564, 27)
	level.add_pp_effector("deadcity_wake_old.ppe", 2007, false)
	level.add_cam_effector("camera_effects\\prison_1.anm", 100, false, "")
	addon_dialogs.put_items_to_post_box()
	--start_real_timer(1, "timer_actions.esc_post_prison_timer_action1")
	db.actor:give_info_portion ("post_matugalnik_off")
	db.actor:give_info_portion("blokpost_alarm_off")
end


function post_patrol_scream()
addon_dialogs.post_patrol_scream()
end

function lift_up_effect()
local fx_particle = "anomaly2\\group_items\\bloodsucker_flash_00"
local pos = db.actor:position()
db.actor:set_actor_position(db.actor:position():add(vector():set(0,7,0)))
soundtrack.lift_up()
fx_particle = particles_object(fx_particle)
fx_particle:play_at_pos(pos)
end


function release_esc_post_seif()
local obj = alife():story_object(8134)
  if obj then
   alife():release(obj , true)
  end
end 

function esc_post_seif_spawn()
alife():create("esc_post_seif_shron", vector():set (-122.60,-30.05,-371.50), 130145, 25)
end

function release_esc_kamp_seif()
local obj = alife():story_object(8218)
  if obj then
   alife():release(obj , true)
  end
end 

function esc_kamp_seif_spawn()
alife():create("esc_kamp_seif_shron", vector():set (1.70,-17.84,-163.34), 277759, 108)
end


function post_kazarma_door_shans_think()
local st = get_hud():GetCustomStatic("post_kazarma_door_shans_think") or get_hud():AddCustomStatic("post_kazarma_door_shans_think",true)
st.m_endTime = time_global()/1000 + 6
end

function release_esc_house1_seif()
local obj = alife():story_object(8277)
  if obj then
   alife():release(obj , true)
  end
end 

function esc_house1_seif_spawn()
alife():create("esc_house1_seif_shron", vector():set (-166.90,-20.01,-128.98), 81353, 55)
end

function blokpost_alarm_timer_start()
	start_real_timer(45, "timer_actions.esc_post_prison_timer_action2")
	db.actor:give_info_portion("kazarma_door_broken")
end

function esc_post_sniperkill()
local obj1 = level_object_by_sid(8131)
local pos1 = obj1:position()
local obj2 = level_object_by_sid(8132)
local pos2 = obj1:position()
local snd_obj1 = xr_sound.get_safe_sound_object([[weapons\svu_shoot]])
snd_obj1:play_at_pos(obj1, obj1:position(), 0, sound_object.s3d)
local snd_obj2 = xr_sound.get_safe_sound_object([[weapons\svu_shoot]])
snd_obj2:play_at_pos(obj2, obj2:position(), 0, sound_object.s3d)
db.actor:kill(db.actor)
news_manager.send_tip(db.actor, "blokpost_alarm_tip3", nil, "army", 10000, nil)
end

function srochnik3_init_dialod()
	local npc = level_object_by_sid(8133)
	db.actor:run_talk_dialog(npc)
end

function blokpost_enemy()
if has_alife_info("kazarma_door_broken") then
addon_dialogs.blokpost_enemy()
end
end

function blokpost_enemy2()
addon_dialogs.blokpost_enemy()
end

function disable_input()
level.disable_input()
end

function enable_input()
level.enable_input()
end

function post_comander_init_dialod()
	local npc = level_object_by_sid(8118)
	db.actor:run_talk_dialog(npc)
end

--------------------------------------------------------------------------------------------------------------------------------------------------------


-- Гнезда монстров -----------------------------------------------------------------------------------------------------------------------------

function start_nest_esc_atp_timer()
-- amk.g_start_timer("nest_esc_atp",0,10,0)
end

function nest_esc_atp_respawn()
alife():create("esc_atp_zombie1", vector():set (113.08,-7.68,-17.48), 415534, 115)
alife():create("esc_atp_zombie2", vector():set (113.08,-7.68,-17.48), 415534, 115)
alife():create("esc_atp_zombie3", vector():set (113.08,-7.68,-17.48), 415534, 115)
alife():create("esc_atp_zombie4", vector():set (113.08,-7.68,-17.48), 415534, 115)
alife():create("esc_atp_zombie5", vector():set (113.08,-7.68,-17.48), 415534, 115)
alife():create("esc_atp_zombie6", vector():set (113.08,-7.68,-17.48), 415534, 115)
alife():create("esc_atp_zombie7", vector():set (113.08,-7.68,-17.48), 415534, 115)
alife():create("esc_atp_zombie8", vector():set (113.08,-7.68,-17.48), 415534, 115)
-- addon_dialogs.spawn_esc_atp_controler()
news_manager.send_tip(db.actor, "esc_atp_nest_respawned", nil, nil, 7000, nil)
end

function esc_atp_controler_agress()
	if db.actor:dont_has_info("esc_atp_controler_agress") then
		db.actor:give_info_portion ("esc_atp_controler_agress")
		addon_dialogs.atp_controler_agress_texture()
		-- soundtrack.esc_atp_controler_agress()
	end
end


function esc_atp_controler_calm()
if has_alife_info("malandrinus_before_atp") and db.actor:dont_has_info("esc_atp_controler_dead") then
	news_manager.send_tip(db.actor, "esc_atp_controler_calm_tip", nil, "maland", 8000, nil)
end
end




function start_nest_esc_miln_timer()
-- amk.g_start_timer("nest_esc_miln",0,10,0)
end

function nest_esc_miln_respawn()
alife():create("esc_miln_zombie1", vector():set (-14.97,2.48,65.21), 262390, 88)
alife():create("esc_miln_zombie2", vector():set (-14.97,2.48,65.21), 262390, 88)
alife():create("esc_miln_zombie3", vector():set (-14.97,2.48,65.21), 262390, 88)
alife():create("esc_miln_zombie4", vector():set (-14.97,2.48,65.21), 262390, 88)
alife():create("esc_miln_zombie5", vector():set (-14.97,2.48,65.21), 262390, 88)
alife():create("esc_miln_zombie6", vector():set (-14.97,2.48,65.21), 262390, 88)
alife():create("esc_miln_zombie7", vector():set (-14.97,2.48,65.21), 262390, 88)
alife():create("esc_miln_zombie8", vector():set (-14.97,2.48,65.21), 262390, 88)
alife():create("esc_miln_zombie9", vector():set (-14.97,2.48,65.21), 262390, 88)
alife():create("esc_miln_zombie10", vector():set (-14.97,2.48,65.21), 262390, 88)
news_manager.send_tip(db.actor, "esc_miln_nest_respawned", nil, nil, 7000, nil)
end


function start_nest_garb_angar_timer()
-- amk.g_start_timer("nest_garb_angar",0,10,0)
end

function nest_garb_angar_respawn()
alife():create("garb_hangar_burer_boss", vector():set (-84.94,0.43,11.76), 122540, 328)
alife():create("garb_hangar_burer1", vector():set (-84.94,0.43,11.76), 122540, 328)
alife():create("garb_hangar_burer2", vector():set (-84.94,0.43,11.76), 122540, 328)
alife():create("garb_hangar_burer3", vector():set (-84.94,0.43,11.76), 122540, 328)
alife():create("garb_hangar_burer4", vector():set (-84.94,0.43,11.76), 122540, 328)
news_manager.send_tip(db.actor, "nest_garb_angar_respawned", nil, nil, 7000, nil)
end

function musorka_monstr_spawn()
 local sim = alife()
 local sobj = sim:create("musorka_monstr", vector():set (-270.34,-9.79,-59.79), 3003, 66)
 sim:assign_story_id(sobj.id, story_ids.musorka_monstr)
end

function musorka_monstr_slow()
if db.actor:dont_has_info("musorka_monstr_dead") then
	addon.actor_always_hit()
end
end


function start_nest_bar_bunker_timer()
-- amk.g_start_timer("nest_bar_bunker",0,10,0)
end

function nest_bar_bunker_respawn()
alife():create("bar_bunkerzombie_boss", vector():set (223.47,-5.44,127.20), 56041, 1198)
alife():create("bar_bunkerzombie1", vector():set (223.47,-5.44,127.20), 56041, 1198)
alife():create("bar_bunkerzombie2", vector():set (223.47,-5.44,127.20), 56041, 1198)
alife():create("bar_bunkerzombie3", vector():set (223.47,-5.44,127.20), 56041, 1198)
alife():create("bar_bunkerzombie4", vector():set (223.47,-5.44,127.20), 56041, 1198)
alife():create("bar_bunkerzombie5", vector():set (223.47,-5.44,127.20), 56041, 1198)
alife():create("bar_bunkerzombie6", vector():set (198.67,-0.00,122.01), 47417, 1190)
alife():create("bar_bunkerzombie7", vector():set (198.67,-0.00,122.01), 47417, 1190)
news_manager.send_tip(db.actor, "bar_bunker_nest_respawned", nil, nil, 7000, nil)
end


function start_nest_garb_tunnel_timer()
amk.g_start_timer("nest_garb_tunnel",0,10,0)
end

function nest_garb_tunnel_respawn()
alife():create("garb_tunnel_sos_boss", vector():set (-218.89,0.34,10.42), 19321, 314)
alife():create("garb_tunnel_sos1", vector():set (-218.89,0.34,10.42), 19321, 314)
alife():create("garb_tunnel_sos2", vector():set (-218.89,0.34,10.42), 19321, 314)
alife():create("garb_tunnel_sos3", vector():set (-218.89,0.34,10.42), 19321, 314)
alife():create("garb_tunnel_sos4", vector():set (-218.89,0.34,10.42), 19321, 314)
alife():create("garb_tunnel_sos5", vector():set (-218.89,0.34,10.42), 19321, 314)
news_manager.send_tip(db.actor, "garb_tunnel_nest_respawned", nil, nil, 7000, nil)
end


function start_nest_garb_forest_timer()
amk.g_start_timer("nest_garb_forest",0,5,0)
end

function nest_garb_forest_respawn()
alife():create("garb_forest_pseudodog_boss", vector():set (156.79,-1.03,-178.19), 310566, 406)
alife():create("garb_forest_pseudodog1", vector():set (156.79,-1.03,-178.19), 310566, 406)
alife():create("garb_forest_pseudodog2", vector():set (156.79,-1.03,-178.19), 310566, 406)
alife():create("garb_forest_pseudodog3", vector():set (156.79,-1.03,-178.19), 310566, 406)
alife():create("garb_forest_pseudodog4", vector():set (156.79,-1.03,-178.19), 310566, 406)
alife():create("garb_forest_pseudodog5", vector():set (156.79,-1.03,-178.19), 310566, 406)
news_manager.send_tip(db.actor, "garb_forest_nest_respawned", nil, nil, 7000, nil)
end



---------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- Патрули мерков ------------------------------------------------------------------------------------------------------------------------------------------

function start_esc_headhunters_timer()
amk.g_start_timer("esc_headhunters",0,1,0)
end

function esc_headhunters_spawn()
addon_dialogs.esc_headhunters_spawn()
news_manager.send_tip(db.actor, "esc_headhunters_respawned", nil, nil, 7000, nil)
end


function start_garb_headhunters_timer()
amk.g_start_timer("garb_headhunters",0,1,0)
end

function garb_headhunters_spawn()
addon_dialogs.garb_headhunters_spawn()
news_manager.send_tip(db.actor, "garb_headhunters_respawned", nil, nil, 7000, nil)
end


function start_agr_headhunters_timer()
amk.g_start_timer("agr_headhunters",0,1,0)
end

function agr_headhunters_spawn()
addon_dialogs.agr_headhunters_spawn()
news_manager.send_tip(db.actor, "agr_headhunters_respawned", nil, nil, 7000, nil)
end


function start_dar_headhunters_timer()
amk.g_start_timer("dar_headhunters",0,1,0)
end

function dar_headhunters_spawn()
addon_dialogs.dar_headhunters_spawn()
news_manager.send_tip(db.actor, "dar_headhunters_respawned", nil, nil, 7000, nil)
end

---------------------------------------------------------------------------------------------------------------------------------------------------------------------

function vater_place_use()
local news_text1 = "Набрана фляжка воды"
local news_text2 = "Нужна фляга"
	if db.actor:object("flyaga_empty") ~= nil then
		amk.remove_item(db.actor:object("flyaga_empty"))
		amk.spawn_item_in_inv("flyaga_full")
		db.actor:give_game_news(news_text1, "ui\\ui_iconsTotal", Frect():set(83,470,83,47), 1000, 5000)
		soundtrack.flyaga_bul_bul()
	elseif db.actor:object("unic_flyaga_empty") ~= nil then
		addon.remove_items("unic_flyaga_empty", 1)
		amk.spawn_item_in_inv("unic_flyaga_full")
		db.actor:give_game_news(news_text1, "ui\\ui_iconsTotal", Frect():set(83,470,83,47), 1000, 5000)
		soundtrack.flyaga_bul_bul()
	elseif ( db.actor:object("flyaga_empty") == nil and db.actor:object("unic_flyaga_empty") == nil ) then
		db.actor:give_game_news(news_text2, "ui\\ui_iconsTotal", Frect():set(83,470,83,47), 1000, 5000)
	end
end
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function fuel_place_use()
local news_text1 = "Набрана канистра бензина"
local news_text2 = "Нужна канистра"
	if db.actor:object("mobile_tank_empty") ~= nil then
		amk.remove_item(db.actor:object("mobile_tank_empty"))
		amk.spawn_item_in_inv("mobile_tank_full")
		db.actor:give_game_news(news_text1, "ui\\ui_iconsTotal", Frect():set(83,470,83,47), 1000, 5000)
		soundtrack.water_flow()
	elseif db.actor:object("mobile_tank_empty") == nil then
		db.actor:give_game_news(news_text2, "ui\\ui_iconsTotal", Frect():set(83,470,83,47), 1000, 5000)
	end
end

function fuel_place2_use()
local news_text1 = "Набрана канистра солярки"
local news_text2 = "Нужна канистра"
	if db.actor:object("mobile_tank_empty") ~= nil then
		amk.remove_item(db.actor:object("mobile_tank_empty"))
		amk.spawn_item_in_inv("diesel_tank")
		db.actor:give_game_news(news_text1, "ui\\ui_iconsTotal", Frect():set(83,470,83,47), 1000, 5000)
		soundtrack.water_flow()
	elseif db.actor:object("mobile_tank_empty") == nil then
		db.actor:give_game_news(news_text2, "ui\\ui_iconsTotal", Frect():set(83,470,83,47), 1000, 5000)
	end
end
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function esc_food_boar_spawn_in()
	local obj = level_object_by_sid(8140)

	amk.spawn_item_in_inv("kapsula_1", obj)-- alife():create("kapsula_1", vector(), 0, 0, obj:id())
	amk.spawn_item_in_inv("mutant_boar_leg", obj)-- alife():create("mutant_boar_leg", vector(), 0, 0, obj:id())
end

function esc_atp_controler_spawn_in()
	local obj = level_object_by_sid(5481)
	-- local pos = obj:position()
	amk.spawn_item_in_inv("kapsula_2", obj)-- alife():create("kapsula_2", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
end

function freezer_polter_spawn_in()
	local obj = level_object_by_sid(8221)
	-- local pos = obj:position()
	amk.spawn_item_in_inv("kapsula_3", obj)--alife():create("kapsula_3", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
end
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function malandrinus_gravedigger()
	local obj = level_object_by_sid(8142)
	if obj then
	    local pos = obj:position()
		alife():create("village_cross1", vector():set(pos.x, pos.y-0.5, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		start_real_timer(1, "addon_dialogs.release_blokpost_body1")
	end
end
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function zone1birth1()
addon.spawn_fake_art1()
end

function zone1birth2()
addon.spawn_fake_art2()
end

function zone1birth3()
addon.spawn_fake_art3()
end


function zone2birth1()
addon.spawn_fake_art1()
end

function zone2birth2()
addon.spawn_fake_art2()
end

function zone2birth3()
addon.spawn_fake_art3()
end


function zone3birth1()
addon.spawn_fake_art1()
end

function zone3birth2()
addon.spawn_fake_art2()
end

function zone3birth3()
addon.spawn_fake_art3()
end


function zone4birth1()
addon.spawn_fake_art1()
end

function zone4birth2()
addon.spawn_fake_art2()
end

function zone4birth3()
addon.spawn_fake_art3()
end


function zone5birth1()
addon.spawn_fake_art1()
end

function zone5birth2()
addon.spawn_fake_art2()
end

function zone5birth3()
addon.spawn_fake_art3()
end


function zone6birth1()
addon.spawn_fake_art1()
end

function zone6birth2()
addon.spawn_fake_art2()
end

function zone6birth3()
addon.spawn_fake_art3()
end


function zone7birth1()
addon.spawn_fake_art1()
end

function zone7birth2()
addon.spawn_fake_art2()
end

function zone7birth3()
addon.spawn_fake_art3()
end

---------------------------------------------------------------------------------------------------------------------------------------------------------------

function hit_test_mob()
local h = hit()
h.power = 0.0
h.direction = vector():set (0, 0, 0)
h.impulse = 0
h.draftsman = db.actor
h.type = hit.explosion
	if mob and mob ~= nil and mob:alive() then
	mob:hit(h)
	end
end





function rasstrel()
local npc = level_object_by_sid(8116)
local bw = (wm and wm:get_weapon()) or npc:best_weapon()
	npc:set_sight(look.fire_point, db.actor:bone_position("bip01_spine2"))
	npc:set_item(object.fire1, bw, 1, 4000)
end


function dar_sniper1_shoot_actor()
local npc = level_object_by_sid(8156)
local bw = (wm and wm:get_weapon()) or npc:best_weapon()
	npc:set_sight(look.fire_point, db.actor:bone_position("bip01_spine2"))
	npc:set_item(object.fire1, bw, 10, 4000)
end


function miln_strangers_enemy()
  local npc1 = level_object_by_sid(8158)
if npc1 ~= nil and npc1:alive() then
   npc1:set_relation(game_object.enemy, db.actor)
   npc1:set_goodwill(-5000, db.actor)
   npc1:invulnerable(false)
  end
  local npc2 = level_object_by_sid(8159)
if npc2 ~= nil and npc2:alive() then
   npc2:set_relation(game_object.enemy, db.actor)
   npc2:set_goodwill(-5000, db.actor)
   npc2:invulnerable(false)
  end
  local npc3 = level_object_by_sid(8160)
if npc3 ~= nil and npc3:alive() then
   npc3:set_relation(game_object.enemy, db.actor)
  npc3:set_goodwill(-5000, db.actor)
  npc3:invulnerable(false)
  end
end

function release_miln_key()
amk.remove_item(db.actor:object("miln_key"))
db.actor:give_info_portion ("miln_door_unlock")
end

function miln_strang_flash_spawn()                
alife():create("miln_strang_flash", vector():set (14.07,3.78,91.97), 291555, 93)
end

function miln_stranger2_teleport()                
local fx_particle = "anomaly2\\teleport_out"
local obj = level_object_by_sid(8159)
local pos = obj:position()
local snd = xr_sound.get_safe_sound_object([[anomaly\teleport_work_2]])
fx_particle = particles_object(fx_particle)
fx_particle:play_at_pos(pos)
snd:play_no_feedback(obj, sound_object.s3d, 0, obj:position(), 1.0)
end

function miln_stranger3_teleport()                
local fx_particle = "anomaly2\\teleport_out"
local obj = level_object_by_sid(8160)
local pos = obj:position()
local snd = xr_sound.get_safe_sound_object([[anomaly\teleport_work_2]])
fx_particle = particles_object(fx_particle)
fx_particle:play_at_pos(pos)
snd:play_no_feedback(obj, sound_object.s3d, 0, obj:position(), 1.0)
end


---------------------------------------------------------------------------------------------------------------------------------------------------------------

function delme(actor, npc) -- Самоудаление
 local npc_id = npc:id()
 if db.creature[npc_id]~=nil then
  alife():set_switch_online  (npc:id(), false)
  alife():set_switch_offline (npc:id(), true)
  level.add_call(function() return level.object_by_id(npc_id)==nil end,
  function()
   local sobj = alife():object(npc_id)
   if sobj then
    alife():release(sobj, true)
   end
  end
  )
 else
  local sobj = alife():object(npc_id)
  if sobj then
   alife():release(sobj, true)
  end
 end
end


function delme2(actor, npc, p) -- Самоудаление №2(потому что первое иногда не пашет)
local sobj = alife():object(npc:id())
if sobj then
alife():release(sobj, true)
end
end


function play_teleport_on_me(actor, npc, p) -- Проиграть телепорт
local sobj = alife():object(npc:id())
local pos = sobj.position
local snd = xr_sound.get_safe_sound_object([[anomaly\teleport_work_2]])
local fx_particle = "anomaly2\\teleport_out"
if sobj then
fx_particle = particles_object(fx_particle)
fx_particle:play_at_pos(pos)
snd:play_no_feedback(sobj, sound_object.s3d, 0, sobj.position, 1.0)
end
end

function remove_with_teleport(actor,npc,p) -- Проиграть телепорт и удалить
local pos = npc:position()
local sobj = alife():object( npc:id() )
if sobj then
	local fx_particle = particles_object("anomaly2\\teleport_out")
	fx_particle:play_at_pos(pos)
	local snd = xr_sound.get_safe_sound_object("anomaly\\teleport_work_2")
	snd:play_at_pos(db.actor, pos, 0, sound_object.s3d)
	alife():release(sobj,true)
end
end

function remove_with_teleport2(actor,npc,p) -- Проиграть сиреневую вспышку и удалить
local pos = npc:position()
local sobj = alife():object( npc:id() )
if sobj then
	local fx_particle = particles_object("anomaly2\\plasma_generator_death")
	fx_particle:play_at_pos(pos)
	local snd = xr_sound.get_safe_sound_object("anomaly\\teleport_work_2")
	snd:play_at_pos(db.actor, pos, 0, sound_object.s3d)
	alife():release(sobj,true)
end
end

function play_shield_on_me(actor, npc, p) -- Проиграть грави-щит
local sobj = alife():object(npc:id())
local pos = sobj.position
local snd = xr_sound.get_safe_sound_object([[weapons\whine_4]])
local fx_particle = "anomaly2\\group_items\\teleport_okno_10"
if sobj then
fx_particle = particles_object(fx_particle)
fx_particle:play_at_pos(pos)
snd:play_no_feedback(sobj, sound_object.s3d, 0, sobj.position, 1.0)
end
end

function play_psy_on_me(actor, npc, p) -- Проиграть пси-хрень
local sobj = alife():object(obj:id())
local pos = sobj.position
local fx_particle = "anomaly2\\group_items\\psi_glow"
if sobj then
fx_particle = particles_object(fx_particle)
fx_particle:play_at_pos(pos)
end
end

function play_steam_on_me(actor, npc, p) -- Проиграть пар
local sobj = alife():object(npc:id())
local pos = sobj.position
local fx_particle = "explosions\\group_items\\expl_smoke_dym_03"
if sobj then
fx_particle = particles_object(fx_particle)
fx_particle:play_at_pos(pos)
end
end

function play_blow_on_me(actor,npc,p) -- Проиграть взрыв
local pos = npc:position()
local sobj = alife():object( npc:id() )
if sobj then
	local fx_particle1 = particles_object("explosions\\explosion_04")
	fx_particle1:play_at_pos(pos)
end
end

function play_zomby_blow_on_me(actor,npc,p) -- Проиграть заразный зомбячий взрыв
local pos = npc:position()
local sobj = alife():object( npc:id() )
if sobj then
	local fx_particle1 = particles_object("ogsm\\ogsm_zombieblow")
	fx_particle1:play_at_pos(pos)
end
end

function play_shock_on_me(actor, npc, p) -- Проиграть электроразряд
local sobj = alife():object(npc:id())
local pos = sobj.position
local fx_particle = "anomaly2\\group_items\\electra2_trails"
if sobj then
fx_particle = particles_object(fx_particle)
fx_particle:play_at_pos(pos)
end
end

function play_pumice_particle_on_me(actor, npc, p)
local sobj = alife():object(npc:id())
local pos = sobj.position
local fx_particle = "1935\\artefact\\artefact_electra_00"
if sobj then
fx_particle = particles_object(fx_particle)
fx_particle:play_at_pos(pos)
end
end
--------------------------------------------------------------------------------------------------------------------------------------------------------------

function esc_atp_controler_hitted()                
local fx_particle = "anomaly2\\burer_shield_01"
local obj = level_object_by_sid(5481)
local pos = obj:position()
local snd = xr_sound.get_safe_sound_object([[weapons\whine_4]])
fx_particle = particles_object(fx_particle)
fx_particle:play_at_pos(pos)
snd:play_no_feedback(obj, sound_object.s3d, 0, obj:position(), 1.0)
end








-- Машины ----------------------------------------------------------------------------------------------------------------

function esc_niva_empty_use()
addon_devices.car_intrface_start()
end

function esc_niva_empty_delete()
local obj = alife():story_object(8166)
  if obj then
   alife():release(obj , true)
  end
end

function delete_esc_niva_unfuel()
local obj = alife():story_object(8167)
  if obj then
   alife():release(obj , true)
  end
end

function spawn_esc_niva_empty_unfuel()
 local sim = alife()
 local sobj = sim:create("niva_fake", vector():set (-185.67,-20.21,-163.12), 65575, 52)
 sim:assign_story_id(sobj.id, story_ids.esc_niva_empty_unfuel)
end

function esc_niva_empty_respawn()
alife():create("vehicle_niva2", vector():set (-185.67,-20.21,-163.12), 65575, 52)
amk.remove_item(db.actor:object("mobile_tank_full"))
amk.spawn_item_in_inv("mobile_tank_empty")
soundtrack.water_flow()
	if inventory.belt["anomal_gloves"] then
			xr_effects.karma_up()
	end
end



function dar_zil_empty_use()
addon_devices.car_intrface_start()
end

function dar_zil_empty_delete()
local obj = alife():story_object(8174)
  if obj then
   alife():release(obj , true)
  end
end

function delete_dar_zil_unfuel()
local obj = alife():story_object(8175)
  if obj then
   alife():release(obj , true)
  end
end

function spawn_dar_zil_empty_unfuel()
 local sim = alife()
 local sobj = sim:create("zil_fake", vector():set (120.12,0.44,-33.75), 317403, 980)
 sim:assign_story_id(sobj.id, story_ids.dar_zil_empty_unfuel)
end

function dar_zil_empty_respawn()
alife():create("vehicle_zil_mmz", vector():set (120.12,0.44,-33.75), 317403, 980)
amk.remove_item(db.actor:object("mobile_tank_full"))
amk.spawn_item_in_inv("mobile_tank_empty")
soundtrack.water_flow()
	if inventory.belt["anomal_gloves"] then
			xr_effects.karma_up()
	end
end



function gar_zapor_empty_use()
addon_devices.car_intrface_start()
end

function gar_zapor_empty_delete()
local obj = alife():story_object(8168)
  if obj then
   alife():release(obj , true)
  end
end

function delete_gar_zapor_unfuel()
local obj = alife():story_object(8169)
  if obj then
   alife():release(obj , true)
  end
end

function spawn_gar_zapor_empty_unfuel()
 local sim = alife()
 local sobj = sim:create("zapor_fake", vector():set (53.04,0.42,226.85), 226064, 359)
 sim:assign_story_id(sobj.id, story_ids.gar_zapor_empty_unfuel)
end

function gar_zapor_empty_respawn()
alife():create("vehicle_zaz", vector():set (53.04,0.42,226.85), 226064, 359)
amk.remove_item(db.actor:object("mobile_tank_full"))
amk.spawn_item_in_inv("mobile_tank_empty")
soundtrack.water_flow()
	if inventory.belt["anomal_gloves"] then
			xr_effects.karma_up()
	end
end



function agr_uaz_empty_use()
addon_devices.car_intrface_start()
end

function agr_uaz_empty_delete()
local obj = alife():story_object(8170)
  if obj then
   alife():release(obj , true)
  end
end

function delete_agr_uaz_unfuel()
local obj = alife():story_object(8171)
  if obj then
   alife():release(obj , true)
  end
end

function spawn_agr_uaz_empty_unfuel()
 local sim = alife()
 local sobj = sim:create("uaz_fake", vector():set (-136.08,-0.10,-221.00), 103197, 553)
 sim:assign_story_id(sobj.id, story_ids.agr_uaz_empty_unfuel)
end

function agr_uaz_empty_respawn()
alife():create("vehicle_uazbuhanka", vector():set (-136.08,-0.10,-221.00), 103197, 553)
amk.remove_item(db.actor:object("mobile_tank_full"))
amk.spawn_item_in_inv("mobile_tank_empty")
soundtrack.water_flow()
	if inventory.belt["anomal_gloves"] then
			xr_effects.karma_up()
	end
end



function predb_niva_empty_use()
addon_devices.car_intrface_start()
end

function predb_niva_empty_delete()
local obj = alife():story_object(8639)
  if obj then
   alife():release(obj , true)
  end
end

function delete_predb_niva_unfuel()
local obj = alife():story_object(8640)
  if obj then
   alife():release(obj , true)
  end
end

function spawn_predb_niva_empty_unfuel()
 local sim = alife()
 local sobj = sim:create("niva_fake2", vector():set (-23.72,0.73,356.91), 906669, 2910)
 sim:assign_story_id(sobj.id, story_ids.predb_niva_empty_unfuel)
end

function predb_niva_empty_respawn()
alife():create("vehicle_niva2", vector():set (-23.72,0.73,356.91), 906669, 2910)
amk.remove_item(db.actor:object("mobile_tank_full"))
amk.spawn_item_in_inv("mobile_tank_empty")
soundtrack.water_flow()
	if inventory.belt["anomal_gloves"] then
			xr_effects.karma_up()
	end
end


function esc_niva_empty_info_clear()
db.actor:disable_info_portion("esc_niva_empty_akum")
db.actor:disable_info_portion("esc_niva_empty_wheel1")
db.actor:disable_info_portion("esc_niva_empty_wheel2")
db.actor:disable_info_portion("esc_niva_empty_wheel3")
db.actor:disable_info_portion("esc_niva_empty_wheel4")
db.actor:disable_info_portion("esc_niva_empty_bearing")
db.actor:disable_info_portion("esc_niva_empty_tank")
end

function gar_zapor_empty_info_clear()
db.actor:disable_info_portion("garb_zaz_empty_akum")
db.actor:disable_info_portion("garb_zaz_empty_wheel1")
db.actor:disable_info_portion("garb_zaz_empty_wheel2")
db.actor:disable_info_portion("garb_zaz_empty_wheel3")
db.actor:disable_info_portion("garb_zaz_empty_wheel4")
db.actor:disable_info_portion("garb_zaz_empty_bearing")
db.actor:disable_info_portion("garb_zaz_empty_tank")
end

function agr_uaz_empty_info_clear()
db.actor:disable_info_portion("agr_uaz_empty_akum")
db.actor:disable_info_portion("agr_uaz_empty_wheel1")
db.actor:disable_info_portion("agr_uaz_empty_wheel2")
db.actor:disable_info_portion("agr_uaz_empty_wheel3")
db.actor:disable_info_portion("agr_uaz_empty_wheel4")
db.actor:disable_info_portion("agr_uaz_empty_bearing")
db.actor:disable_info_portion("agr_uaz_empty_tank")
end

function dar_zil_empty_info_clear()
db.actor:disable_info_portion("dar_zil_empty_akum")
db.actor:disable_info_portion("dar_zil_empty_wheel1")
db.actor:disable_info_portion("dar_zil_empty_wheel2")
db.actor:disable_info_portion("dar_zil_empty_wheel3")
db.actor:disable_info_portion("dar_zil_empty_wheel4")
db.actor:disable_info_portion("dar_zil_empty_bearing")
db.actor:disable_info_portion("dar_zil_empty_tank")
end

function predb_niva_empty_info_clear()
db.actor:disable_info_portion("predb_niva_empty_akum")
db.actor:disable_info_portion("predb_niva_empty_wheel1")
db.actor:disable_info_portion("predb_niva_empty_wheel2")
db.actor:disable_info_portion("predb_niva_empty_wheel3")
db.actor:disable_info_portion("predb_niva_empty_wheel4")
db.actor:disable_info_portion("predb_niva_empty_bearing")
db.actor:disable_info_portion("predb_niva_empty_tank")
end

-------------------------------------------------------------------------------------------------------------------------------------------------------

function remove_with_meet(actor,npc,p)
local pos = npc:position()
local sobj = alife():object( npc:id() )
if sobj then
	local fx_particle = particles_object("anomaly2\\group_items\\body_tear_blood_01")
	fx_particle:play_at_pos(pos)
	local snd = xr_sound.get_safe_sound_object("characters_voice\\scenario\\bone_breaking")
	snd:play_at_pos(db.actor, pos, 0, sound_object.s3d)
	alife():release(sobj,true)
	-- amk.start_timer("deathzone",15)
	start_real_timer(15, "timer_actions.esc_deadzone_timer_action")
	db.actor:give_info_portion ("underbridge_zone_uncharged")
end
end
-----------------------------------------------------------------------------------------------------------------------------------------------------------

function play_strike_on_me(actor,npc,p)
local pos = npc:position()
local sobj = alife():object( npc:id() )
if sobj then
	local fx_particle1 = particles_object("explosions\\group_items\\expl_flash_alpha")
	local fx_particle2 = particles_object("explosions\\group_items\\expl_03_wave")
	fx_particle1:play_at_pos(pos)
	fx_particle2:play_at_pos(pos)
	local snd = xr_sound.get_safe_sound_object([[ambient\mon_explosion]])
	snd:play_at_pos(db.actor, pos, 0, sound_object.s3d)
	kill_actor()
	kill_andrey()
	kill_mayor()
end
end

function play_strike_on_me2(actor,npc,p)
local pos = npc:position()
local sobj = alife():object( npc:id() )
if sobj then
	local fx_particle1 = particles_object("explosions\\group_items\\expl_flash_alpha")
	local fx_particle2 = particles_object("explosions\\group_items\\expl_03_wave")
	fx_particle1:play_at_pos(pos)
	fx_particle2:play_at_pos(pos)
	local snd = xr_sound.get_safe_sound_object([[ambient\mon_explosion]])
	snd:play_at_pos(db.actor, pos, 0, sound_object.s3d)
end
end

function kill_actor()
db.actor:kill(db.actor)
	--local hit = hit()
	--hit.direction = vector():set(0, 0, 0)
	--hit.impulse = 0
	--hit.draftsman = db.actor
	--hit.power = 10.0
	--hit.type = hit.explosion
	--db.actor:hit(hit)
end

function kill_andrey()
local npc = level_object_by_sid (8056)
	if npc ~= nil and npc:alive() == true then
	npc:kill(npc)
	end
end

function kill_mayor()
local npc = level_object_by_sid (8193)
	if npc ~= nil and npc:alive() == true then
	npc:kill(npc)
	end
end

function actor_light_hit()
level.add_cam_effector("camera_effects\\head_shot.anm", 999, false, "")
soundtrack.gg_scream()
end
------------------------------------------------------------------------------------------------------------------------------------

function switch_offline(actor,npc) -- переключаемся в оффлайн
local npc_id = npc:id()
--switch_offline(npc)
alife():set_switch_offline (npc:id(), true)
end

function switch_online(actor, npc) -- переключаемся в онлайн
local npc_id = npc:id()
alife():set_switch_online  (npc:id(), false)
end
  
  
  

function health_up(actor,npc) -- самоповышаем здоровье
	if npc.health < 0.5 then npc.health = 1 end
end

function health_down(actor,npc) -- самопонижаем здоровье
	if npc.health > 0.2 then npc.health = 0.2 end
end

function atp_controler_health_down(actor,npc)
	npc.health = 0.002
end

function atp_controler_health_up(actor,npc)
	npc.health = 1
end


function delme_when_lowhealth(actor, npc, p)
local sobj = alife():object(npc:id())
if sobj and npc.health < 0.1 then
alife():release(sobj, true)
end
end
-------------------------------------------------------------------------------------------------------------------------------------

function dar_farm_deadzone_effect()
	local hit = hit()
	hit.direction = vector():set(0, 0, 0)
	hit.impulse = 0
	hit.draftsman = db.actor
	hit.power = 0.4
	hit.type = hit.explosion
	db.actor:hit(hit)
	dar_farm_deadzone_port()
end

function dar_farm_deadzone_port()
	rnd = math.random(1, 5)
	if rnd == 1 then 
		db.actor:set_actor_position(vector():set(-118.72,0.78,-503.14), 38659, 834)
		db.actor:set_actor_direction(0.0,2.0,0.0)
	elseif rnd == 2 then 
		db.actor:set_actor_position(vector():set(-116.21,0.78,-506.13), 41549, 834)
		db.actor:set_actor_direction(0.0,2.0,0.0)
	elseif rnd == 3 then 
		db.actor:set_actor_position(vector():set(-121.33,0.82,-506.20), 36484, 834)
		db.actor:set_actor_direction(0.0,1.0,0.0)
	elseif rnd == 4 then 
		db.actor:set_actor_position(vector():set(-118.71,0.82,-510.35), 38649, 834)
		db.actor:set_actor_direction(0.0,1.0,0.0)  -- верно
	elseif rnd == 5 then 
		db.actor:set_actor_position(vector():set(-118.66,2.76,-505.92), 38655, 834)
		db.actor:set_actor_direction(0.0,2.0,0.0)
	end
end


function garb_deadzone_effect()
	local hit = hit()
	hit.direction = vector():set(0, 0, 0)
	hit.impulse = 0
	hit.draftsman = db.actor
	hit.power = 0.1
	hit.type = hit.explosion
	db.actor:hit(hit)
	garb_deadzone_port()
end

function garb_deadzone_port()
	rnd = math.random(1, 5)
	if rnd == 1 then 
		db.actor:set_actor_position(vector():set(-125.84,-0.12,201.34), 90401, 348)
		db.actor:set_actor_direction(0.0,2.0,0.0)
	elseif rnd == 2 then 
		db.actor:set_actor_position(vector():set(-130.66,0.19,205.42), 87134, 348)
		db.actor:set_actor_direction(0.0,2.0,0.0)
	elseif rnd == 3 then 
		db.actor:set_actor_position(vector():set(-130.17,0.03,211.47), 86488, 348)
		db.actor:set_actor_direction(0.0,1.0,0.0)
	elseif rnd == 4 then 
		db.actor:set_actor_position(vector():set(-125.71,-0.04,211.69), 90408, 348)
		db.actor:set_actor_direction(0.0,1.0,0.0)  -- верно
	elseif rnd == 5 then 
		db.actor:set_actor_position(vector():set(-125.73,-0.50,208.61), 90405, 348)
		db.actor:set_actor_direction(0.0,2.0,0.0)
	end
end


function agr_deadzone_effect()
	local hit = hit()
	hit.direction = vector():set(0, 0, 0)
	hit.impulse = 0
	hit.draftsman = db.actor
	hit.power = 0.1
	hit.type = hit.explosion
	db.actor:hit(hit)
	agr_deadzone_port()
end

function agr_deadzone_port()
	rnd = math.random(1, 5)
	if rnd == 1 then 
		db.actor:set_actor_position(vector():set(114.24,2.09,-170.65), 347791, 639)
		db.actor:set_actor_direction(0.0,2.0,0.0)
	elseif rnd == 2 then 
		db.actor:set_actor_position(vector():set(119.48,2.42,-171.79), 353144, 639)
		db.actor:set_actor_direction(0.0,2.0,0.0)
	elseif rnd == 3 then 
		db.actor:set_actor_position(vector():set(118.77,2.66,-176.77), 352460, 639)
		db.actor:set_actor_direction(0.0,1.0,0.0)
	elseif rnd == 4 then 
		db.actor:set_actor_position(vector():set(115.09,2.65,-177.16), 348461, 639)
		db.actor:set_actor_direction(0.0,1.0,0.0)  -- верно
	elseif rnd == 5 then 
		db.actor:set_actor_position(vector():set(114.03,2.51,-174.82), 347785, 639)
		db.actor:set_actor_direction(0.0,2.0,0.0)
	end
end

--------------------------------------------------------------------------------------------------------------------------------------------------

function abdul_roundfly()
addon_dialogs.spawn_abdul_roundfly_zone()
end
--------------------------------------------------------------------------------------------------------------------------------------------

function spawn_esc_post_pilot()
local obj = level_object_by_sid(8197)
local pos = obj:position()
alife():create("esc_post_pilot", vector():set (-209.09,-23.21,-411.53), 43579, 14)
end

function esc_post_heli_landing_message()
local obj = level_object_by_sid( 8197 )
	if obj:position():distance_to_sqr(db.actor:position())  <= 200*200 then
	news_manager.send_tip(db.actor, "post_heli_to_sit", nil, "soldier", 7000, nil)
	soundtrack.esc_post_heli_landing()
	end
end

function esc_post_heli_to_fly_message()
local obj = level_object_by_sid( 8197 )
	if obj:position():distance_to_sqr(db.actor:position())  <= 200*200 then
	news_manager.send_tip(db.actor, "post_heli_to_fly", nil, "soldier", 7000, nil)
	soundtrack.esc_post_heli_to_fly()
	end
end
-----------------------------------------------------------------------------------------------------------------------------------------


function set_neutral(actor, npc) -- Сделаться нейтральным к ГГ
	npc:set_relation (game_object.neutral, actor)
	npc:set_goodwill(8000, actor)
	npc:set_goodwill(8000, actor)
end

function set_enemy(actor, npc) -- Сделаться врагом к ГГ
	npc:set_relation (game_object.enemy, actor)
	npc:set_goodwill(-5000, actor)
	npc:set_goodwill(-5000, actor)
end

-------------------------------------------------------------------------------------------------------------------------------------------

function suicide(actor, npc)
	local snd_obj = sound_object([[Weapons\walther_shoot]])
	if snd_obj ~= nil then
		snd_obj:play_at_pos(db.actor, npc:position(), sound_object.s3d)
	end
	action(
		npc,
--		particle("hit_fx\\hit_flesh_headshot","bip01_head",particle_params(vector():set(0,0,0.3),vector():set(0,0,0),vector():set(1,0,0)),false),
		particle("hit_fx\\hit_flesh_headshot","bip01_head"),
		cond	(cond.time_end, time_infinite)
	)
	printf("_bp: val_suicide_kill_self: npc='%s'", npc:name())
	local h = hit()
	h.power = 1000
	h.direction = vector_rotate_y(npc:direction(), 90)
	h.bone = "bip01_head"
	h.draftsman = npc 
	h.impulse = 200 --350
	h.type = hit.wound
	npc:hit(h)
end
--------------------------------------------------------------------------------------------------------------------------------------


function esc_camp_freezer_controler_spawn()
 local sim = alife()
 local sobj = sim:create("esc_kamp_controler_good", vector():set (2.95,-16.57,-170.12), 279182, 108)
 sim:assign_story_id(sobj.id, story_ids.kamp_controler)
end

function esc_camp_freezer_art_spawn()
alife():create("master_art_static", vector():set (7.20,-18.58,-159.19), 283524, 108)
end


function kamp_controler_transformation()
local obj = level_object_by_sid(8221)
local pos = obj:position()
local fx_particle1 = "explosions\\group_items\\expl_05_stones"
local fx_particle2 = "explosions\\group_items\\expl_07_flash"
local fx_particle3 = "explosions\\old\\expl_08_flame"
	 local sim = alife()
 local sobj = sim:create("esc_kamp_controler_wild", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
 sim:assign_story_id(sobj.id, story_ids.kamp_controler_wild)
fx_particle1 = particles_object(fx_particle1)
fx_particle2 = particles_object(fx_particle2)
fx_particle3 = particles_object(fx_particle3)
fx_particle1:play_at_pos(pos)
fx_particle2:play_at_pos(pos)
fx_particle3:play_at_pos(pos)
local snd_obj = xr_sound.get_safe_sound_object([[ambient\random\rnd_moan]])
snd_obj:play_at_pos(obj, obj:position(), 0, sound_object.s3d)
end
-------------------------------------------------------------------------------------------------------------------------------------------------------------------

function delete_esc_hunter()
local obj = alife():story_object(8056)
  if obj then
   alife():release(obj , true)
  end
end 

function delete_helicrash_survival()
local obj = alife():story_object(8193)
  if obj then
   alife():release(obj , true)
  end
end 

function delete_abdul()
local obj = alife():story_object(8070)
  if obj then
   alife():release(obj , true)
  end
end 

function actor_on_mine_blow()
local pos = db.actor:position()
local fx_particle1 = "explosions\\explosion_01"
local fx_particle2 = "explosions\\group_items\\expl_10_aftersmoke_01b"
fx_particle1 = particles_object(fx_particle1)
fx_particle2 = particles_object(fx_particle2)
fx_particle1:play_at_pos(pos)
fx_particle2:play_at_pos(pos)
soundtrack.mine_blow()
kill_actor()
end

function actor_on_mine_blow2()
local pos = db.actor:position()
local fx_particle1 = "explosions\\explosion_01"
local fx_particle2 = "explosions\\group_items\\expl_10_aftersmoke_01b"
fx_particle1 = particles_object(fx_particle1)
fx_particle2 = particles_object(fx_particle2)
fx_particle1:play_at_pos(pos)
fx_particle2:play_at_pos(pos)
soundtrack.mine_blow()
end

function garb_vagon_hunters_notebook_use()
	if db.actor:dont_has_info("pre_blowout") then
	addon_devices.garb_vagon_hunters_notebook_use()
	end
end
----------------------------------------------------------------------------------------------------------------------------------------

function garb_cargo_heli_cargo_spawn()
local obj = level_object_by_sid(8228)
local pos = obj:position()
	 local sim = alife()
 local sobj = sim:create("garb_heli_cargo", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
 sim:assign_story_id(sobj.id, story_ids.heli_cargo)
end

function dar_cargo_heli_cargo_spawn()
local obj = level_object_by_sid(8327)
local pos = obj:position()
	 local sim = alife()
 local sobj = sim:create("garb_heli_cargo", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
sim:assign_story_id(sobj.id, story_ids.heli_cargo)
end

function agr_cargo_heli_cargo_spawn()
local obj = level_object_by_sid(8422)
local pos = obj:position()
	 local sim = alife()
 local sobj = sim:create("garb_heli_cargo", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
 sim:assign_story_id(sobj.id, story_ids.heli_cargo)
end

function mil_cargo_heli_cargo_spawn()
local obj = level_object_by_sid(8839)
local pos = obj:position()
	 local sim = alife()
 local sobj = sim:create("garb_heli_cargo", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
 sim:assign_story_id(sobj.id, story_ids.heli_cargo)
end

function esc_help_heli_cargo_spawn()
local obj = level_object_by_sid(8440)
local pos = obj:position()
	 local sim = alife()
 local sobj = sim:create("esc_heli_cargo", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
 sim:assign_story_id(sobj.id, story_ids.esc_heli_cargo)
end




function mark_heli_cargo()
   local obj = alife():story_object(8229)
   local obj_id = obj.id
   if obj_id then
   text = "Груз"
	level.map_add_object_spot_ser(obj_id,"find_item_location",text)
   end
end

function heli_cargo_use()
local obj = alife():story_object(8229)
  if obj then
   alife():release(obj , true)
	addon.heli_cargo_items_spawn()
  end
end

function heli_cargo_use2()
local obj = alife():story_object(8441)
  if obj then
   alife():release(obj , true)
	addon.esc_heli_items_spawn()
  end
end

function mark_esc_heli_cargo()
   local obj = alife():story_object(8441)
   local obj_id = obj.id
   if obj_id then
   text = "Груз" 
	level.map_add_object_spot_ser(obj_id,"find_item_location",text)
   end
end

-------------------------------------------------------------------------------------------------------------------------------------

function spawn_zombie_at_pos(actor, npc, p) -- Заспавнить зомби на позиции(использовать вместе с delme)
local sobj = alife():object(npc:id())
local pos = npc:position()
local snd = xr_sound.get_safe_sound_object([[monsters\zombie\zombie_panic]])
if sobj then
alife():create("pervert_zombied", pos, npc:level_vertex_id(), npc:game_vertex_id())
end
end

function spawn_zombie2_at_pos(actor, npc, p) -- Заспавнить зомби на позиции(используется в 1 определенном случае) -- ПЕРЕДЕЛАТЬ
local sobj = alife():object(npc:id())
-- local pos = sobj.position
local pos = npc:position()
local snd = xr_sound.get_safe_sound_object([[monsters\zombie\zombie_panic]])
if sobj then
	alife():create("pervert_zombied2", pos, npc:level_vertex_id(), npc:game_vertex_id())
end
end

function spawn_bones_at_pos(actor, npc, p) -- Заспавнить кости на позиции(для домовых)
local sobj = alife():object(npc:id())
local pos = npc:position()
local snd = xr_sound.get_safe_sound_object([[soundtrack\agro_u_bloodsucker_meet]])
if sobj then
alife():create("scelet_bone1", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone2", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone2", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone3", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone3", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone4", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
snd:play_no_feedback(sobj, sound_object.s3d, 0, sobj.position, 1.0)
end
end



function garb_mobs_atak_zone1_spawn()
alife():create("izlom_garb_ataker1", vector():set (67.18,0.40,188.17), 238230, 363)
alife():create("izlom_garb_ataker2", vector():set (67.18,0.40,188.17), 238230, 363)
alife():create("izlom_garb_ataker3", vector():set (67.18,0.40,188.17), 238230, 363)
db.actor:disable_info_portion("gar_mobs_atak_zones_recharge")
end

function garb_mobs_atak_zone2_spawn()
alife():create("boar_garb_ataker1", vector():set (106.99,6.79,223.51), 272065, 362)
alife():create("boar_garb_ataker2", vector():set (106.99,6.79,223.51), 272065, 362)
alife():create("boar_garb_ataker3", vector():set (106.99,6.79,223.51), 272065, 362)
end

function garb_mobs_atak_zone3_spawn()
alife():create("pseudo_garb_ataker1", vector():set (95.24,1.20,251.54), 262342, 366)
alife():create("pseudo_garb_ataker2", vector():set (95.24,1.20,251.54), 262342, 366)
alife():create("pseudo_garb_ataker3", vector():set (95.24,1.20,251.54), 262342, 366)
end


function gar_mobs_atak_zones_timer()
start_real_timer(10800, "timer_actions.gar_mobs_atak_timer_action")
end


------------------------------------------------------------------------------------------------------------------------------------------------

function green_sphere_dummy_release()
local obj = alife():story_object(8244)
  if obj then
   alife():release(obj , true)
alife():create("af_green_sphere", db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
  end
end 

function red_sphere_dummy_release()
local obj = alife():story_object(8231)
  if obj then
   alife():release(obj , true)
alife():create("af_red_sphere", db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
  end
end 

function actor_teleport_at_garb_reservuar()
	db.actor:set_actor_position(vector():set(56.00,18.39,95.81), 229801, 356)
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
end
-------------------------------------------------------------------------------------------------------------------------------------------------

function garb_grave_cross_use()
addon_devices.garb_grave_cross_use()
	if db.actor:dont_has_info("garb_3shperes_task") then
		db.actor:give_info_portion ("garb_3shperes_task")
	end
end

function garb_metal_cube_zone_turret_spawn()
	--turret_spawn.metal_cube_zone_turret_spawn()
end 

function actor_on_resrevuar2jump()
	db.actor:set_actor_position(vector():set(74.10,18.40,97.24), 224682, 356)
end


function garb_grave_cross2_use()
addon_devices.garb_grave_cross2_use()
end

---------------------------------------------------------------------------------------------------------------------------------------

function pkm_case_activate()
	addon.turret_case_activate()
	soundtrack.pkm_deactivate()
end
----------------------------------------------------------------------------------------------------------------------------------------

function stolen_aftefact_tip()
local st = get_hud():GetCustomStatic("stolen_aftefact") or get_hud():AddCustomStatic("stolen_aftefact",true)
st.m_endTime = time_global()/1000 + 5
end

-- Артефакты, которые МОГУТ быть украдены летающими роями:
af_table = {
	["af_coal"] = true,
	["af_scale"] = true,
	["af_bitum"] = true,
	["af_ballast"] = true,
	["af_roll"] = true, 
	["af_chicken_god"] = true, 
	["af_steel_nut"] = true,
	["af_bearing"] = true, 
	["af_crown"] = true, 
	["af_frog"] = true,
	["af_chestnut"] = true, 
	["af_sagebrush"] = true, 
	["af_mushroom"] = true,
	["af_glass"] = true, 
	["af_teardrop"] = true, 
	["af_lens"] = true, 
	["af_spiral"] = true,
	["af_cristallic"] = true, 
	["af_snail"] = true, 
	["af_hole"] = true, 
	["af_egg"] = true,
	["af_chamelleon"] = true,
	["af_emerald"] = true,
	["af_electro_nut"] = true,
	["master_art"] = true,
	["af_gold_sphere"] = true,
	["af_red_sphere"] = true,
	["af_green_sphere"] = true,
	-- ["af_black_splash"] = true,
	-- ["af_fulminating_napkin"] = true,
	-- ["af_cancer_eye"] = true,
	["power_scull"] = true,
	["af_zuda"] = true,
	["af_magic_egg"] = true,
	["af_snowball"] = true,
	["af_shell"] = true,
	["af_bur"] = true,
	["af_flower"] = true,
		["af_baton"] = true,
		["af_chip"] = true,
		["af_lamp"] = true,
		["af_fist"] = true,
		["af_pumice"] = true,
		["af_spider"] = true,
		["af_bottle"] = true,
		["af_bur"] = true,
		["af_spiderweb"] = true,
		["af_mutant1"] = true,
		["af_mutant2"] = true,
		["af_mutant3"] = true,
		["af_mutant4"] = true,
		["af_mutant5"] = true,
	["af_marouders_hand"] = true
}


function garb_flies1steal_artefacts()
if db.actor:object("af_loop") == nil then
	db.actor:iterate_inventory( function(_, item)
		if af_table[item:section()] then
			amk.remove_item(item)
			alife():create(item:section(), vector():set (44.67,0.93,168.50), 220424, 358)
			stolen_aftefact_tip()
		end
	end )
end
end

function garb_flies2steal_artefacts()
if db.actor:object("af_loop") == nil then
	db.actor:iterate_inventory( function(_, item)
		if af_table[item:section()] then
			amk.remove_item(item)
			alife():create(item:section(), vector():set (275.70,-7.47,1.67), 378751, 390)
			stolen_aftefact_tip()
		end
	end )
end
end

function garb_flies3steal_artefacts()
if db.actor:object("af_loop") == nil then
	db.actor:iterate_inventory( function(_, item)
		if af_table[item:section()] then
			amk.remove_item(item)
			alife():create(item:section(), vector():set (-48.09,0.40,-30.70), 142929, 323)
			stolen_aftefact_tip()
		end
	end )
end
end

function agr_moving_fly_fabrika_steal_artefacts()
if db.actor:object("af_loop") == nil then
	db.actor:iterate_inventory( function(_, item)
		if af_table[item:section()] then
			amk.remove_item(item)
			alife():create(item:section(), vector():set (16.42,-0.00,22.98), 256103, 480)
			stolen_aftefact_tip()
		end
	end )
end
end

function agr_flies_budka_steal_artefacts()
if db.actor:object("af_loop") == nil then
	db.actor:iterate_inventory( function(_, item)
		if af_table[item:section()] then
			amk.remove_item(item)
			alife():create(item:section(), vector():set (-47.20,-0.80,-35.11), 194127, 654)
			stolen_aftefact_tip()
		end
	end )
end
end

function agr_flies_pricep_steal_artefacts()
if db.actor:object("af_loop") == nil then
	db.actor:iterate_inventory( function(_, item)
		if af_table[item:section()] then
			amk.remove_item(item)
			alife():create(item:section(), vector():set (-114.63,1.54,-30.16), 127313, 599)
			stolen_aftefact_tip()
		end
	end )
end
end

function mil_flies1steal_artefacts()
if db.actor:object("af_loop") == nil then
	db.actor:iterate_inventory( function(_, item)
		if af_table[item:section()] then
			amk.remove_item(item)
			alife():create(item:section(), vector():set (1.26,-5.39,85.02), 308834, 1580)
			stolen_aftefact_tip()
		end
	end )
end
end

function predb_flies1steal_artefacts()
if db.actor:object("af_loop") == nil then
	db.actor:iterate_inventory( function(_, item)
		if af_table[item:section()] then
			amk.remove_item(item)
			addon.script_spawn(item:section(), "predbannik", vector():set(169.21,8.56,-30.40) )
			stolen_aftefact_tip()
		end
	end )
end
end

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function garb_reservuar_turret_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("personal_turret") then
	sim:release(sobj,true)
	return
	end
end
end

function garb_reservuar_turret_box_spawn()
alife():create("turret_box", vector():set (82.65,18.40,92.24), 224682, 356)
end

------------------------------------------------------------------------------------------------------------------------------

function play_hi_hi(actor, npc, p)
local sobj = alife():object(obj:id())
local pos = sobj.position
local snd = xr_sound.get_safe_sound_object([[ambient\random\rnd_ratchant]])
if sobj then
snd:play_no_feedback(sobj, sound_object.s3d, 0, sobj.position, 1.0)
end
end
------------------------------------------------------------------------------------------------------------------------------


function garb_hue_heli_desant()
local obj = level_object_by_sid(8254)
local pos = obj:position()
	 local sim = alife()
 local sobj = sim:create("client_1", vector():set(pos.x+1, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
 sim:assign_story_id(sobj.id, story_ids.client_1)
alife():create("client_1_guard1", vector():set(pos.x+1, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
alife():create("client_1_guard2", vector():set(pos.x+1, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
end

function agr_hue_heli_desant()
local obj = level_object_by_sid(8421)
local pos = obj:position()
	 local sim = alife()
 local sobj = sim:create("client_1", vector():set(pos.x+1, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
 sim:assign_story_id(sobj.id, story_ids.client_1)
alife():create("client_1_guard1", vector():set(pos.x+1, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
alife():create("client_1_guard2", vector():set(pos.x+1, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
end

function dar_hue_heli_desant()
local obj = level_object_by_sid(8453)
local pos = obj:position()
	 local sim = alife()
 local sobj = sim:create("client_1", vector():set(pos.x+1, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
 sim:assign_story_id(sobj.id, story_ids.client_1)
alife():create("client_1_guard1", vector():set(pos.x+1, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
alife():create("client_1_guard2", vector():set(pos.x+1, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
end

function mil_hue_heli_desant()
local obj = level_object_by_sid(8840)
local pos = obj:position()
	 local sim = alife()
 local sobj = sim:create("client_1mil", vector():set(pos.x+1, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
 sim:assign_story_id(sobj.id, story_ids.client_1)
alife():create("client_1_guard1mil", vector():set(pos.x+1, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
alife():create("client_1_guard2mil", vector():set(pos.x+1, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
end
--------------------------------------------------------------------------------------------------------------------------------------


function garb_to_darkvalley_nopass_zone_effect1()
db.actor:set_actor_position(vector():set(257.51,0.73,150.10), 371973, 380)
end


function garb_to_darkvalley_nopass_zone_effect2()
alife():create("garb_moving_fly_sphere1", vector():set (290.88,2.11,143.43), 381584, 257)
alife():create("garb_moving_fly_sphere2", vector():set (290.88,2.11,143.43), 381584, 257)
alife():create("garb_moving_fly_sphere3", vector():set (290.88,2.11,143.43), 381584, 257)
alife():create("garb_moving_fly_sphere4", vector():set (290.88,2.11,143.43), 381584, 257)
end

function garb_to_darkvalley_nopass_zone_delete1()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("garb_moving_fly_sphere1") then
	sim:release(sobj,true)
	return
	end
end
end

function garb_to_darkvalley_nopass_zone_delete2()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("garb_moving_fly_sphere2") then
	sim:release(sobj,true)
	return
	end
end
end

function garb_to_darkvalley_nopass_zone_delete3()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("garb_moving_fly_sphere3") then
	sim:release(sobj,true)
	return
	end
end
end

function garb_to_darkvalley_nopass_zone_delete4()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("garb_moving_fly_sphere4") then
	sim:release(sobj,true)
	return
	end
end
end


function give_af_guider()
amk.spawn_item_in_inv("af_guider")
-- amk.remove_item_from_inventory_by_name("af_red_sphere",db.actor)
-- amk.remove_item_from_inventory_by_name("af_green_sphere",db.actor)
-- amk.remove_item_from_inventory_by_name("af_gold_sphere",db.actor)
addon.remove_items("af_red_sphere", 1)
addon.remove_items("af_green_sphere", 1)
addon.remove_items("af_gold_sphere", 1)
level.add_pp_effector("teleport.ppe", 2011, false)
soundtrack.af_guider_birth()
-- amk.start_timer("doll3",2)
start_real_timer(3, "xr_effects.af_guider_doll_reaction")
end


function play_fire_on_actor(actor, npc, p) -- Проиграть пламя на акторе
local pos = db.actor:position()
local fx_particle = "explosions\\campfire_01"
fx_particle = particles_object(fx_particle)
fx_particle:play_at_pos(pos)
soundtrack.flame_strike()
end

function play_shock_on_actor(actor, npc, p) -- Проиграть электроразряд на акторе
local pos = db.actor:position()
local fx_particle = "anomaly2\\group_items\\electra2_trails"
fx_particle = particles_object(fx_particle)
fx_particle:play_at_pos(pos)
soundtrack.shock_strike()
end


function release_agr_nii_port()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("^agr_nii_stairs_port") then
	sim:release(sobj,true)
	return
	end
end
end

function agr_nii_stoned_body1_alive()
-- local sobj = alife():create("agr_nii_ecolog1", vector():set (-136.06,14.99,-198.31), 103248, 643)
-- register_story_object(sobj.id, story_ids.agr_nii_ecolog)
release_agr_nii_port()
end

function agr_nii_stoned_body2_alive()
obj = alife():create("agr_nii_ecolog2", vector():set (-139.75,14.99,-197.96), 98648, 643)
obj:on_death()
end

function agr_nii_stoned_body3_alive()
obj = alife():create("agr_nii_oficer", vector():set (-137.81,14.99,-200.97), 100941, 643)
obj:on_death()
end

function agr_nii_stoned_body4_alive()
obj = alife():create("agr_nii_soldier1", vector():set (-139.39,14.99,-195.31), 99448, 643)
obj:on_death()
end

function agr_nii_stoned_body5_alive()
obj = alife():create("agr_nii_soldier2", vector():set (-136.08,14.99,-195.07), 103254, 643)
obj:on_death()
end



function object77b_dummy_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("object77b") then
	sim:release(sobj,true)
	alife():create("af_object77b", db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
	return
	end
end
end

function nii_moving_fire_back()
db.actor:set_actor_position(vector():set(-138.67,-0.20,-183.39), 100234, 548)
end

function nii_top_zone_out()
db.actor:set_actor_position(vector():set(-123.83,15.00,-197.30), 115967, 642)
end

--------------------------------------------------------------------------------------------------------------------------------------------------------------------

function skidan_get_money()
local npc = level_object_by_sid (8064)
	if npc ~= nil and npc:alive() and npc:money() < 5000 then
		npc:give_money(50000)
	end
end
----------------------------------------------------------------------------------------------------------------------------------------------------------------------

function agr_brownie1trap()
local obj = level_object_by_sid(8261)
local pos = obj:position()
if db.actor:dont_has_info("agr_brownie1_dead") and db.actor:alive() then
	db.actor:set_actor_position( vector():set(pos.x, pos.y-1, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
end
end

function agr_brownie2trap()
local obj = level_object_by_sid(8262)
local pos = obj:position()
if db.actor:dont_has_info("agr_brownie2_dead") and db.actor:alive() then
	db.actor:set_actor_position( vector():set(pos.x, pos.y-1, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
end
end

function agr_brownie3trap()
local obj = level_object_by_sid(8263)
local pos = obj:position()
if db.actor:dont_has_info("agr_brownie3_dead") and db.actor:alive() then
	db.actor:set_actor_position( vector():set(pos.x, pos.y-1, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
end
end

function agr_brownie4trap()
local obj = level_object_by_sid(8264)
local pos = obj:position()
if db.actor:dont_has_info("agr_brownie4_dead") and db.actor:alive() then
	db.actor:set_actor_position( vector():set(pos.x, pos.y-1, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
end
end


-- Иконка невидимой опасности:
function show_danger_icon()
local st = get_hud():GetCustomStatic("danger") or get_hud():AddCustomStatic("danger",true)
st.m_endTime = time_global()/1000 + 3
end
-----------------------------------------------------------------------------------------------------------------------------------------------

function actor_teleport_at_evilzone_place()
	db.actor:set_actor_position(vector():set(91.38,14.57,132.51), 259183, 364)
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
end
---------------------------------------------------------------------------------------------------------------------------------------------------

function esc_tourist_pda_give()
alife():create('esc_cheramic_box', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
end


-----------------------------------------------------------------------------------------------------------------------------------------------------

function garb_static_af_loop_spawn()
local karma = starvation.get_karma()
	if karma>=0.9 then
		remove_garb_hlust_scelet()
		db.actor:give_info_portion ("actor_has_af_loop")
	elseif karma<0.9 then
		alife():create("af_loop_static", vector():set (82.18,-0.56,-55.84), 250769, 394)
		addon.remove_items("af_loop", 1)
	end
end

function remove_garb_hlust_scelet()
local obj = alife():story_object(8268)
  if obj then
   alife():release(obj, true)
 end
end 

function af_loop_static_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("af_loop_static") then
	sim:release(sobj,true)
	alife():create("af_loop", db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
	return
	end
end
end

function esc_village_stoned_body_use()
level.add_pp_effector("teleport.ppe", 2011, false)
start_real_timer(1, "timer_actions.esc_stonedbody_timer_action")
end


function esc_suslik_box_use()
local obj = alife():story_object(8279)
-- local pos = obj:position()
-- alife():create("suslik_box", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
alife():release(obj ,true)
end

function esc_suslik_box_spawn()
alife():create("suslik_box", vector():set (155.14,6.61,74.64), 459798, 156)
end

function village_house2_task_think()
local st = get_hud():GetCustomStatic("village_house2_task_think") or get_hud():AddCustomStatic("village_house2_task_think",true)
st.m_endTime = time_global()/1000 + 6
end
---------------------------------------------------------------------------------------------------------------------------------------------


function give_first_habar_info()
if db.actor:dont_has_info("first_habar_info") then
	db.actor:give_info_portion ("first_habar_info")
end
end
-----------------------------------------------------------------------------------------------------------

function hunter1_garb_report()
local npc = level_object_by_sid(8224)
local pos = npc:position()
local snd_obj = xr_sound.get_safe_sound_object([[characters_voice\human_01\stalker\fight\tolls\tolls_2]])
	if npc and npc:alive() and has_alife_info("spawn_garbage_companions") and db.actor:dont_has_info("garbage_companions_on_place") then
	snd_obj:play_at_pos(npc, npc:position(), 0, sound_object.s3d)
	end
end

function survival_garb_report()
local npc = level_object_by_sid(8225)
local pos = npc:position()
local snd_obj = xr_sound.get_safe_sound_object([[characters_voice\human_01\military\fight\tolls\tolls_1]])
	if npc and npc:alive() and has_alife_info("spawn_garbage_companions") and db.actor:dont_has_info("garbage_companions_on_place") then
	snd_obj:play_at_pos(npc, npc:position(), 0, sound_object.s3d)
	end
end
-------------------------------------------------------------------------------------------------------------------


function ded_pihto_car_getoff1()
db.actor:set_actor_direction(0.4,0.0,0.0)
soundtrack.test_1()
end

function ded_pihto_car_getoff2()
db.actor:set_actor_direction(-0.8,0.0,0.0)
soundtrack.test_1()
end

function ded_pihto_car_getoff3()
db.actor:set_actor_direction(1.2,0.0,0.0)
soundtrack.test_1()
end

function ded_pihto_car_getoff4()
db.actor:set_actor_direction(-1.6,0.0,0.0)
soundtrack.test_1()
end

function ded_pihto_car_getoff5()
db.actor:set_actor_direction(2.0,0.0,0.0)
soundtrack.test_1()
end

function ded_pihto_car_getoff6()
db.actor:set_actor_direction(-2.4,0.0,0.0)
soundtrack.test_1()
end

function ded_pihto_car_getoff7()
db.actor:set_actor_direction(2.8,0.0,0.0)
soundtrack.test_1()
end

function ded_pihto_car_getoff8()
db.actor:set_actor_direction(-3.2,0.0,0.0)
soundtrack.test_1()
end

function ded_pihto_car_getoff9()
db.actor:set_actor_direction(3.6,0.0,0.0)
soundtrack.test_1()
end

function cough_sound_play()
soundtrack.cough()
end
-----------------------------------------------------------------------------------------------------------------------------

function actor_teleport_to_post_tree()
	db.actor:set_actor_position(vector():set(-69.64,-33.13,-349.87), 203550, 99)
end

function esc_sold10_boars_spawn()
alife():create("esc_sold10_boar1", vector():set (-109.13,-9.07,-146.88), 148083, 44)
alife():create("esc_sold10_boar2", vector():set (-109.13,-9.07,-146.88), 148083, 44)
alife():create("esc_sold10_boar3", vector():set (-109.13,-9.07,-146.88), 148083, 44)
end

-----------------------------------------------------------------------------------------------------------------------------------------
function esc_obelisk_deadmans_head_zone_randomspawn()
	addon_dialogs.deadmans_head_zone_spawn1()
end

function esc_deadman_head_signal()
-- Кордон:
addon_dialogs.deadman_head_cross1_spawn()
addon_dialogs.deadman_head_cross2_spawn()
addon_dialogs.deadman_head_cross3_spawn()
addon_dialogs.deadman_head_cross4_spawn()
addon_dialogs.deadman_head_cross5_spawn()
start_real_timer(1, "timer_actions.escgraves_timer_action")

-- Свалка:
addon_dialogs.deadman_head_cross6_spawn()
addon_dialogs.deadman_head_cross7_spawn()
addon_dialogs.deadman_head_cross8_spawn()
addon_dialogs.deadman_head_cross9_spawn()

-- Долина:
addon_dialogs.deadman_head_cross10_spawn()
addon_dialogs.deadman_head_cross11_spawn()
addon_dialogs.deadman_head_cross12_spawn()
addon_dialogs.deadman_head_cross13_spawn()

-- Агро:
addon_dialogs.deadman_head_cross14_spawn()
addon_dialogs.deadman_head_cross15_spawn()

soundtrack.deadman_head_scream()
addon_dialogs.deadman_head_think()
level.add_cam_effector("camera_effects\\shell_shock.anm", 999, false, "")
end
---------------------------------------------------------------------------------------------------------------------------------------------

function bomzh_habar_trap_spawn1()
	local sobj = alife():create("bomzh_habar_trap_zone", vector():set (-44.93,-9.92,-69.47), 234295, 77)
	--[[local t = m_net_utils.get_restrictor_data(sobj)
	t.shapes = {}
	local shape1 = {}
	shape1.shtype = 0
	shape1.center = vector():set(0,0,0)
	shape1.radius = 4
	t.restrictor_type = 2
	table.insert(t.shapes,shape1)
	m_net_utils.set_restrictor_data(t,sobj)]]
	local pk = get_netpk(sobj)
	local data = pk:get()
	data.restrictor_type = restrictor_type.DefaultRestrictorTypeIn --тип 2
	data.shapes:addSphere(4)
	pk:set(data)
end

function bomzh_habar_trap_spawn2()
	local sobj = alife():create("bomzh_habar_trap_partic_zone", vector():set (-44.93,-9.92,-69.47), 234295, 77)
--[[	local t = m_net_utils.get_restrictor_data(sobj)
	t.shapes = {}
	local shape1 = {}
	shape1.shtype = 0
	shape1.center = vector():set(0,0,0)
	shape1.radius = 1
	t.restrictor_type = 2
	table.insert(t.shapes,shape1)
	m_net_utils.set_restrictor_data(t,sobj)]]
	local pk = get_netpk(sobj)
	local data = pk:get()
	data.restrictor_type = restrictor_type.DefaultRestrictorTypeIn --тип 2
	data.shapes:addSphere(1)
	pk:set(data)
end
-----------------------------------------------------------------------------------------------------------------------------------------------


function condensator_give()
alife():create('condensator', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
soundtrack.wonderdoll_sucess_tip()
end

function wonder_task_done3()
	if db.actor:dont_has_info("wonder_task_done3") then
		db.actor:give_info_portion ("wonder_task_done3")
	end
end




function give_dolltip1()
local st = get_hud():GetCustomStatic("dolltip1") or get_hud():AddCustomStatic("dolltip1",true)
st.m_endTime = time_global()/1000 + 5
end

function give_dolltip2()
local st = get_hud():GetCustomStatic("dolltip2") or get_hud():AddCustomStatic("dolltip2",true)
st.m_endTime = time_global()/1000 + 5
end

function give_dolltip_secret()
local st = get_hud():GetCustomStatic("dolltip3") or get_hud():AddCustomStatic("dolltip3",true)
st.m_endTime = time_global()/1000 + 5
soundtrack.doll_secret_call()
end
-----------------------------------------------------------------------------------------------------------------------------------------------------


function garb_to_bar_minefield_blow()
actor_on_mine_blow()
end

function garb_to_bar_minefield_blow_nohit()
actor_on_mine_blow2()
end

function btr_minefield_think()
local st = get_hud():GetCustomStatic("btr_minefield_think") or get_hud():AddCustomStatic("btr_minefield_think",true)
st.m_endTime = time_global()/1000 + 4
end




function af_guider_doll_reaction()
	if db.actor:object("wonder_doll") ~= nil then
	give_dolltip1()
	soundtrack.wonderdoll_sucess_tip2()
	end
end





function mark_water_and_sleep_places()
addon_dialogs.mark_water_places1()
addon_dialogs.mark_water_places2()
addon_dialogs.mark_sleep_places1()
addon_dialogs.mark_sleep_places2()
addon_dialogs.mark_anomal_zones()
end




function release_crictall_receiver1()
local obj = alife():story_object(8320)
  if obj then
   alife():release(obj, true)
 end
end 


function small_telepatic_hit_actor()
db.actor.psy_health = - 0.1
end



function dar_factory_port_actor_away()
	db.actor:set_actor_position(vector():set(161.60,0.16,-239.03), 362014, 976)
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
	if db.actor:dont_has_info("dar_fabric_ratnest_destroyed") then
		if db.actor:dont_has_info("dar_fabric_ratnest_rats_spawn") then
			db.actor:give_info_portion ("dar_fabric_ratnest_rats_spawn")
		end
	-- soundtrack.jekan_music_track1()
	end
end

function dar_fabric_ratnest_rats_spawn()
	alife():create("dar_factory_rat1", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat2", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat3", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat4", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat1", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat2", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat3", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat4", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat1", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat2", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat3", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat4", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat1", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat2", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat3", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat4", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat1", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat2", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat3", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat4", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat1", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat2", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat3", vector():set (160.04,0.15,-233.52), 360493, 976)
	alife():create("dar_factory_rat4", vector():set (160.04,0.15,-233.52), 360493, 976)
end

function spawn_esc_madhunter_treasure()
local obj = level_object_by_sid(8326)
local pos = obj:position()
alife():create("esc_madhunter_treasure", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
end

------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function dar_podval_door_think()
local st = get_hud():GetCustomStatic("dar_podval_door_think") or get_hud():AddCustomStatic("dar_podval_door_think",true)
st.m_endTime = time_global()/1000 + 5
end


function actor_goto_x18prison2()
	db.actor:set_actor_position(vector():set(-11.76,4.36,-3.36), 1486, 1166)
end

function x18_entrance_robbery()
	-- soundtrack.hit_fist()
	level.add_pp_effector("deadcity_wake_old.ppe", 2007, false)
	level.add_cam_effector("camera_effects\\fusker.anm", 999, false, "")
	addon_dialogs.put_items_to_x18_box()
	enable_ui()
	db.actor:restore_weapon()
end
--------------------------------------------------------------------------------------------------------------------------------------------------------------------

function actor_teleport_for_zapravka_wall()
	db.actor:set_actor_position(vector():set(134.55,0.21,-13.87), 331892, 914)
end

function spawn_dar_ovrag_bloodsukers2()
alife():create("dar_ovrag_pseudodog1", vector():set (174.84,-0.87,-89.47), 375867, 919)
alife():create("dar_ovrag_pseudodog2", vector():set (174.84,-0.87,-89.47), 375867, 919)
alife():create("dar_ovrag_pseudodog2", vector():set (174.84,-0.87,-89.47), 375867, 919)
end

----------------------------------------------------------------------------------------------------------------------------------------------------------------------

function dar_kamp_actor_getoff()
	db.actor:set_actor_position(vector():set(98.18,0.75,-404.79), 292831, 942)
end


function vorpal_diary1_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("vorpal_diary1") then
	sim:release(sobj,true)
	db.actor:give_info_portion ("vorpal_diary_info1")
	addon_dialogs.vorpal_diary1_think()
	-- return
	end
end
end

function vorpal_diary2_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("vorpal_diary2") then
	sim:release(sobj,true)
	db.actor:give_info_portion ("vorpal_diary_info2")
	-- return
	end
end
end

function vorpal_diary3_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("vorpal_diary3") then
	sim:release(sobj,true)
	db.actor:give_info_portion ("vorpal_diary_info3")
	-- return
	end
end
end

function vorpal_diary4_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("vorpal_diary4") then
	sim:release(sobj,true)
	db.actor:give_info_portion ("vorpal_diary_info4")
	-- return
	end
end
end

function vorpal_diary5_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("vorpal_diary5") then
	sim:release(sobj,true)
	db.actor:give_info_portion ("vorpal_diary_info5")
	-- return
	end
end
end

function vorpal_diary6_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("vorpal_diary6") then
	sim:release(sobj,true)
	db.actor:give_info_portion ("vorpal_diary_info6")
	-- return
	end
end
end

function vorpal_diary7_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("vorpal_diary7") then
	sim:release(sobj,true)
	db.actor:give_info_portion ("vorpal_diary_info7")
	-- return
	end
end
end

function vorpal_diary8_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("vorpal_diary8") then
	sim:release(sobj,true)
	db.actor:give_info_portion ("vorpal_diary_info8")
	-- return
	end
end
end

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function dar_kamaz_box_use()
local obj = alife():story_object(8346)
alife():release(obj ,true)
end

function dar_kamaz_box_spawn()
alife():create("dar_kamaz_box", vector():set (-16.04,-3.20,-473.65), 155002, 953)
end


function release_x18_radpit_box()
local obj = alife():story_object(8454)
alife():release(obj ,true)
end

function x18_radpit_box_spawn()
alife():create("x18_radpitbox", vector():set (-6.30,1.97,12.02), 1985, 1125)
end
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------


function dar_farm_trap_teleport_trawell1()
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
	db.actor:set_actor_position(vector():set(-100.09,0.94,-485.80), 58353, 830)
end

function dar_farm_trap_teleport_trawell2()
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
	db.actor:set_actor_position(vector():set(-136.04,0.94,-486.38), 22150, 831)
end


function dar_farm_trap_teleport_trawell3()
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
	db.actor:set_actor_position(vector():set(-135.93,0.97,-518.29), 22105, 832)
end

function dar_farm_trap_teleport_trawell4()
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
	db.actor:set_actor_position(vector():set(-136.29,0.95,-486.75), 21567, 831)
end

--------------------------------------------------------------------------------------------------------------------------------

function release_dar_farm_seif()
local obj = alife():story_object(8353)
  if obj then
   alife():release(obj , true)
  end
end 

function dar_farm_seif_spawn()
alife():create("dar_farm_seif_shron", vector():set (-131.14,0.97,-517.24), 26529, 832)
end

function dezintegrator_use()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("dezintegrator") then
	sim:release(sobj,true)
	amk.spawn_item_in_inv("deadzone_dezintegrator")
	return
	end
end
end

function del_anomalys()
ogsm_anomaly.del_anomaly(obj_pos)
news_manager.send_tip(db.actor, "dezintegrator_work_done_tip", nil)
end 


function play_particle_on_dezintegrator()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("dezintegrator") then
	local pos = sobj.position
	-- local fx_particle = "_ecp\\group_items\\anomaly_bold_distortion_00"
	-- local fx_particle = "1935\\group_items\\rpg7_flash_00"
	-- local fx_particle = "amk\\ice_enter_small"
	local fx_particle = "damage_fx\\body_glow"
		if sobj then
		fx_particle = particles_object(fx_particle)
		fx_particle:play_at_pos(pos)
		end
	end
end
end

function dezintegrator_deadzones_uncharge()
local obj = level_object_by_sid (8354)
local obj_pos = obj:position()
local zone1 = level_object_by_sid( 8189 ) -- захоронение на ферме в Долине (№224)
local zone2 = level_object_by_sid( 8379 ) -- захоронение в ложбинке на Свалке (№335)
local zone3 = level_object_by_sid( 8513 ) -- захоронение у дороги на Агро (№74)
local news_text1 = "Захоронение обезврежено"
local news_text2 = "Отмена. Расположите прибор у Захоронения."

	if zone1 ~= nil and zone1:position():distance_to_sqr(obj:position()) <= 12*12 and db.actor:dont_has_info("dar_farm_deadzone_off") then
	db.actor:give_game_news(news_text1, "ui\\ui_iconsTotal", Frect():set(83,470,83,47), 1000, 5000)
	db.actor:give_info_portion ("dar_farm_deadzone_off")
	elseif zone1 ~= nil and zone1:position():distance_to_sqr(obj:position()) >= 12*12 then
	db.actor:give_game_news(news_text2, "ui\\ui_iconsTotal", Frect():set(83,470,83,47), 1000, 5000)
	end

	if zone2 ~= nil and zone2:position():distance_to_sqr(obj:position()) <= 18*18 and db.actor:dont_has_info("garb_deadzone_off") then
	db.actor:give_game_news(news_text1, "ui\\ui_iconsTotal", Frect():set(83,470,83,47), 1000, 5000)
	db.actor:give_info_portion ("garb_deadzone_off")
	elseif zone2 ~= nil and zone2:position():distance_to_sqr(obj:position()) >= 12*12 then
	db.actor:give_game_news(news_text2, "ui\\ui_iconsTotal", Frect():set(83,470,83,47), 1000, 5000)
	end

	if zone3 ~= nil and zone3:position():distance_to_sqr(obj:position()) <= 18*18 and db.actor:dont_has_info("agr_deadzone_off") then
	db.actor:give_game_news(news_text1, "ui\\ui_iconsTotal", Frect():set(83,470,83,47), 1000, 5000)
	db.actor:give_info_portion ("agr_deadzone_off")
	elseif zone3 ~= nil and zone3:position():distance_to_sqr(obj:position()) >= 12*12 then
	db.actor:give_game_news(news_text2, "ui\\ui_iconsTotal", Frect():set(83,470,83,47), 1000, 5000)
	end

	-- сюда вносить условия для других захоронений

end

function dar_renegad1_spawn_in()
	    local obj = level_object_by_sid(8187)
	    local pos = obj:position()
alife():create("usas_outfit", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("af_nightvision_1", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("mre", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("mre", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("hand_radio_f", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("vint", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("medkit_scientic", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("knife_3", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
end

function dar_renegad2_spawn_in()
	    local obj = level_object_by_sid(8188)
	    local pos = obj:position()
alife():create("usas_outfit", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("af_nightvision_1", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("mre", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("mre", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("hand_radio_f", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("vint", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("medkit_scientic", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("knife_3", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
end
-------------------------------------------------------------------------------------------------------------------------------------------------------------

function actor_teleport_to_dar_trap()
	addon_dialogs.send_actor_items_to_dar_location_box()
	spawn_jekan_swamp_bag()
	start_real_timer(1, "xr_effects.actor_teleport_to_dar_trap2")
end

function actor_teleport_to_dar_trap2()
	db.actor:give_info_portion ("actor_find_dar_woman")
	db.actor:set_actor_position(vector():set(146.18,3.99,-469.58), 344881, 948)
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
	dar_trap_lostbag_think()
	mark_our_lostbag()
end

function spawn_jekan_swamp_bag()
	rnd = math.random(1, 5)
	if rnd == 1 then 
		spawn_jekan_swamp_bag1()
	elseif rnd == 2 then 
		spawn_jekan_swamp_bag2()
	elseif rnd == 3 then
		spawn_jekan_swamp_bag3()
	elseif rnd == 4 then 
		spawn_jekan_swamp_bag4()
	elseif rnd == 5 then 
		spawn_jekan_swamp_bag5()
	end
end


function spawn_jekan_swamp_bag1()
	 local sim = alife()
 local sobj = sim:create("jekan_bag1", vector():set (-4.47,-4.74,-313.26), 171248, 850)
 sim:assign_story_id(sobj.id, story_ids.jekan_bag1)
end

function spawn_jekan_swamp_bag2()
	 local sim = alife()
 local sobj = sim:create("jekan_bag1", vector():set (-0.46,-5.00,-302.06), 172855, 850)
 sim:assign_story_id(sobj.id, story_ids.jekan_bag1)
end

function spawn_jekan_swamp_bag3()
	 local sim = alife()
 local sobj = sim:create("jekan_bag1", vector():set (-23.15,-5.23,-293.12), 147221, 850)
 sim:assign_story_id(sobj.id, story_ids.jekan_bag1)
end

function spawn_jekan_swamp_bag4()
	 local sim = alife()
 local sobj = sim:create("jekan_bag1", vector():set (21.18,-5.23,-354.77), 199348, 841)
 sim:assign_story_id(sobj.id, story_ids.jekan_bag1)
end

function spawn_jekan_swamp_bag5()
	 local sim = alife()
 local sobj = sim:create("jekan_bag1", vector():set (59.30,-4.96,-375.67), 247316, 940)
 sim:assign_story_id(sobj.id, story_ids.jekan_bag1)
end


function mark_our_lostbag()
   local obj = alife():story_object(8358)
   local obj_id = obj.id
   if obj_id then
  text = "Где-то здесь я потерял свой рюкзак..."
	level.map_add_object_spot_ser(obj_id,"crlc_mdl",text)
   end
end


function dar_trap_lostbag_think()
local st = get_hud():GetCustomStatic("dar_trap_lostbag_think") or get_hud():AddCustomStatic("dar_trap_lostbag_think",true)
st.m_endTime = time_global()/1000 + 20
end

function dar_woman_trap_zone_goback()
	db.actor:set_actor_position(vector():set(145.20,3.96,-469.77))
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
end

function dar_woman_trap_zone_out()
	db.actor:set_actor_position(vector():set(134.20,3.72,-462.95))
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
end

function put_items_from_dar_location_box(box)
	transfer_from_box(8357)
	local sobj = alife():story_object(8357)
	if sobj then alife():release(sobj) end
end

function spawn_dar_trap_teleport()
	if db.actor:dont_has_info("dar_trap_teleport1_dead") then
		alife():create("dar_trap_teleport1", vector():set (143.32,4.30,-455.45), 341627, 941)
	end
	if db.actor:dont_has_info("dar_trap_teleport2_dead") then
		alife():create("dar_trap_teleport2", vector():set (137.87,3.82,-462.10), 335259, 948)
	end
	if db.actor:dont_has_info("dar_trap_teleport3_dead") then
		alife():create("dar_trap_teleport3", vector():set (138.05,3.73,-470.57), 335247, 948)
	end
end

function remove_ph_obj_with_teleport(actor,npc,p) -- Проиграть телепорт и удалить
local pos = npc:position()
local sobj = alife():object( npc:id() )
if sobj then
	local fx_particle = particles_object("anomaly2\\plasma_generator_death")
	fx_particle:play_at_pos(pos)
	local snd = xr_sound.get_safe_sound_object("anomaly\\teleport_work_2")
	snd:play_at_pos(db.actor, pos, 0, sound_object.s3d)
	alife():release(sobj,true)
end
end


function dar_teleport_trap_atack()
	db.actor:set_actor_position(vector():set(145.20,3.96,-469.77), 343263, 948)
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
		if db.actor:object("af_eye") ~= nil then
		amk.remove_item(db.actor:object("af_eye"))
		alife():create('af_eye', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id())
		dar_trap_teleport_af_lost_think()
		end
end

function dar_trap_teleport_af_lost_think()
local st = get_hud():GetCustomStatic("dar_trap_teleport_af_lost_think") or get_hud():AddCustomStatic("dar_trap_teleport_af_lost_think",true)
st.m_endTime = time_global()/1000 + 3
end

-----------------------------------------------------------------------------------------------------------------------------------------------------

function dar_izlom_werwolf_transformation()
local obj = level_object_by_sid(8360)
local pos = obj:position()
local fx_particle1 = "anomaly2\\bold_sarkofag_blast"
		 local sim = alife()
 local sobj = sim:create("dar_krovosos_werwolf", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
 sim:assign_story_id(sobj.id, story_ids.dar_krovosos_werwolf)
	fx_particle1 = particles_object(fx_particle1)
		fx_particle1:play_at_pos(pos)
	local snd_obj = xr_sound.get_safe_sound_object([[ambient\random\rnd_doubler]])
	snd_obj:play_at_pos(obj, obj:position(), 0, sound_object.s3d)
end

function dar_krovosos_werwolf_transformation()
local obj = level_object_by_sid(8361)
local pos = obj:position()
local fx_particle1 = "anomaly2\\bold_sarkofag_blast"
			 local sim = alife()
 local sobj = sim:create("dar_boar_werwolf", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
 sim:assign_story_id(sobj.id, story_ids.dar_boar_werwolf)
	fx_particle1 = particles_object(fx_particle1)
		fx_particle1:play_at_pos(pos)
	local snd_obj = xr_sound.get_safe_sound_object([[ambient\random\rnd_doubler]])
	snd_obj:play_at_pos(obj, obj:position(), 0, sound_object.s3d)
end

function dar_boar_werwolf_transformation()
local obj = level_object_by_sid(8362)
local pos = obj:position()
local fx_particle1 = "anomaly2\\bold_sarkofag_blast"
				 local sim = alife()
 local sobj = sim:create("dar_chimera_werwolf", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
 sim:assign_story_id(sobj.id, story_ids.dar_chimera_werwolf)
	fx_particle1 = particles_object(fx_particle1)
		fx_particle1:play_at_pos(pos)
	local snd_obj = xr_sound.get_safe_sound_object([[ambient\random\rnd_doubler]])
	snd_obj:play_at_pos(obj, obj:position(), 0, sound_object.s3d)
end

function dar_chimera_werwolf_transformation()
 local obj = level_object_by_sid(8363)
 local pos = obj:position()
 local fx_particle1 = "anomaly2\\bold_sarkofag_blast"
	local sim = alife()
 local sobj = sim:create("dar_izlom_werwolf", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
 sobj:on_death()
 sim:assign_story_id(sobj.id, story_ids.dar_izlom_werwolf)
	start_real_timer(1, "addon_dialogs.spawn_arts_in_werwolf")
	fx_particle1 = particles_object(fx_particle1)
		fx_particle1:play_at_pos(pos)
	local snd_obj = xr_sound.get_safe_sound_object([[ambient\random\rnd_doubler]])
	snd_obj:play_at_pos(obj, obj:position(), 0, sound_object.s3d)
end


function dar_izlom_werwolf_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("dar_izlom_werwolf") then
	sim:release(sobj,true)
	return
	end
end
end

function dar_krovosos_werwolf_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("dar_krovosos_werwolf") then
	sim:release(sobj,true)
	return
	end
end
end

function dar_boar_werwolf_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("dar_boar_werwolf") then
	sim:release(sobj,true)
	return
	end
end
end

function dar_chimera_werwolf_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj ~= nil and sobj:name():find("dar_chimera_werwolf") then
	sim:release(sobj,true)
	return
	end
end
end
-----------------------------------------------------------------------------------------------------------------------------------------------------

function disable_ui_only(actor, npc)
	if db.actor:is_talking() then
		db.actor:stop_talk()
	end
	level.show_weapon(false)

	if not p or (p and p[1] ~= "true") then
		local slot = db.actor:active_slot()
		if(slot~=0) then
			ui_active_slot = slot
			db.actor:activate_slot(0)
		end
	end

	level.disable_input()
	level.hide_indicators_safe()
	local hud = get_hud()
	hud:HideActorMenu()
	hud:HidePdaMenu()
end
---------------------------------------------------------------------------------------------------------------------------------------------------------

function garb_angar_burers_see_me_think()
local st = get_hud():GetCustomStatic("garb_angar_burers_see_me_think") or get_hud():AddCustomStatic("garb_angar_burers_see_me_think",true)
st.m_endTime = time_global()/1000 + 5
end

function garb_angar_laz1_teleport()
	-- db.actor:set_actor_position(vector():set(-104.46,0.99,16.32), 109260, 328)
	db.actor:set_actor_position(vector():set(-90.02,-0.13,-2.61), 129456, 322)
	if db.actor:dont_has_info("actor_inside_angar_from_laz") then
		db.actor:give_info_portion ("actor_inside_angar_from_laz")
	end
	if db.actor:object("wonder_doll") ~= nil then
		news_manager.send_tip(db.actor, "dolltip_garbage2", nil, "doll", 10000, nil)
	end
end

function garb_angar_laz2_teleport()
	-- db.actor:set_actor_position(vector():set(-105.11,1.10,3.54), 108685, 319)
	db.actor:set_actor_position(vector():set(-90.02,-0.13,-2.61), 129456, 322)
	if db.actor:dont_has_info("actor_inside_angar_from_laz") then
		db.actor:give_info_portion ("actor_inside_angar_from_laz")
	end
	if db.actor:object("wonder_doll") ~= nil then
		news_manager.send_tip(db.actor, "dolltip_garbage2", nil, "doll", 10000, nil)
	end
end

function garb_angar_laz3_teleport()
	db.actor:set_actor_position(vector():set(-90.02,-0.13,-2.61), 129456, 322)
	if db.actor:dont_has_info("actor_inside_angar_from_laz") then
		db.actor:give_info_portion ("actor_inside_angar_from_laz")
	end
	if db.actor:object("wonder_doll") ~= nil then
		news_manager.send_tip(db.actor, "dolltip_garbage2", nil, "doll", 10000, nil)
	end
end

function dyatlovs_group_zapis1_release()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("dyatlovs_group_zapis1") then
	sim:release(sobj,true)
	db.actor:give_info_portion ("dyatlovs_group_zapis1_info")
	-- return
	end
end
end
---------------------------------------------------------------------------------------------------------------------

function actor_light_electroshock()
local pos = db.actor:position()
local fx_particle_1 = "anomaly2\\group_items\\electra2_flash"
fx_particle_1 = particles_object(fx_particle_1)
fx_particle_1:play_at_pos(pos)
soundtrack.electroshock()
db.actor.health = - 0.1
end

function actor_hard_electroshock()
local pos = db.actor:position()
local fx_particle_1 = "anomaly2\\group_items\\electra2_flash"
fx_particle_1 = particles_object(fx_particle_1)
fx_particle_1:play_at_pos(pos)
soundtrack.electroshock()
db.actor.health = - 0.5
end

function af_guider_uncharged_think()
local st = get_hud():GetCustomStatic("af_guider_uncharged_think") or get_hud():AddCustomStatic("af_guider_uncharged_think",true)
st.m_endTime = time_global()/1000 + 8
end





function release_garb_ruins_seif()
local obj = alife():story_object(8245)
  if obj then
   alife():release(obj , true)
  end
end 

function garb_ruins_seif_spawn()
alife():create("garb_ruins_seif_shron", vector():set (104.36,13.75,177.19), 270879, 364)
end



function release_agr_nii_seif1()
local obj = alife():story_object(8433)
  if obj then
   alife():release(obj , true)
  end
end 

function agr_nii_seif1_spawn()
alife():create("agr_nii_seif1", vector():set (-106.86,0.55,-198.20), 132790, 670)
end



function hunter3sos1tip()
local obj = level_object_by_sid(8058)
	if obj and obj ~= nil and obj:position():distance_to_sqr(db.actor:position())  <= 40*40 then
	news_manager.send_tip(db.actor, "hunter3_sos1_tip", nil, "stalker", 3000, nil)
	end
end

function hunter3sos2tip()
local obj = level_object_by_sid(8058)
	if obj and obj ~= nil and obj:position():distance_to_sqr(db.actor:position())  <= 40*40 then
	news_manager.send_tip(db.actor, "hunter3_sos2_tip", nil, "stalker", 3000, nil)
	end
end



function dolltip_garbage1()
	if db.actor:object("wonder_doll") ~= nil then
	news_manager.send_tip(db.actor, "dolltip_garbage1", nil, "doll", 10000, nil)
	end
end

function glowworm_effect()

end


function agr_fabric_himera_spawn()
alife():create("agr_fabric_himera", vector():set (66.45,-0.00,-34.73), 302588, 460)
end

function agr_fabrik_power_box_trap1()
alife():create("agr_fabric_box_electra1", vector():set (19.59,1.50,-5.15), 259308, 465)
end

function agr_fabrik_power_box_trap2()
alife():create("agr_fabric_box_electra2", vector():set (-11.17,1.50,4.17), 228996, 466)
end

function agr_fabrik_power_box_trap3()
alife():create("agr_fabric_box_electra3", vector():set (-38.54,1.50,2.67), 201670, 661)
end

function agr_fabrik_power_box_think()
local st = get_hud():GetCustomStatic("agr_fabrik_power_box_think") or get_hud():AddCustomStatic("agr_fabrik_power_box_think",true)
st.m_endTime = time_global()/1000 + 7
end


function agr_fabrik_group_seif_spawn()
alife():create("agr_fabrik_group_seif", vector():set (40.84,7.49,-17.86), 278645, 664)
end


function agr_fabrik_teleports_spawn()
-- alife():create("agr_fabrik_teleport1", vector():set (38.38,3.37,-14.61), 276785, 663)
-- alife():create("agr_fabrik_teleport1", vector():set (43.57,2.49,-14.62), 281116, 663)
-- alife():create("agr_fabrik_teleport1", vector():set (46.16,2.49,-14.24), 283544, 663)
-- alife():create("agr_fabrik_teleport1", vector():set (46.44,2.49,-11.61), 283550, 663)
-- alife():create("agr_fabrik_teleport1", vector():set (44.09,2.49,-7.69), 281740, 663)
-- alife():create("agr_fabrik_teleport1", vector():set (39.02,2.49,-8.44), 277424, 663)
-- alife():create("agr_fabrik_teleport2", vector():set (40.43,2.49,-14.60), 278655, 663)
-- alife():create("agr_fabrik_nopass_teleport", vector():set (28.37,2.46,-9.79), 267875, 459)
end

function agr_fabrik_teleports_delete()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^agr_fabrik_teleport1") then
		sim:release(sobj,true)
		end
	end
end

function release_crictall_receiver2()
local obj = alife():story_object(8390)
  if obj then
   alife():release(obj, true)
 end
end 

-- изломы:
function spawn_fabrik_quest_mobs_tribe1()
alife():create("agr_fabrik_quest_mob1", vector():set (36.82,-0.00,-22.44), 275522, 459)
alife():create("agr_fabrik_quest_mob2", vector():set (36.82,-0.00,-22.44), 275522, 459)
alife():create("agr_fabrik_quest_mob2", vector():set (36.82,-0.00,-22.44), 275522, 459)
alife():create("agr_fabrik_quest_mob2", vector():set (36.82,-0.00,-22.44), 275522, 459)
alife():create("agr_fabrik_quest_mob2", vector():set (36.82,-0.00,-22.44), 275522, 459)
-- alife():create("agr_fabrik_quest_mob2", vector():set (36.82,-0.00,-22.44), 275522, 459)
end
-- кабаны:
function spawn_fabrik_quest_mobs_tribe2()
alife():create("agr_fabrik_quest_mob3", vector():set (-42.26,-0.20,-0.56), 197512, 661)
alife():create("agr_fabrik_quest_mob4", vector():set (26.88,-0.00,-22.18), 265919, 464)
alife():create("agr_fabrik_quest_mob4", vector():set (-22.29,-0.20,22.36), 218076, 473)
alife():create("agr_fabrik_quest_mob4", vector():set (60.22,-0.20,-4.64), 296661, 462)
-- alife():create("agr_fabrik_quest_mob4", vector():set (-42.26,-0.20,-0.56), 197512, 661)
end
-- псевдодоги:
function spawn_fabrik_quest_mobs_tribe3()
alife():create("agr_fabrik_quest_mob5", vector():set (-42.26,-0.20,-0.56), 197512, 661)
alife():create("agr_fabrik_quest_mob6", vector():set (26.88,-0.00,-22.18), 265919, 464)
alife():create("agr_fabrik_quest_mob6", vector():set (-22.29,-0.20,22.36), 218076, 473)
-- alife():create("agr_fabrik_quest_mob6", vector():set (60.22,-0.20,-4.64), 296661, 462)
-- alife():create("agr_fabrik_quest_mob6", vector():set (-42.26,-0.20,-0.56), 197512, 661)
end
-- химеры:
function spawn_fabrik_quest_mobs_tribe4()
alife():create("agr_fabrik_quest_mob7", vector():set (-42.26,-0.20,-0.56), 197512, 661)
alife():create("agr_fabrik_quest_mob8", vector():set (26.88,-0.00,-22.18), 265919, 464)
-- alife():create("agr_fabrik_quest_mob8", vector():set (-22.29,-0.20,22.36), 218076, 473)
-- alife():create("agr_fabrik_quest_mob8", vector():set (60.22,-0.20,-4.64), 296661, 462)
end




function agr_fabrik_seif_release()
local obj = alife():story_object(8380)
  if obj then
   alife():release(obj , true)
  end
end 

function agr_fabrik_seif_spawn()
alife():create("agr_fabrik_seif_shron", vector():set (-9.21,7.49,11.37), 231059, 682)
end

function hunter3_sniper_death_think()
local st = get_hud():GetCustomStatic("hunter3_sniper_death_think") or get_hud():AddCustomStatic("hunter3_sniper_death_think",true)
st.m_endTime = time_global()/1000 + 5
end


function spawn_agr_road_pricep_flies()
alife():create("agr_moving_fly_pricep1", vector():set (-112.51,0.49,-28.95), 127315, 599)
alife():create("agr_moving_fly_pricep1", vector():set (-112.51,0.49,-28.95), 127315, 599)
alife():create("agr_moving_fly_pricep1", vector():set (-112.51,0.49,-28.95), 127315, 599)
alife():create("agr_moving_fly_pricep1", vector():set (-112.51,0.49,-28.95), 127315, 599)
alife():create("agr_moving_fly_pricep1", vector():set (-112.51,0.49,-28.95), 127315, 599)
end


function dynamite_bomb_spawn()
local obj = level_object_by_sid(8403)
local pos = obj:position()
	local sim = alife()
 local sobj = sim:create("dynamite_bomb", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
 sim:assign_story_id(sobj.id, story_ids.dynamite_bomb)
end


function agr_blocks_destroy()
local obj = alife():story_object(8402)
	if obj and obj ~= nil then
	alife():release(obj , true)
	db.actor:give_info_portion ("agr_fabrik_blocks_destroyed")
	end
end



function spawn_garb_zapor_flies()
alife():create("garb_moving_fly1", vector():set (43.67,0.28,167.13), 217218, 358)
alife():create("garb_moving_fly1", vector():set (43.67,0.28,167.13), 217218, 358)
alife():create("garb_moving_fly1", vector():set (43.67,0.28,167.13), 217218, 358)
alife():create("garb_moving_fly1", vector():set (43.67,0.28,167.13), 217218, 358)
alife():create("garb_moving_fly1", vector():set (43.67,0.28,167.13), 217218, 358)
alife():create("garb_moving_fly1", vector():set (43.67,0.28,167.13), 217218, 358)
end



function agr_vagon_hunters_notebook_use()
	if db.actor:dont_has_info("pre_blowout") then
	addon_devices.garb_vagon_hunters_notebook_use()
	end
end
---------------------------------------------------------------------------------------------------------------------------------------------------------

function garb_client3car_delete()
local obj = alife():story_object(8406)
	if obj and obj ~= nil then
	alife():release(obj , true)
	end
end

function garb_client3agent_delete()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^client3_agent") then
		sim:release(sobj,true)
		end
	end
end

function garb_client3guard1delete()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^client3_guard1") then
		sim:release(sobj,true)
		end
	end
end

function garb_client3guard2delete()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^client3_guard2") then
		sim:release(sobj,true)
		end
	end
end

function mark_client3agent_place()
   local obj = alife():story_object(8406)
   local obj_id = obj.id
   if obj_id then
   text = "Посыльный от доктора Пильмана"
	level.map_add_object_spot_ser(obj_id,"crlc_mdl",text)
   end
end



function garb_client2btr_delete()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^client2_btr") then
		sim:release(sobj,true)
		end
	end
end

function garb_client2btr_delete()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^client2_btr") then
		sim:release(sobj,true)
		end
	end
end

function garb_client2agent_delete()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^client2_agent") then
		sim:release(sobj,true)
		end
	end
end

function garb_client2guard1delete()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^client2_guard1") then
		sim:release(sobj,true)
		end
	end
end

function garb_client2guard2delete()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^client2_guard2") then
		sim:release(sobj,true)
		end
	end
end

function garb_client2guard3delete()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^client2_guard3") then
		sim:release(sobj,true)
		end
	end
end

-------------------------------------------------------------------------------------------------------------------------------------------------


function agr_grave_cross_use()
addon_devices.agr_grave_cross_use()
end


function actor_steam_hit(actor, npc, p) -- Проиграть пар на акторе
local pos = db.actor:position()
local fx_particle = "industrial_particles\\exhaust_isparenie"
fx_particle = particles_object(fx_particle)
fx_particle:play_at_pos(pos)
soundtrack.steam_strike()
end

function spawn_agr_nii_fires()
alife():create("agr_nii_moving_fire1", vector():set (-148.02,-0.00,-200.82), 90226, 620)
alife():create("agr_nii_moving_fire2", vector():set (-148.02,-0.00,-200.82), 90226, 620)
alife():create("agr_nii_moving_fire3", vector():set (-148.02,-0.00,-200.82), 90226, 620)
end

function delete_agr_nii_fires()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^agr_nii_moving_fire") then
		sim:release(sobj,true)
		end
	end
end



function play_gaz_hit_on_actor()

   local scientvisuals =
   {
      ["scientific_outfit"] = true,
      ["ecolog_outfit"] = true
   }
if db.actor:alive() then
local suit = db.actor:item_in_slot(6)
local hit = hit()
hit.direction = vector():set(0, 0, 0)
hit.impulse = 0
hit.draftsman = db.actor
hit.power = 0.19
hit.type = hit.chemical
   if db.actor:item_in_slot(6) and scientvisuals[db.actor:item_in_slot(6):section()] and suit:condition() > 0.6 then
   elseif db.actor:item_in_slot(6) and scientvisuals[db.actor:item_in_slot(6):section()] and suit:condition() < 0.6 then
	db.actor:hit(hit)
	soundtrack.actor_coughing()
	agrund_suit_damaged_think()
   else
	db.actor:hit(hit)
	soundtrack.actor_coughing()
   end
   end
end


function agrund_suit_damaged_think()
local st = get_hud():GetCustomStatic("agrund_suit_damaged_think") or get_hud():AddCustomStatic("agrund_suit_damaged_think",true)
st.m_endTime = time_global()/1000 + 3
end


function actor_teleport_doorzone_place1()
	db.actor:set_actor_position(vector():set(-64.17,-11.04,12.89), 3742, 712)
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
end

function actor_teleport_doorzone_place2()
	db.actor:set_actor_position(vector():set(-71.40,-6.49,12.86), 3344, 771)
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
end





function spawn_esc_nighthunter()
	local sim = alife()
 local sobj = sim:create("esc_nighthunter", vector():set (-227.26,-32.65,-249.98), 27057, 40)
 sim:assign_story_id(sobj.id, story_ids.esc_nighthunter)
end

function spawn_esc_nighthunter_item()
local obj = level_object_by_sid(8419)
local pos = obj:position()
alife():create("unic_flyaga_empty", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
end

-----------------------------------------------------------------------------------------------------------------------------------------
function garb_ochkaric_pda_think()
local st = get_hud():GetCustomStatic("garb_ochkaric_pda_think") or get_hud():AddCustomStatic("garb_ochkaric_pda_think",true)
st.m_endTime = time_global()/1000 + 5
end

function garb_ochkarik_habar_zone_away()
	db.actor:set_actor_position(vector():set(74.66,21.87,35.00), 218994, 294)
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
	db.actor:disable_info_portion("garb_zone1_green_portion")
	db.actor:disable_info_portion("garb_zone2_blue_portion")
	db.actor:disable_info_portion("garb_zone3_red_portion")
end

function garb_ochkarik_habar_zone_away1()
	db.actor:set_actor_position(vector():set(72.35,19.64,18.22), 213804, 294)
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
	db.actor:disable_info_portion("garb_zone1_green_portion")
	db.actor:disable_info_portion("garb_zone2_blue_portion")
	db.actor:disable_info_portion("garb_zone3_red_portion")
end

function garb_ochkarik_habar_zone_away2()
	db.actor:set_actor_position(vector():set(100.09,21.57,14.80), 213804, 294)
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
	db.actor:disable_info_portion("garb_zone1_green_portion")
	db.actor:disable_info_portion("garb_zone2_blue_portion")
	db.actor:disable_info_portion("garb_zone3_red_portion")
end

function garb_ochkarik_habar_zone_away3()
	db.actor:set_actor_position(vector():set(81.44,17.20,7.34), 213804, 294)
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
	db.actor:disable_info_portion("garb_zone1_green_portion")
	db.actor:disable_info_portion("garb_zone2_blue_portion")
	db.actor:disable_info_portion("garb_zone3_red_portion")
end




function deatlamp_flash()                
local fx_particle = "1935\\group_items\\expl_07_flash"
local obj = level_object_by_sid(8438)
local pos = obj:position()
local snd = xr_sound.get_safe_sound_object([[anomaly\electra_blast1]])
fx_particle = particles_object(fx_particle)
fx_particle:play_at_pos(pos)
snd:play_no_feedback(obj, sound_object.s3d, 0, obj:position(), 1.0)
level.add_pp_effector("teleport.ppe", 2007, false)
end


function army_drop_heli_timer_start()
	-- amk.g_start_timer("escheli2",1,0,0)
	start_real_timer(3600, "timer_actions.escheli2timer_action")
end




function actor_direction(actor, npc, p)
db.actor:set_actor_direction(p[1], p[2], p[3])
end

function actor_position(actor, npc, p)
db.actor:set_actor_position(vector():set(p[1], p[2], p[3]), p[4], p[5])
end




function hide_indicators(actor, npc)
    level.hide_indicators()
end

function show_indicators(actor, npc)
    level.show_indicators()
end



function chicken_blindzone_rotation()
rnd = math.random(1, 10)
if rnd == 1 then 
db.actor:set_actor_direction(1.2,0.0,0.0)
end
if rnd == 2 then 
db.actor:set_actor_direction(0.5,0.0,0.0)
end
if rnd == 3 then 
db.actor:set_actor_direction(1.4,0.0,0.0)
end
if rnd == 4 then 
db.actor:set_actor_direction(1.9,0.0,0.0)
end
if rnd == 5 then 
db.actor:set_actor_direction(1.0,0.0,0.0)
end
if rnd == 6 then 
db.actor:set_actor_direction(2.2,0.0,0.0)
end
if rnd == 7 then 
db.actor:set_actor_direction(2.2,0.0,0.0)
end
if rnd == 8 then 
db.actor:set_actor_direction(2.8,0.0,0.0)
end
if rnd == 9 then 
db.actor:set_actor_direction(3.0,0.0,0.0)
end
if rnd == 10 then 
db.actor:set_actor_direction(2.4,0.0,0.0)
end
end




function release_agr_kazarma_seif()
local obj = alife():story_object(8446)
  if obj then
   alife():release(obj , true)
  end
end 

function agr_kazarma_seif_spawn()
alife():create("agr_kazarma_seif_shron", vector():set (-149.89,1.10,-175.86), 88080, 669)
end




function spawn_new_hunter3()
db.actor:give_info_portion ("spawn_new_hunter3")
db.actor:set_actor_position(vector():set(-176.85,0.55,-131.89), 59653, 665)
end


function delete_agr_hunter1()
local obj = alife():story_object(8058)
  if obj then
   alife():release(obj , true)
  end
end 

function delete_agr_hunter2()
local obj = alife():story_object(8445)
  if obj then
   alife():release(obj , true)
  end
end 

function delete_agrund_redrik()
local obj = alife():story_object(8448)
  if obj then
   alife():release(obj , true)
  end
end 

function spawn_agrund_snorks_ambush()
alife():create("agrund_ambush_snork1", vector():set (-112.25,-14.23,-30.78), 436, 780)
alife():create("agrund_ambush_snork2", vector():set (-112.25,-14.23,-30.78), 436, 780)
alife():create("agrund_ambush_snork3", vector():set (-112.25,-14.23,-30.78), 436, 780)
alife():create("agrund_ambush_snork4", vector():set (-112.25,-14.23,-30.78), 436, 780)
alife():create("agrund_ambush_snork5", vector():set (-112.25,-14.23,-30.78), 436, 780)
alife():create("agrund_ambush_snork6", vector():set (-112.25,-14.23,-30.78), 436, 780)
end

function spawn_agrund_snorks_ambush2()
alife():create("agrund_ambush_snork7", vector():set (-78.54,-16.51,-111.62), 2906, 785)
alife():create("agrund_ambush_snork8", vector():set (-78.54,-16.51,-111.62), 2906, 785)
alife():create("agrund_ambush_snork9", vector():set (-78.54,-16.51,-111.62), 2906, 785)
alife():create("agrund_ambush_snork10", vector():set (-78.54,-16.51,-111.62), 2906, 785)
alife():create("agrund_ambush_snork11", vector():set (-78.54,-16.51,-111.62), 2906, 785)
end


function spawn_agrund_snorks_ambush3()
alife():create("agrund_ambush_snork12", vector():set (-104.88,-16.45,-4.74), 1125, 759)
alife():create("agrund_ambush_snork12", vector():set (-104.88,-16.45,-4.74), 1125, 759)
alife():create("agrund_ambush_snork12", vector():set (-104.88,-16.45,-4.74), 1125, 759)
alife():create("agrund_ambush_snork12", vector():set (-104.88,-16.45,-4.74), 1125, 759)
alife():create("agrund_ambush_snork12", vector():set (-104.88,-16.45,-4.74), 1125, 759)
end

 
function agrund_hunter_jump_think()
local st = get_hud():GetCustomStatic("agrund_hunter_jump_think") or get_hud():AddCustomStatic("agrund_hunter_jump_think",true)
st.m_endTime = time_global()/1000 + 5
end


function agrund_reservuar_redrik_rescue()
db.actor:set_actor_position(vector():set(-75.20,2.28,-129.42), 3103, 804)
end


function play_agrund_anomaly_particles()
local anom = level_object_by_sid(8219)
local red = level_object_by_sid(8448)
local pos1 = anom:position()
local pos2 = red:position()
local fx_particle = "anomaly2\\studen_blowout"
	fx_particle = particles_object(fx_particle)
	fx_particle:play_at_pos(pos2)
end

function agrund_motor_table_use()
addon_devices.agrund_motor_table_use()
end

function agrund_virus_killing_think()
local st = get_hud():GetCustomStatic("agrund_virus_killing_think") or get_hud():AddCustomStatic("agrund_virus_killing_think",true)
st.m_endTime = time_global()/1000 + 50
end


function agr_nii_teleport_zone_effect()
level.add_pp_effector("teleport.ppe", 2007, false)
db.actor:set_actor_position(vector():set(-130.34,10.00,-199.56), 109198, 629)
alife():create("agr_nii_pribor_guardian", vector():set (-138.72,10.50,-200.71), 100179, 629)
end

function agr_nii_lift_button_use()
addon_devices.agr_nii_lift_button_use()
end

function spawn_agr_nii_ecolog_ambush()
alife():create("agr_nii_ecolog_bloodsucker1", vector():set (-140.73,-0.21,-167.37), 97921, 561)
end

function agr_nii_obj77zone_dollhelp_tip()
	if db.actor:object("wonder_doll") ~= nil then
		news_manager.send_tip(db.actor, "doll_help_tip16", nil, "doll", 12000, nil)
		soundtrack.wonderdoll_sucess_tip34()
	end
end
----------------------------------------------------------------------------------------------------------------------------------

function start_izlom_pervert_dialog()
	if db.actor:dont_has_info("dar_izlom_drugs_task") then
	addon_devices.izlom_pervert_dialog1()
	elseif ( db.actor:dont_has_info("izlom_anomaly_info") and db.actor:object("izlom_drugs") ~= nil ) then
	addon_devices.izlom_pervert_dialog12()
	elseif has_alife_info("izlom_anomaly_info") then
	addon_devices.izlom_pervert_dialog15()
	end
end

function close_dialog()
addon.actor_disable_inventory()
end

function subject_psy_hit()
db.actor.psy_health = - 0.05
end

function subject4_init_dialod()
	local npc = level_object_by_sid(8312)
	db.actor:run_talk_dialog(npc)
end


function kill_subj5()
local npc = level_object_by_sid(8313)
	npc:kill( npc )
end

function x18ambush_start_direction()
db.actor:set_actor_direction(-0.1,0.0,0.0)
end

function x18mashroom_ekran_interface()
addon_devices.mashroom_ekran_interface()
end

function x18rats_task()
	if has_alife_info("x18_ratcatcher_task") then
	spawn_x18food_rats()
	x18food_rats_think()
	end
end

function start_x18pray_timer()
	-- amk.g_start_timer("pray1",0,2,0)
	start_real_timer(2000, "timer_actions.x18pray_timer_action")
end

function spawn_x18food_rats()
rnd = math.random(1, 3)
if rnd == 1 then 
alife():create("x18_food_rat", vector():set (-8.89,4.19,-8.90), 1725, 1166)
alife():create("x18_food_rat", vector():set (-8.89,4.19,-8.90), 1725, 1166)
alife():create("x18_food_rat", vector():set (-8.89,4.19,-8.90), 1725, 1166)
alife():create("x18_food_rat", vector():set (-8.89,4.19,-8.90), 1725, 1166)
alife():create("x18_food_rat", vector():set (-8.89,4.19,-8.90), 1725, 1166)
end
if rnd == 2 then 
alife():create("x18_food_rat", vector():set (8.85,4.20,-24.71), 4039, 1115)
alife():create("x18_food_rat", vector():set (8.85,4.20,-24.71), 4039, 1115)
alife():create("x18_food_rat", vector():set (8.85,4.20,-24.71), 4039, 1115)
alife():create("x18_food_rat", vector():set (8.85,4.20,-24.71), 4039, 1115)
alife():create("x18_food_rat", vector():set (8.85,4.20,-24.71), 4039, 1115)
end
if rnd == 3 then 
alife():create("x18_food_rat", vector():set (-16.14,4.18,15.64), 1118, 1126)
alife():create("x18_food_rat", vector():set (-16.14,4.18,15.64), 1118, 1126)
alife():create("x18_food_rat", vector():set (-16.14,4.18,15.64), 1118, 1126)
alife():create("x18_food_rat", vector():set (-16.14,4.18,15.64), 1118, 1126)
alife():create("x18_food_rat", vector():set (-16.14,4.18,15.64), 1118, 1126)
end
end


function x18food_rats_think()
local st = get_hud():GetCustomStatic("x18food_rats_think") or get_hud():AddCustomStatic("x18food_rats_think",true)
st.m_endTime = time_global()/1000 + 10
end

function x18_freezer_door_think()
local st = get_hud():GetCustomStatic("x18_freezer_door_think") or get_hud():AddCustomStatic("x18_freezer_door_think",true)
st.m_endTime = time_global()/1000 + 5
end


function x18archive_journal_use()
addon_devices.x18archive_journal_interface()
end


function x18archive_seif1spawn()
alife():create("x18archive_seif1_shron", vector():set (6.48,4.30,1.12), 3642, 1116)
end

function x18archive_seif2spawn()
alife():create("x18archive_seif2_shron", vector():set (8.73,4.18,0.11), 3962, 1116)
end

function x18archive_seif3spawn()
alife():create("x18archive_seif3_shron", vector():set (11.48,4.18,0.57), 4416, 1116)
end


function x18mushroom_timer_action()
	if ( has_alife_info("x18_temperature_on") or has_alife_info("x18_pressure_on") or has_alife_info("x18_radiation_on") ) then
	db.actor:give_info_portion ("x18_mashroom_fail")
	end
	if ( db.actor:dont_has_info("x18_temperature_on") or db.actor:dont_has_info("x18_pressure_on") or db.actor:dont_has_info("x18_radiation_on") ) then
	db.actor:give_info_portion ("x18_mashroom_sucess")
	end
end

function x18oficer_lock_use()
addon_devices.x18oficer_lock_interface()
end

function start_x18mashroom_timer()
	-- amk.g_start_timer("mashroom",0,1,0)
	start_real_timer(900, "timer_actions.x18mushromtimer_action")
end


function x18acidroom_seif_spawn()
alife():create("x18acidroom_seif_shron", vector():set (11.62,4.21,-25.39), 4160, 1115)
end

function x18pumps_ekran_interface()
addon_devices.pumps_ekran_interface()
end

-- Ставим метку на себя ----------------------------------------------------------------------------------------------------------------

function add_self_spot(actor, npc, p)
 local metka = p[1] or "green_location"
 local tips = game.translate_string(p[2] or npc:name())
 amk.add_spot_on_map(npc:id(), metka, tips)
end

function remowe_self_spot(actor, npc, p)
 local metka = p[1] or "green_location"
 local tips = game.translate_string(p[2] or npc:name())
 amk.remove_spot_from_map(npc:id(), metka, tips)
end
--------------------------------------------------------------------------------------------------------------------

function travel_port_dar_farm_work()
level.add_pp_effector("teleport.ppe", 2007, false)
db.actor:set_actor_position(vector():set(57.63,0.04,-241.26), 245908, 855) -- к развилке у фабрики
soundtrack.lift_up()
end

function travel_port_dar_factory_work()
level.add_pp_effector("teleport.ppe", 2007, false)
db.actor:set_actor_position(vector():set(109.36,0.04,-28.66), 305545, 981) -- на заправку
soundtrack.lift_up()
end

function travel_port_dar_zapravka_work()
level.add_pp_effector("teleport.ppe", 2007, false)
db.actor:set_actor_position(vector():set(-60.37,0.05,-472.04), 103292, 824) -- к ферме
soundtrack.lift_up()
end


function travel_port_garb_perehod_work()
level.add_pp_effector("teleport.ppe", 2007, false)
db.actor:set_actor_position(vector():set(-43.41,13.52,-84.39), 158711, 296) -- на кучу
soundtrack.lift_up()
end

function travel_port_garb_heap_work()
level.add_pp_effector("teleport.ppe", 2007, false)
db.actor:set_actor_position(vector():set(-196.06,7.92,9.51), 31699, 308) -- к туннелю
soundtrack.lift_up()
end

function travel_port_garb_tunnel_work()
level.add_pp_effector("teleport.ppe", 2007, false)
db.actor:set_actor_position(vector():set(107.58,6.53,221.08), 272660, 362) -- на холм
soundtrack.lift_up()
end

function travel_port_garb_ruins_work()
level.add_pp_effector("teleport.ppe", 2007, false)
db.actor:set_actor_position(vector():set(23.98,2.26,-296.50), 196351, 261) -- к переходу на кордон
soundtrack.lift_up()
end


function travel_port_agr_crossroad_work()
level.add_pp_effector("teleport.ppe", 2007, false)
db.actor:set_actor_position(vector():set(-110.81,10.81,15.56), 129515, 527) -- к болоту
soundtrack.lift_up()
end

function travel_port_agr_nii_work()
level.add_pp_effector("teleport.ppe", 2007, false)
db.actor:set_actor_position(vector():set(153.74,0.30,21.92), 382484, 584) -- к перекрестку
soundtrack.lift_up()
end

function travel_port_agr_swamp_work()
level.add_pp_effector("teleport.ppe", 2007, false)
db.actor:set_actor_position(vector():set(-93.40,0.88,-136.92), 147152, 452) -- к НИИ
soundtrack.lift_up()
end


function travel_port_esc_willage_work()
level.add_pp_effector("teleport.ppe", 2007, false)
db.actor:set_actor_position(vector():set(-2.63,2.83,101.48), 273956, 85) -- к мельнице
soundtrack.lift_up()
end

function travel_port_esc_bridge_work()
level.add_pp_effector("teleport.ppe", 2007, false)
db.actor:set_actor_position(vector():set(301.74,17.96,31.54), 565460, 139) -- к туннелю на ТД
soundtrack.lift_up()
end

function travel_port_esc_tunnel_work()
level.add_pp_effector("teleport.ppe", 2007, false)
db.actor:set_actor_position(vector():set(-120.72,-11.72,-162.05), 133159, 44) -- к хуторку
soundtrack.lift_up()
end
-----------------------------------------------------------------------------------------------------------------------

function spawn_garb_roadcar_habar()
alife():create("body_habar35_2", vector():set (13.81,1.34,-249.45), 186828, 264)
end
-------------------------------------------------------------------------------------------------------------------------

function spawn_garb1_entrance_ambush()
alife():create("garb_entrance_mob1", vector():set (14.37,3.35,-303.85), 187394, 261)
alife():create("garb_entrance_mob1", vector():set (14.37,3.35,-303.85), 187394, 261)
alife():create("garb_entrance_mob1", vector():set (14.37,3.35,-303.85), 187394, 261)
alife():create("garb_entrance_mob1", vector():set (14.37,3.35,-303.85), 187394, 261)
alife():create("garb_entrance_mob1", vector():set (14.37,3.35,-303.85), 187394, 261)
end

function spawn_garb2_entrance_ambush()
alife():create("garb_entrance_mob2", vector():set (254.77,0.85,157.43), 370692, 381)
alife():create("garb_entrance_mob2", vector():set (254.77,0.85,157.43), 370692, 381)
alife():create("garb_entrance_mob2", vector():set (254.77,0.85,157.43), 370692, 381)
alife():create("garb_entrance_mob2", vector():set (254.77,0.85,157.43), 370692, 381)
alife():create("garb_entrance_mob2", vector():set (254.77,0.85,157.43), 370692, 381)
alife():create("garb_entrance_mob2", vector():set (254.77,0.85,157.43), 370692, 381)
end

function spawn_esc_entrance_ambush()
alife():create("esc_entrance_mob", vector():set (21.61,15.96,667.43), 300823, 206)
alife():create("esc_entrance_mob", vector():set (21.61,15.96,667.43), 300823, 206)
alife():create("esc_entrance_mob", vector():set (21.61,15.96,667.43), 300823, 206)
alife():create("esc_entrance_mob", vector():set (21.61,15.96,667.43), 300823, 206)
end

function spawn_dar_entrance_ambush()
alife():create("dar_entrance_mob", vector():set (-166.32,2.02,-186.81), 3536, 862)
alife():create("dar_entrance_mob", vector():set (-166.32,2.02,-186.81), 3536, 862)
alife():create("dar_entrance_mob", vector():set (-166.32,2.02,-186.81), 3536, 862)
alife():create("dar_entrance_mob", vector():set (-166.32,2.02,-186.81), 3536, 862)
alife():create("dar_entrance_mob", vector():set (-166.32,2.02,-186.81), 3536, 862)
end
--------------------------------------------------------------------------------------------------------------

function release_doll_secretzone1()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^doll_secret_zone_esc1") then
		sim:release(sobj,true)
		end
	end
end

function release_doll_secretzone2()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^doll_secret_zone_esc2") then
		sim:release(sobj,true)
		end
	end
end

function release_doll_secretzone3()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^doll_secret_zone_esc3") then
		sim:release(sobj,true)
		end
	end
end

function release_doll_secretzone4()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^doll_secret_zone_garb1") then
		sim:release(sobj,true)
		end
	end
end

function release_doll_secretzone5()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^doll_secret_zone_garb2") then
		sim:release(sobj,true)
		end
	end
end

function release_doll_secretzone6()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^doll_secret_zone_garb3") then
		sim:release(sobj,true)
		end
	end
end

function release_doll_secretzone7()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^doll_secret_zone_ros2") then
		sim:release(sobj,true)
		end
	end
end

function release_doll_secretzone8()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^doll_secret_zone_ros3") then
		sim:release(sobj,true)
		end
	end
end

function release_doll_secretzone9()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^doll_secret_zone_yan1") then
		sim:release(sobj,true)
		end
	end
end

function release_doll_secretzone10()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^doll_secret_zone_yan2") then
		sim:release(sobj,true)
		end
	end
end
-------------------------------------------------------------------------------------------------------------

function start_addon_intro(actor, npc)
	game.start_tutorial("addon_intro")
end

function start()
level.add_pp_effector("agr_u_fade.ppe", 1007, false)
start_real_timer(3, "timer_actions.start_spawn")
end
-------------------------------------------------------------------------------------------------------------

function spawn_garb_hangar_ufo_static()
	local sim = alife()
 local sobj = sim:create("garb_hangar_ufo_static", vector():set (-98.20,29.11,10.00), 110350, 319)
 sim:assign_story_id(sobj.id, story_ids.garb_hangar_ufo_static)
end

function spawn_garb_hangar_ufo2()
	local sim = alife()
 local sobj = sim:create("garb_hangar_ufo2", vector():set (-98.20,29.11,10.00), 110350, 319)
 sim:assign_story_id(sobj.id, story_ids.garb_hangar_ufo2)
end

function spawn_garb_hangar_ufo_static2()
	local sim = alife()
 local sobj = sim:create("garb_hangar_ufo_static2", vector():set (-76.95,50.56,120.30), 175846, 354)
 sim:assign_story_id(sobj.id, story_ids.garb_hangar_ufo_static2)
end

function spawn_garb_hangar_ufo3()
alife():create("garb_hangar_ufo3", vector():set (-76.95,50.56,120.30), 175846, 354)
end

function doll_ufo_atack_alarm()
	if db.actor:object("wonder_doll") ~= nil then
	news_manager.send_tip(db.actor, "wonderdoll_ufo_tip2", nil, "doll", 5000, nil)
	soundtrack.wonderdoll_sucess_tip16()
	end
end
---------------------------------------------------------------------------------------------------------------

function x18kitchen_seif_spawn()
alife():create("x18kitchen_seif", vector():set (25.06,4.18,19.45), 6516, 1120)
end

function subj4remoralization_tip1()
local st = get_hud():GetCustomStatic("subj4remoralization_tip1") or get_hud():AddCustomStatic("subj4remoralization_tip1",true)
st.m_endTime = time_global()/1000 + 10
end

function subj4remoralization_tip2()
local st = get_hud():GetCustomStatic("subj4remoralization_tip2") or get_hud():AddCustomStatic("subj4remoralization_tip2",true)
st.m_endTime = time_global()/1000 + 12
end

function actor_pervert_to_zombied()
addon.invisible_outfit_wear()
addon.you_are_zombied_think()
end

function x18_remoral_blow_think()
local st = get_hud():GetCustomStatic("x18_remoral_blow_think") or get_hud():AddCustomStatic("x18_remoral_blow_think",true)
st.m_endTime = time_global()/1000 + 6
end

function actor_goto_doctor_trap()
db.actor:set_actor_position(vector():set(23.61,-6.61,-16.05), 6291, 1140)
db.actor:give_info_portion ("x18_doctor_trap")
end

function x18_doctor_init_dialog()
	local npc = level_object_by_sid(8474)
	db.actor:run_talk_dialog(npc)
end

function x18doctors_seif_spawn()
alife():create("x18doctors_seif_shron", vector():set (28.04,-6.62,-18.50), 6737, 1140)
end


function delete_x18subject2()
local obj = alife():story_object(8310)
  if obj then
   alife():release(obj , true)
  end
end 

function delete_x18subject3()
local obj = alife():story_object(8311)
  if obj then
   alife():release(obj , true)
  end
end 

function delete_x18subject5()
local obj = alife():story_object(8313)
  if obj then
   alife():release(obj , true)
  end
end 

function delete_x18subject6()
local obj = alife():story_object(8314)
  if obj then
   alife():release(obj , true)
  end
end 

function delete_x18cattle1()
local obj = alife():story_object(8456)
  if obj then
   alife():release(obj , true)
  end
end 

function delete_x18cattle2()
local obj = alife():story_object(8457)
  if obj then
   alife():release(obj , true)
  end
end 
--------------------------------------------------------------------------------------------------------------------------------
function hide_weapon()
db.actor:hide_weapon()
end

function restore_weapon()
db.actor:restore_weapon()
end
--------------------------------------------------------------------------------------------------------------------------------------

function dar_hunter4_tip()
news_manager.send_tip(db.actor, "dar_hunter4_tip", nil, "stalker", 10000, nil)
end

function actor_goto_building_trap()
db.actor:set_actor_position(vector():set(44.02,-2.50,-59.84), 229884, 1092)
send_actor_items_to_dar_building_box()
end

function send_actor_items_to_dar_building_box()
--[[local box = level_object_by_sid(8486)
if box then
for i = 0, db.actor:object_count() - 1 do
local obj = db.actor:object(i)
if obj and not (system_ini():line_exist(obj:section(), "quest_item") and system_ini():r_bool(obj:section(), "quest_item")) then db.actor:transfer_item(obj, box) end
end
end]]
transfer_to_box(8486)
end

function actor_teleport_to_dar_koridor()
db.actor:set_actor_position(vector():set(-5.99,6.32,-176.90), 166523, 823)
release_dar_hunter()
end

function delete_x18subject6()
local obj = alife():story_object(8314)
  if obj then
   alife():release(obj , true)
  end
end 

function release_dar_hunter()
local obj = alife():story_object(8059)
  if obj then
   alife():release(obj , true)
  end
end 


function dar_guard_hunter_rasstrel()
local npc1 = level_object_by_sid(8483) -- палач
local npc2 = level_object_by_sid(8481) -- жертва
local bw = (wm and wm:get_weapon()) or npc1:best_weapon()
	npc1:set_sight(look.fire_point, npc2:bone_position("bip01_spine2"))
	npc1:set_item(object.fire1, bw, 1000, 5000)
end


function die(actor, npc, p)
	if p and p[1] then
		npc = get_story_object(p[1])
	end
	if npc ~= nil and npc:alive() then
		npc:kill(npc)
	end
end

function dar_build_guard_alarm()
	if  db.actor:dont_has_info("dar_build_guard_alarm")  then
		db.actor:give_info_portion ("dar_build_guard_alarm")
		soundtrack.dar_build_guard_alarm()
		dar_build_guard_alarm_think()
	end
	if  db.actor:dont_has_info("dar_build_guard_violence")  then
		db.actor:give_info_portion ("dar_build_guard_violence")
	end
end

function dar_build_guard_alarm_think()
local st = get_hud():GetCustomStatic("dar_build_guard_alarm_think") or get_hud():AddCustomStatic("dar_build_guard_alarm_think",true)
st.m_endTime = time_global()/1000 + 5
end


function play_particle_on_t_point()
local obj = level_object_by_sid(8487)
	if obj then
	local pos = obj:position()
	-- local fx_particle = "_ecp\\group_items\\anomaly_bold_distortion_00"
	local fx_particle = "1935\\group_items\\rpg7_flash_00"
	-- local fx_particle = "amk\\ice_enter_small"
	-- local fx_particle = "damage_fx\\body_glow"
		fx_particle = particles_object(fx_particle)
		fx_particle:play_at_pos(pos)
	end
end

function release_script_radio_point()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^script_radio_point") then
		sim:release(sobj,true)
		end
	end
end


function script_magnitofon_use()
addon_devices.magnitofon_interface()
end

function spawn_reketirs_assistant2()
addon_dialogs.spawn_reketirs_assistant2()
end
--------------------------------------------------------------------------------------------------------------------------
function clear_inventory(actor, npc, p)
amk.clear_npc_inventory(npc)
end

function clear_fenix_inventory()
local obj = level_object_by_sid(8847)
if npc then
	amk.clear_npc_inventory(npc)
end
end
--------------------------------------------------------------------------------------------------------------------------

-- function release_garb_btr()
-- local obj = level_object_by_sid(8308)
-- local car = obj:get_car()
-- if car and car.SetfHeath then
--  car:SetfHeath(0.01)
-- end
-- end

function hit_garb_btr() --??
local obj = level_object_by_sid(8979)
  if obj then
   		local h = hit()
		h.direction = vector():set(0, 0, 0)
		h.impulse = 0
		h.draftsman = db.actor
		h.power = 0.98
		h.type = hit.telepatic
		obj:hit(h)
  end
end

function bar_roadbus_zone_effect1()
-- level.add_pp_effector("nosferatu.ppe", 2007, false) -- розовая пелена и двоение в глазах
-- level.add_pp_effector("electra.ppe", 2007, false) -- голубоватый тон
-- level.add_pp_effector("killer.ppe", 2007, false) -- темно-красная пелена
-- level.add_pp_effector("nano.ppe", 2007, false) -- снежение по всему экрану
-- level.add_pp_effector("bast.ppe", 2007, false) -- сильное засветление
-- level.add_pp_effector("psychic.ppe", 2007, false) -- постоянный желтоватый тон
-- level.add_pp_effector("svoboda.ppe", 2007, false) -- сильное двоение в глазах
db.actor.health = - 0.001
end

function bar_roadbus_zone_effect2()
if db.actor:alive() then
	kill_actor()
	addon.invisible_outfit_wear2()
	local obj = alife():create('sceleton_weak', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	obj:on_death()
	soundtrack.bar_bus_zone_death()
end
end

function bar_roadbus_teleport()
db.actor:set_actor_position(vector():set(389.68,13.27,-339.55), 88217, 1303)
end


function spawn_bar_benzovoz_mobs()
alife():create("bar_benzovoz_mob", vector():set (406.15,18.56,-244.35), 95317, 1287)
alife():create("bar_benzovoz_mob", vector():set (406.15,18.56,-244.35), 95317, 1287)
alife():create("bar_benzovoz_mob", vector():set (406.15,18.56,-244.35), 95317, 1287)
alife():create("bar_benzovoz_mob", vector():set (406.15,18.56,-244.35), 95317, 1287)
alife():create("bar_benzovoz_mob", vector():set (406.15,18.56,-244.35), 95317, 1287)
alife():create("bar_benzovoz_mob", vector():set (406.15,18.56,-244.35), 95317, 1287)
end


function actor_goto_bar_tower()
db.actor:set_actor_position(vector():set(152.88,4.34,107.69), 40595, 1206)
end



function bar_kamaz_seif_spawn()
alife():create("bar_kamaz_seif_shron", vector():set (274.14,5.03,-135.83), 69007, 1279)
end






function play_particle_on_af_top()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("af_top_static") then
	local pos = sobj.position
	-- local fx_particle = "_ecp\\group_items\\anomaly_bold_distortion_00"
	-- local fx_particle = "1935\\group_items\\rpg7_flash_00"
	-- local fx_particle = "amk\\ice_enter_small"
	-- local fx_particle = "damage_fx\\body_glow"
	local fx_particle = "anomaly2\\group_items\\sarcofag_face_align_00"
		if sobj then
		fx_particle = particles_object(fx_particle)
		fx_particle:play_at_pos(pos)
		end
	end
end
end


function release_af_top_zone()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^af_top_zone") then
		sim:release(sobj,true)
		end
	end
end

function release_helicrash_survival()
local obj = alife():story_object(8495)
  if obj then
   alife():release(obj , true)
  end
end


function spawn_bar_tower_nopass_zone()
	local sobj = alife():create('bar_tower_nopass_zone', vector():set (149.56,0.10,110.74), 40090, 1207)
	-- register_story_object(sobj.id, story_ids.garb_vagon_door_zone)
--[[	local t = m_net_utils.get_restrictor_data(sobj)
	t.shapes = {}
	local shape1 = {}
	shape1.shtype = 0
	shape1.center = vector():set(0,0,0)
	shape1.radius = 3
	t.restrictor_type = 2
	table.insert(t.shapes,shape1)
	m_net_utils.set_restrictor_data(t,sobj)]]
	local pk = get_netpk(sobj)
	local data = pk:get()
	data.restrictor_type = restrictor_type.DefaultRestrictorTypeIn --тип 2
	data.shapes:addSphere(3)
	pk:set(data)
end

function bar_karlik_talk1think()
local st = get_hud():GetCustomStatic("bar_karlik_talk1_think") or get_hud():AddCustomStatic("bar_karlik_talk1_think",true)
st.m_endTime = time_global()/1000 + 1
	if db.actor:dont_has_info("bar_karlik_meet") then
		db.actor:give_info_portion ("bar_karlik_meet")
	end
end


function bar_karlik_talk2think()
local st = get_hud():GetCustomStatic("bar_karlik_talk2_think") or get_hud():AddCustomStatic("bar_karlik_talk2_think",true)
st.m_endTime = time_global()/1000 + 1
	if db.actor:dont_has_info("bar_karlik_meet") then
		db.actor:give_info_portion ("bar_karlik_meet")
	end
end

function bar_karlik_talk3think()
local st = get_hud():GetCustomStatic("bar_karlik_talk3_think") or get_hud():AddCustomStatic("bar_karlik_talk3_think",true)
st.m_endTime = time_global()/1000 + 1
	if db.actor:dont_has_info("bar_karlik_meet") then
		db.actor:give_info_portion ("bar_karlik_meet")
	end
end

function bar_karlik_talk4think()
local st = get_hud():GetCustomStatic("bar_karlik_talk4_think") or get_hud():AddCustomStatic("bar_karlik_talk4_think",true)
st.m_endTime = time_global()/1000 + 1
end

function start_bar_karlik_dialog()
	addon_devices.bar_karlik_dialog1()
end


function bar_bunkerdoor_trigger1_use1()
	level.add_pp_effector("agr_u_fade.ppe", 2007, false)
end

function bar_bunkerdoor_trigger1_use2()
	db.actor:set_actor_position(vector():set(184.55,0.04,123.74), 45527, 1190)
end

function bar_bunkerdoor_trigger2_use2()
	db.actor:set_actor_position(vector():set(183.57,0.03,123.59), 45421, 1191)
end

function bar_bunkerdoor_trigger1_use3()
	db.actor:set_actor_position(vector():set(151.74,-21.06,74.75), 40435, 1181)
end

function bar_bunkerdoor_trigger1_use4()
	db.actor:set_actor_position(vector():set(226.47,-5.04,137.83), 55485, 1199)
end


function spawn_actor_clone_arena()

end


function bar_arena_pseudogig_bulletproof_think()
--local st = get_hud():GetCustomStatic("bar_arena_pseudogig_bulletproof_think") or get_hud():AddCustomStatic("bar_arena_pseudogig_bulletproof_think",true)
--st.m_endTime = time_global()/1000 + 2
--get_hud():RemoveCustomStatic("bar_arena_pseudogig_bulletproof_think2",true)
end

function bar_arena_pseudogig_bulletproof_think2()
local st = get_hud():GetCustomStatic("bar_arena_pseudogig_bulletproof_think2") or get_hud():AddCustomStatic("bar_arena_pseudogig_bulletproof_think2",true)
st.m_endTime = time_global()/1000 + 4
get_hud():RemoveCustomStatic("bar_arena_pseudogig_bulletproof_think",true)
end

function bar_arena_seif_spawn()
alife():create("bar_arena_seif_shron", vector():set (147.92,-21.05,78.07), 39676, 1181)
end

function release_bar_heli_static()
local obj = alife():story_object(8521)
  if obj then
   alife():release(obj , true)
  end
end
----------------------------------------------------------------------------------------------------------------------------------------------
function delete_bar_arena_gigant_zone()
	if xr_conditions.actor_in_bar_sklad_zone1() == true then
		delete_bar_arena_gigant_point1()
		spawn_bar_arena_gigant_points1()
	elseif xr_conditions.actor_in_bar_sklad_zone2() == true then
		delete_bar_arena_gigant_point2()
		spawn_bar_arena_gigant_points2()
	elseif xr_conditions.actor_in_bar_sklad_zone3() == true then
		delete_bar_arena_gigant_point3()
		spawn_bar_arena_gigant_points3()
	elseif xr_conditions.actor_in_bar_sklad_zone4() == true then
		delete_bar_arena_gigant_point4()
		spawn_bar_arena_gigant_points4()
	end
end

function delete_bar_arena_gigant_point1()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^bar_arena_gigant_point1") then
		sim:release(sobj,true)
		end
	end
end

function delete_bar_arena_gigant_point2()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^bar_arena_gigant_point2") then
		sim:release(sobj,true)
		end
	end
end

function delete_bar_arena_gigant_point3()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^bar_arena_gigant_point3") then
		sim:release(sobj,true)
		end
	end
end

function delete_bar_arena_gigant_point4()
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^bar_arena_gigant_point4") then
		sim:release(sobj,true)
		end
	end
end



function spawn_bar_arena_gigant_points1()
rnd = math.random(1, 3)
if rnd == 1 then 
spawn_bar_arena_gigant_point2()
end
if rnd == 2 then 
spawn_bar_arena_gigant_point3()
end
if rnd == 3 then 
spawn_bar_arena_gigant_point4()
end
end

function spawn_bar_arena_gigant_points2()
rnd = math.random(1, 3)
if rnd == 1 then 
spawn_bar_arena_gigant_point1()
end
if rnd == 2 then 
spawn_bar_arena_gigant_point3()
end
if rnd == 3 then 
spawn_bar_arena_gigant_point4()
end
end

function spawn_bar_arena_gigant_points3()
rnd = math.random(1, 3)
if rnd == 1 then 
spawn_bar_arena_gigant_point2()
end
if rnd == 2 then 
spawn_bar_arena_gigant_point1()
end
if rnd == 3 then 
spawn_bar_arena_gigant_point3()
end
end

function spawn_bar_arena_gigant_points4()
rnd = math.random(1, 3)
if rnd == 1 then 
spawn_bar_arena_gigant_point2()
end
if rnd == 2 then 
spawn_bar_arena_gigant_point3()
end
if rnd == 3 then 
spawn_bar_arena_gigant_point1()
end
end



function spawn_bar_arena_gigant_point1()
local sim = alife()
 local sobj = sim:create("bar_arena_gigant_point1", vector():set (151.78,-17.76,114.51), 40485, 1205)
 sim:assign_story_id(sobj.id, story_ids.arena_gigant_zone1)
end

function spawn_bar_arena_gigant_point2()
	local sim = alife()
 local sobj = sim:create("bar_arena_gigant_point2", vector():set (155.04,-17.74,105.82), 40590, 1205)
 sim:assign_story_id(sobj.id, story_ids.arena_gigant_zone2)
end

function spawn_bar_arena_gigant_point3()
local sim = alife()
 local sobj = sim:create("bar_arena_gigant_point3", vector():set (146.53,-18.94,90.43), 39397, 1181)
 sim:assign_story_id(sobj.id, story_ids.arena_gigant_zone3)
end

function spawn_bar_arena_gigant_point4()
	local sim = alife()
 local sobj = sim:create("bar_arena_gigant_point4", vector():set (159.05,-17.74,82.82), 41486, 1211)
 sim:assign_story_id(sobj.id, story_ids.arena_gigant_zone4)
end




function actor_goto_bar_yard()
	db.actor:set_actor_position(vector():set(145.96,-0.01,124.39), 39459, 1204)
end

function play_particle_on_bar_vakcine_heli()
local obj = level_object_by_sid(8522)
	if obj then
	local pos = obj:position()
	local fx_particle = "a_ufp_particles\\group_ufp\\toxic_gun_effect"
		fx_particle = particles_object(fx_particle)
		fx_particle:play_at_pos(pos)
		local snd_obj = xr_sound.get_safe_sound_object([[anomaly\bfuzz_blowout]])
		snd_obj:play_at_pos(obj, obj:position(), 0, sound_object.s3d)
		db.actor:disable_info_portion("sickness")
	end
end



function play_arena_particle_on_me(actor,npc,p)
local pos = npc:position()
local sobj = alife():object( npc:id() )
if sobj then
	-- local fx_particle1 = particles_object("anomaly2\\bold_idle_sarkofag")
	local fx_particle1 = particles_object("anomaly2\\monolith_golo")
	fx_particle1:play_at_pos(pos)
end
end


function habar_pickup_think()
local st = get_hud():GetCustomStatic("habar_pickup_think") or get_hud():AddCustomStatic("habar_pickup_think",true)
st.m_endTime = time_global()/1000 + 5
end



function blokpost_alarm3()
	if db.actor:dont_has_info("blokpost_alarm3") then
		db.actor:give_info_portion ("blokpost_alarm3")
	end
end

-------------------------------------------------------------------------------------------------------------------------------------
function pain_effect()
if ( has_alife_info("pain") and db.actor:alive() ) then
local hud = get_hud()
	hud:AddCustomStatic("pain", true)
	soundtrack.actor_pain()
	level.add_cam_effector("camera_effects\\earthquake.anm", 999, false, "")
end
end


--------------------------------------------------------------------------------------------------------------------------------------
function bowling_result1()
	level.enable_input()
	amk.spawn_item_in_inv("boarleg_soup")
	amk.spawn_item_in_inv("flyaga_empty")
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	soundtrack.prepare_to_eat()
end

function bowling_result2()
	level.enable_input()
	amk.spawn_item_in_inv("flesheye_soup")
	amk.spawn_item_in_inv("flyaga_empty")
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	soundtrack.prepare_to_eat()
end

function bowling_result3()
	level.enable_input()
	amk.spawn_item_in_inv("pseudotail_soup")
	amk.spawn_item_in_inv("flyaga_empty")
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	soundtrack.prepare_to_eat()
end

function bowling_result4()
	level.enable_input()
	amk.spawn_item_in_inv("krovosos_soup")
	amk.spawn_item_in_inv("flyaga_empty")
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	soundtrack.prepare_to_eat()
end

function bowling_result5()
	level.enable_input()
	amk.spawn_item_in_inv("tushkano_soup")
	amk.spawn_item_in_inv("flyaga_empty")
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	soundtrack.prepare_to_eat()
end

function bowling_result6()
	level.enable_input()
	amk.spawn_item_in_inv("pseudogig_soup")
	amk.spawn_item_in_inv("flyaga_empty")
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	soundtrack.prepare_to_eat()
end

function bowling_result7()
	level.enable_input()
	amk.spawn_item_in_inv("conserva_soup")
	amk.spawn_item_in_inv("flyaga_empty")
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	soundtrack.prepare_to_eat()
end

function bowling_result8()
	level.enable_input()
	amk.spawn_item_in_inv("salo_soup")
	amk.spawn_item_in_inv("flyaga_empty")
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	soundtrack.prepare_to_eat()
end


function bowling_result9()
	level.enable_input()
	amk.spawn_item_in_inv("teapot_full")
	amk.spawn_item_in_inv("flyaga_empty")
	amk.remove_item_from_inventory(db.actor:object("teapot"),actor)
	amk.remove_item_from_inventory(db.actor:object("teapot_pack"),actor)
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
end

function bowling_result10()
	level.enable_input()
	amk.spawn_item_in_inv("flyaga_full")
	amk.remove_item_from_inventory(db.actor:object("flyaga_bad"),actor)
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
end
------------------------------------------------------------------------------------------------------------------------


function agr_nii_buttons_power_on_think()
local st = get_hud():GetCustomStatic("agr_nii_buttons_power_on_think") or get_hud():AddCustomStatic("agr_nii_buttons_power_on_think",true)
st.m_endTime = time_global()/1000 + 5
end

-------------------------------------------------------------------------------------------------------------------------------


function karma_up()
local murder = starvation.get_murder()
local karma = starvation.get_karma()
	if karma<0.9 then starvation.add_karma(0.3) end	--	прибавляем чуток к карме;
	if murder>0.02 then starvation.set_murder(0) end	--	зануляем совесть, чтобы можно было спокойно спать;
	if db.actor:object("wonder_doll") ~= nil then
		soundtrack.wonderdoll_sucess_tip35()
		give_dolltip1()
	end
end

function karma_down()
local karma = starvation.get_karma()
	if karma>0.3 then starvation.add_karma(-0.3)
	end
	if db.actor:object("wonder_doll") ~= nil then
	soundtrack.wonderdoll_sucess_tip37()
	give_dolltip1()
	end
end

function karma_down2()
local karma = starvation.get_karma()
	if karma>0.1 then starvation.add_karma(-0.1)
	end
	if db.actor:object("wonder_doll") ~= nil then
		soundtrack.wonderdoll_sucess_tip37()
		give_dolltip1()
	end
end
---------------------------------------------------------------------------------------------------------------------------------

function grave_dig_results()
local obj1 = level_object_by_sid(8284)
local obj2 = level_object_by_sid(8285)
local obj3 = level_object_by_sid(8286)
local obj4 = level_object_by_sid(8287)
local obj5 = level_object_by_sid(8288)
local obj6 = level_object_by_sid(8293)
local obj7 = level_object_by_sid(8294)
local obj8 = level_object_by_sid(8295)
local obj9 = level_object_by_sid(8296)
local obj10 = level_object_by_sid(8297)
local obj11 = level_object_by_sid(8298)
local obj12 = level_object_by_sid(8299)
local obj13 = level_object_by_sid(8300)
local obj14 = level_object_by_sid(8301)
local obj15 = level_object_by_sid(8302)

if ( obj1 ~= nil and obj1:position():distance_to_sqr(db.actor:position())  <= 5*5 ) then
grave_dig_result1()
elseif ( obj2 ~= nil and obj2:position():distance_to_sqr(db.actor:position())  <= 5*5 ) then
grave_dig_result2()
elseif ( obj3 ~= nil and obj3:position():distance_to_sqr(db.actor:position())  <= 5*5 ) then
grave_dig_result3()
elseif ( obj4 ~= nil and obj4:position():distance_to_sqr(db.actor:position())  <= 5*5 ) then
grave_dig_result4()
elseif ( obj5 ~= nil and obj5:position():distance_to_sqr(db.actor:position())  <= 5*5 ) then
grave_dig_result5()
elseif ( obj6 ~= nil and obj6:position():distance_to_sqr(db.actor:position())  <= 5*5 ) then
grave_dig_result6()
elseif ( obj7 ~= nil and obj7:position():distance_to_sqr(db.actor:position())  <= 5*5 ) then
grave_dig_result7()
elseif ( obj8 ~= nil and obj8:position():distance_to_sqr(db.actor:position())  <= 5*5 ) then
grave_dig_result8()
elseif ( obj9 ~= nil and obj9:position():distance_to_sqr(db.actor:position())  <= 5*5 ) then
grave_dig_result9()
elseif ( obj10 ~= nil and obj10:position():distance_to_sqr(db.actor:position())  <= 5*5 ) then
grave_dig_result10()
elseif ( obj11 ~= nil and obj11:position():distance_to_sqr(db.actor:position())  <= 5*5 ) then
grave_dig_result11()
elseif ( obj12 ~= nil and obj12:position():distance_to_sqr(db.actor:position())  <= 5*5 ) then
grave_dig_result12()
elseif ( obj13 ~= nil and obj13:position():distance_to_sqr(db.actor:position())  <= 5*5 ) then
grave_dig_result13()
elseif ( obj14 ~= nil and obj14:position():distance_to_sqr(db.actor:position())  <= 5*5 ) then
grave_dig_result14()
elseif ( obj15 ~= nil and obj15:position():distance_to_sqr(db.actor:position())  <= 5*5 ) then
grave_dig_result15()
end
end

function grave_dig_result1()
	addon_dialogs.deadman_head_cross1_release()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	local pos = db.actor:position()
	alife():create("scelet_bone1", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone4", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("cross_desroyed", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	xr_effects.karma_down2()
	alife():create("esc_grave1_treasure", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	db.actor:give_info_portion ("grave1")
end

function grave_dig_result2()
	addon_dialogs.deadman_head_cross2_release()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	local pos = db.actor:position()
	alife():create("scelet_bone1", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone4", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("cross_desroyed", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	xr_effects.karma_down2()
	alife():create("esc_grave2_treasure", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	db.actor:give_info_portion ("grave2")
end

function grave_dig_result3()
	addon_dialogs.deadman_head_cross3_release()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	local pos = db.actor:position()
	alife():create("scelet_bone1", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone4", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("cross_desroyed", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	xr_effects.karma_down2()
	alife():create("esc_grave3_treasure", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	db.actor:give_info_portion ("grave3")
end

function grave_dig_result4()
	addon_dialogs.deadman_head_cross4_release()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	local pos = db.actor:position()
	alife():create("scelet_bone1", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone4", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("cross_desroyed", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	xr_effects.karma_down2()
	alife():create("esc_grave4_treasure", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	db.actor:give_info_portion ("grave4")
end

function grave_dig_result5()
	addon_dialogs.deadman_head_cross5_release()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	local pos = db.actor:position()
	alife():create("scelet_bone1", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone4", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("cross_desroyed", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	xr_effects.karma_down2()
	alife():create("esc_grave5_treasure", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	db.actor:give_info_portion ("grave5")
end

function grave_dig_result6()
	addon_dialogs.deadman_head_cross6_release()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	local pos = db.actor:position()
	alife():create("scelet_bone1", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone4", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("cross_desroyed", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	xr_effects.karma_down2()
	alife():create("esc_grave6_treasure", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	db.actor:give_info_portion ("grave6")
end

function grave_dig_result7()
	addon_dialogs.deadman_head_cross7_release()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	local pos = db.actor:position()
	alife():create("scelet_bone1", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone4", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("cross_desroyed", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	xr_effects.karma_down2()
	alife():create("esc_grave7_treasure", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	db.actor:give_info_portion ("grave7")
end

function grave_dig_result8()
	addon_dialogs.deadman_head_cross8_release()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	local pos = db.actor:position()
	alife():create("scelet_bone1", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone4", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("cross_desroyed", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	xr_effects.karma_down2()
	alife():create("esc_grave8_treasure", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	db.actor:give_info_portion ("grave8")
end

function grave_dig_result9()
	addon_dialogs.deadman_head_cross9_release()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	local pos = db.actor:position()
	alife():create("scelet_bone1", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone4", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("cross_desroyed", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	xr_effects.karma_down2()
	alife():create("esc_grave9_treasure", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	db.actor:give_info_portion ("grave9")
end

function grave_dig_result10()
	addon_dialogs.deadman_head_cross10_release()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	local pos = db.actor:position()
	alife():create("scelet_bone1", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone4", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("cross_desroyed", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	xr_effects.karma_down2()
	alife():create("esc_grave10_treasure", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	db.actor:give_info_portion ("grave10")
end

function grave_dig_result11()
	addon_dialogs.deadman_head_cross11_release()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	local pos = db.actor:position()
	alife():create("scelet_bone1", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone4", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("cross_desroyed", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	xr_effects.karma_down2()
	alife():create("esc_grave11_treasure", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	db.actor:give_info_portion ("grave11")
end

function grave_dig_result12()
	addon_dialogs.deadman_head_cross12_release()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	local pos = db.actor:position()
	alife():create("scelet_bone1", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone4", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("cross_desroyed", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	xr_effects.karma_down2()
	alife():create("esc_grave12_treasure", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	db.actor:give_info_portion ("grave12")
end

function grave_dig_result13()
	addon_dialogs.deadman_head_cross13_release()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	local pos = db.actor:position()
	alife():create("scelet_bone1", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone4", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("cross_desroyed", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	xr_effects.karma_down2()
	alife():create("esc_grave13_treasure", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	db.actor:give_info_portion ("grave13")
end

function grave_dig_result14()
	addon_dialogs.deadman_head_cross14_release()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	local pos = db.actor:position()
	alife():create("scelet_bone1", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone4", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("cross_desroyed", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	xr_effects.karma_down2()
	alife():create("esc_grave14_treasure", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	db.actor:give_info_portion ("grave14")
end

function grave_dig_result15()
	addon_dialogs.deadman_head_cross15_release()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	local pos = db.actor:position()
	alife():create("scelet_bone1", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone2", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone3", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("scelet_bone4", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	alife():create("cross_desroyed", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	xr_effects.karma_down2()
	alife():create("esc_grave15_treasure", vector():set(pos.x+1, pos.y, pos.z), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	db.actor:give_info_portion ("grave15")
end


function obelisk_dig_result()
	level.enable_input()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.actor_disable_inventory()
	addon_dialogs.deadman_head_random_find()
end
-----------------------------------------------------------------------------------------------------------------------------------------------

function camerer_box_guardian_atack()
rnd = math.random(1, 2)
if rnd == 1 then 
	db.actor:set_actor_position(vector():set(-142.21,40.00,-172.72), 96337, 548)
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
end
if rnd == 2 then 
	db.actor:set_actor_position(vector():set(-125.34,-0.00,-163.40), 114490, 564)
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
end
end


function spawn_af_shell()
alife():create("af_shell", vector():set (28.19,-6.61,-14.91), 6746, 1140)
end

function x18doctors_barocamera()
addon_devices.x18doctors_barocamera_use()
end


function dar_fabrik_burers_see_me_think()
local st = get_hud():GetCustomStatic("dar_fabrik_burers_see_me_think") or get_hud():AddCustomStatic("dar_fabrik_burers_see_me_think",true)
st.m_endTime = time_global()/1000 + 5
	if db.actor:dont_has_info("dar_fabrik_burers_alarm") then
		db.actor:give_info_portion ("dar_fabrik_burers_alarm")
	end
	if db.actor:object("wonder_doll") ~= nil then
		-- soundtrack.wonderdoll_sucess_tip37()
		news_manager.send_tip(db.actor, "doll_fabrik_burers_alarm_tip", nil, "doll", 6000, nil)
	end
end


function check_dar_build_guard_violence()
	achievements.check_dar_build_guard_violence()
end



---------------------------------------------------------------------------------------------------------------------------
function dar_vagon_zone_vorpal_dollhelp_tip()
	if db.actor:object("wonder_doll") ~= nil then
		soundtrack.wonderdoll_sucess_tip43()
		news_manager.send_tip(db.actor, "dar_vagon_zone_vorpal_dollhelp_tip", nil, "doll", 20000, nil)
		mark_vorpal_tent()
	end
end

function mark_vorpal_tent()
   local obj = alife():story_object(8536)
   local obj_id = obj.id
   if obj_id then
   text = "Лагерь Ворпала" 
	level.map_add_object_spot_ser(obj_id,"crlc_mdl",text)
   end
end
------------------------------------------------------------------------------------------------------------------------------

function esc_village_dog_killed_by_actor_tip()
		news_manager.send_tip(db.actor, "esc_village_dog_killed_by_actor_tip", nil, "default", 7000, nil)
end


function unmark_bomzh_habar()
		addon_dialogs.unmark_bomzh_habar()
end

function spawn_big_condensator()
if ( db.actor:dont_has_info("bar_koteln_ventilyator_charge1") and db.actor:dont_has_info("bar_koteln_ventilyator_charge2") ) then
		alife():create("kondensator_big", vector():set (208.84,0.43,50.21), 50686, 1203)
end
end


function spawn_bar_to_mil_lchanger()
ogsm_freeplay.create_level_changer(592, vector():set(15.19,-4.58,329.57), 17985, 1246,
			16231,
			1546,
			vector():set( -334.578491210938,-25.5103607177734,45.0102348327637 ),
			vector():set(    0.0 ,  0.0   , -1.0 ),
			"l07_military",
			1)
end


function ros_master_talk1_think()
local st = get_hud():GetCustomStatic("ros_master_talk1_think") or get_hud():AddCustomStatic("ros_master_talk1_think",true)
st.m_endTime = time_global()/1000 + 5
	if db.actor:dont_has_info("ros_master_first_meet") then
		db.actor:give_info_portion ("ros_master_first_meet")
	end
end


function ros_master_talk2_think()
rnd = math.random(1, 5)
if rnd == 1 then 
ros_master_talk21_think()
end
if rnd == 2 then 
ros_master_talk22_think()
end
if rnd == 3 then 
ros_master_talk23_think()
end
if rnd == 4 then 
ros_master_talk24_think()
end
if rnd == 5 then 
ros_master_talk25_think()
end
end


function ros_master_talk21_think()
local st = get_hud():GetCustomStatic("ros_master_talk21_think") or get_hud():AddCustomStatic("ros_master_talk21_think",true)
st.m_endTime = time_global()/1000 + 1
end

function ros_master_talk22_think()
local st = get_hud():GetCustomStatic("ros_master_talk22_think") or get_hud():AddCustomStatic("ros_master_talk22_think",true)
st.m_endTime = time_global()/1000 + 0.5
end

function ros_master_talk23_think()
local st = get_hud():GetCustomStatic("ros_master_talk23_think") or get_hud():AddCustomStatic("ros_master_talk23_think",true)
st.m_endTime = time_global()/1000 + 0.5
end

function ros_master_talk24_think()
local st = get_hud():GetCustomStatic("ros_master_talk24_think") or get_hud():AddCustomStatic("ros_master_talk24_think",true)
st.m_endTime = time_global()/1000 + 0.5
end

function ros_master_talk25_think()
local st = get_hud():GetCustomStatic("ros_master_talk25_think") or get_hud():AddCustomStatic("ros_master_talk25_think",true)
st.m_endTime = time_global()/1000 + 0.5
end



function ros_master_talk3_think()
local st = get_hud():GetCustomStatic("ros_master_talk3_think") or get_hud():AddCustomStatic("ros_master_talk3_think",true)
st.m_endTime = time_global()/1000 + 10
end

function ros_master_psy_hit()
db.actor.psy_health = - 0.01
end

function ros_master_psy_hit2()
if db.actor:dont_has_info("ros_blaster_dead") then
	db.actor.psy_health = - 0.06
end
end



function ros_master_dead_spawn(actor, npc, p)
local sobj = alife():object(npc:id())
local pos = npc:position()
if sobj then
 local sim = alife()
 local sobj = sim:create("ros_blaster", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
 sim:assign_story_id(sobj.id, story_ids.ros_blaster)
	if db.actor:object("wonder_doll") ~= nil then
	news_manager.send_tip(db.actor, "doll_help_tip21", nil, "doll", 6000, nil)
	xr_effects.give_dolltip2()
	end
end
end
--------------------------------------------------------------------------------------------------------------------------

function ros_zomb_resurrection1()	--	сначала спавним скелетов
addon_dialogs.spawn_ros_scelets()
--news_manager.send_tip(db.actor, "spawn_scelets", nil, "doll", 3000, nil)
end

function ros_zomb_resurrection2()	--	потом удаляем трупы
addon_dialogs.del_ros_zombies()
--news_manager.send_tip(db.actor, "delete_bodies", nil, "doll", 3000, nil)
end

function ros_zomb_resurrection3()	--	через нек. время удаляем скелетов...
	local sim = alife()
	for i=1,65534 do
	local sobj = sim:object(i)
		if sobj and sobj:name():find("^ros_sceleton") then
		sim:release(sobj,true)
		--news_manager.send_tip(db.actor, "delete_scelets", nil, "doll", 3000, nil)
		end
	end

--local sim = alife()
--for i=1,65534 do
--local sobj = sim:object(i)
--	if sobj and sobj:name():find("^ros_sceleton") then
--	local pos = sobj.position
--	local lv = sobj.m_level_vertex_id
--	local gv = sobj.m_game_vertex_id
 --   alife():create("ros_deadzomb", vector():set(pos.x, pos.y, pos.z), lv, gv)
 --  end
--  end

end

function ros_zomb_resurrection4()	--	... и уже потом спавним трупы заново.
addon_dialogs.spawn_ros_deadzombies()
--news_manager.send_tip(db.actor, "spawn_bodies", nil, "doll", 3000, nil)
end
---------------------------------------------------------------------------------------------------------------

function ros_lenin_bust_use_interface()
if has_alife_info("ros_house_keis_info") then 
	addon_devices.ros_lenin_bust_use_interface()
end
end

function ros_international_interface()
addon_devices.ros_international_interface()
	if db.actor:dont_has_info("ros_international_read") then
		db.actor:give_info_portion ("ros_international_read")
	end
end

function ros_gate_zamok_interface()
addon_devices.ros_gate_zamok_interface()
end

function ros_house_door_trigger1use1()
	db.actor:set_actor_position(vector():set(-207.68,1.88,99.64), 23573, 1370)
end

function ros_house_door_trigger2use1()
	db.actor:set_actor_position(vector():set(-205.97,1.61,98.42), 25579, 1373)
end

function ros_tunnel_anomalies_off()

end


function ros_house_case_think()
local st = get_hud():GetCustomStatic("ros_house_case_think") or get_hud():AddCustomStatic("ros_house_case_think",true)
st.m_endTime = time_global()/1000 + 8
end

function ros_garage_door_think()
local st = get_hud():GetCustomStatic("ros_garage_door_think") or get_hud():AddCustomStatic("ros_garage_door_think",true)
st.m_endTime = time_global()/1000 + 8
end

function ros_after_lenin_think()
local st = get_hud():GetCustomStatic("ros_after_lenin_think") or get_hud():AddCustomStatic("ros_after_lenin_think",true)
st.m_endTime = time_global()/1000 + 8
end

----------------------------------------------------------------------------------------------------------------------------
-- Сильные:
function strike_to_actor1(actor, npc)
 local hit = hit()
 hit.type = hit.strike
 hit.power = 0
 hit.impulse = 2000
 hit.draftsman = npc
 -- hit.direction = npc:position():sub(db.actor:position())	--	от актора
 hit.direction = db.actor:position():sub(npc:position())	--	к актору
 npc:hit(hit)
end

function strike_from_actor1(actor, npc)
 local hit = hit()
 hit.type = hit.strike
 hit.power = 0
 hit.impulse = 2000
 hit.draftsman = npc
 hit.direction = npc:position():sub(db.actor:position())	--	от актора
 -- hit.direction = db.actor:position():sub(npc:position())	--	к актору
 npc:hit(hit)
end


-- Слабые:
function strike_to_actor2(actor, npc)
 local hit = hit()
 hit.type = hit.strike
 hit.power = 0
 hit.impulse = 1000
 hit.draftsman = npc
 -- hit.direction = npc:position():sub(db.actor:position())	--	от актора
 hit.direction = db.actor:position():sub(npc:position())	--	к актору
 npc:hit(hit)
end

function strike_from_actor2(actor, npc)
 local hit = hit()
 hit.type = hit.strike
 hit.power = 0
 hit.impulse = 1000
 hit.draftsman = npc
 hit.direction = npc:position():sub(db.actor:position())	--	от актора
 -- hit.direction = db.actor:position():sub(npc:position())	--	к актору
 npc:hit(hit)
end

---------------------------------------------------------------------------------------------------------------------------


function spawn_ros_hunters_dogs1()
alife():create("ros_hunters_dog1", vector():set (-239.76,-0.00,136.07), 13989, 1355)
alife():create("ros_hunters_dog2", vector():set (-239.76,-0.00,136.07), 13989, 1355)
alife():create("ros_hunters_dog3", vector():set (-239.76,-0.00,136.07), 13989, 1355)
alife():create("ros_hunters_dog4", vector():set (-239.76,-0.00,136.07), 13989, 1355)
alife():create("ros_hunters_dog5", vector():set (-239.76,-0.00,136.07), 13989, 1355)
end

function spawn_ros_hunters_dogs2()
alife():create("ros_hunters_dog6", vector():set (25.95,-0.56,139.70), 67147, 1412)
alife():create("ros_hunters_dog7", vector():set (25.95,-0.56,139.70), 67147, 1412)
alife():create("ros_hunters_dog8", vector():set (25.95,-0.56,139.70), 67147, 1412)
alife():create("ros_hunters_dog9", vector():set (25.95,-0.56,139.70), 67147, 1412)
end

function ros_blaster_spawn_in()
	    local obj = level_object_by_sid(8552)
	    local pos = obj:position()
alife():create("otrezvin", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
alife():create("otrezvin", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("otrezvin", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
end

------------------------------------------------------------------------------------------------------------

function current_level_anomaly_spawn()
	local level_name = level.name()
		if level_name == "l01_escape" then
			spawn_escape_anomalys()
		end
		if level_name == "l02_garbage" then
			spawn_garbage_anomalys()
		end
		if level_name == "l03_agroprom" then
			spawn_agroprom_anomalys()
		end
		if level_name == "l04_darkvalley" then
			spawn_dolina_anomalys()
		end
		if level_name == "l07_military" then
			spawn_military_anomalys()
		end
		if level_name == "l08_yantar" then
			spawn_yantar_anomalys()
		end
		if level_name == "l10_radar" then
			spawn_radar_anomalys()
		end
		if level_name == "predbannik" then
			spawn_predb_anomalys()
		end
		if level_name == "l11_pripyat" then
			spawn_pripyat_anomalys()
		end
		if level_name == "l12_stancia" then
			spawn_chaes_anomalys()
		end
end


function spawn_escape_anomalys()
	ogsm_anomaly.add_anom()
	--news_manager.send_tip(db.actor, "anomalies_spawned", nil, "stalker", 5000, nil)
end

function spawn_garbage_anomalys()
	ogsm_anomaly.add_anom()
	  --news_manager.send_tip(db.actor, "anomalies_spawned", nil, "stalker", 5000, nil)
end

function spawn_agroprom_anomalys()
	ogsm_anomaly.add_anom()
  --news_manager.send_tip(db.actor, "anomalies_spawned", nil, "stalker", 5000, nil)
end

function spawn_dolina_anomalys()
	ogsm_anomaly.add_anom()
	  --news_manager.send_tip(db.actor, "anomalies_spawned", nil, "stalker", 5000, nil)
end

function spawn_military_anomalys()
	ogsm_anomaly.add_anom()
	  --news_manager.send_tip(db.actor, "anomalies_spawned", nil, "stalker", 5000, nil)
end

function spawn_yantar_anomalys()
	ogsm_anomaly.add_anom()
	  --news_manager.send_tip(db.actor, "anomalies_spawned", nil, "stalker", 5000, nil)
end

function spawn_radar_anomalys()
	ogsm_anomaly.add_anom()
	  --news_manager.send_tip(db.actor, "anomalies_spawned", nil, "stalker", 5000, nil)
end

function spawn_predb_anomalys()
	ogsm_anomaly.add_anom()
	--news_manager.send_tip(db.actor, "anomalies_spawned", nil, "stalker", 5000, nil)
end

function spawn_pripyat_anomalys()
	ogsm_anomaly.add_anom()
	  --news_manager.send_tip(db.actor, "anomalies_spawned", nil, "stalker", 5000, nil)
end

function spawn_chaes_anomalys()
	ogsm_anomaly.add_anom()
	  --news_manager.send_tip(db.actor, "anomalies_spawned", nil, "stalker", 5000, nil)
end



function del_level_anomalys()
	ogsm_anomaly.del_level_anomalys2()
	--news_manager.send_tip(db.actor, "anomalies_deleted", nil, "stalker", 5000, nil)
end
--------------------------------------------------------------------------------------------------------------

function current_level_headhunters_respawn()
	-- addon_respawn.current_level_headhunters_respawn1()	--	перенесено в xr_motivator
	local murder = starvation.get_murder()
	if murder<1.0 then starvation.add_murder(0.02)
	end
end

--------------------------------------------------------------------------------------------------------------

function predb_kpp_invulnerable_off()
local npc1 = level_object_by_sid(8628)
if npc1:alive() then
   npc1:invulnerable(false)
end
local npc2 = level_object_by_sid(8629)
if npc2:alive() then
   npc2:invulnerable(false)
end
local npc3 = level_object_by_sid(8630)
if npc3:alive() then
   npc3:invulnerable(false)
end
local npc4 = level_object_by_sid(8631)
if npc4:alive() then
   npc4:invulnerable(false)
end
local npc5 = level_object_by_sid(8632)
if npc5:alive() then
   npc5:invulnerable(false)
end
local npc6 = level_object_by_sid(8633)
if npc6:alive() then
   npc6:invulnerable(false)
end
local npc7 = level_object_by_sid(8634)
if npc7:alive() then
   npc7:invulnerable(false)
end
local npc8 = level_object_by_sid(8635)
if npc8:alive() then
   npc8:invulnerable(false)
end
local npc9 = level_object_by_sid(8636)
if npc9:alive() then
   npc9:invulnerable(false)
end
local npc10 = level_object_by_sid(8637)
if npc10:alive() then
   npc10:invulnerable(false)
end

end


function predb_kpp_sold_make_invulnerable()
local npc1 = level_object_by_sid(8628)
if npc1 and npc1:alive() then
   npc1:invulnerable(true)
end
local npc2 = level_object_by_sid(8629)
if npc2 and npc2:alive() then
   npc2:invulnerable(true)
end
local npc3 = level_object_by_sid(8630)
if npc3 and npc3:alive() then
   npc3:invulnerable(true)
end
local npc4 = level_object_by_sid(8631)
if npc4 and npc4:alive() then
   npc4:invulnerable(true)
end
local npc5 = level_object_by_sid(8632)
if npc5 and npc5:alive() then
   npc5:invulnerable(true)
end
local npc6 = level_object_by_sid(8633)
if npc6 and npc6:alive() then
   npc6:invulnerable(true)
end
local npc7 = level_object_by_sid(8634)
if npc7 and npc7:alive() then
   npc7:invulnerable(true)
end

end


function predb_kpp_kontrab_make_invulnerable()
local npc1 = level_object_by_sid(8624)
if npc1 and npc1:alive() then
   npc1:invulnerable(true)
end
local npc2 = level_object_by_sid(8635)
if npc2 and npc2:alive() then
   npc2:invulnerable(true)
end
local npc3 = level_object_by_sid(8636)
if npc3 and npc3:alive() then
   npc3:invulnerable(true)
end
local npc4 = level_object_by_sid(8637)
if npc4 and npc4:alive() then
   npc4:invulnerable(true)
end
end


function predb_kpp_fight_neutral()
if ( db.actor:dont_has_info("predb_kpp_soldiers_atacked") or db.actor:dont_has_info("predb_kpp_kontrab_atacked") ) then
	local rnd = math.random(1, 2)
	if rnd == 1 then 
		db.actor:give_info_portion ("predb_kpp_soldiers_atacked")	--	победа контрабандистов
		db.actor:give_info_portion ("kpp_kontrab_goto_hutor")
		predb_kpp_sold_kill()
		news_manager.send_tip(db.actor, "predb_kpp_kontrabanders_win_tip", nil, "stalker", 8000, nil)
		predb_kpp_kontrab_make_invulnerable()
	end
	if rnd == 2 then
		db.actor:give_info_portion ("predb_kpp_kontrab_atacked")	--	победа военных
		predb_kpp_rontrab_kill()
		news_manager.send_tip(db.actor, "predb_kpp_soldiers_win_tip", nil, "army", 8000, nil)
		predb_kpp_sold_make_invulnerable()
	end
end
end


function predb_kpp_sold_kill()
local npc1 = level_object_by_sid(8628)
if npc1:alive() then
   npc1:kill(npc)
end
local npc2 = level_object_by_sid(8629)
if npc2:alive() then
   npc2:kill(npc)
end
local npc3 = level_object_by_sid(8630)
if npc3:alive() then
   npc3:kill(npc)
end
local npc4 = level_object_by_sid(8631)
if npc4:alive() then
   npc4:kill(npc)
end
local npc5 = level_object_by_sid(8632)
if npc5:alive() then
   npc5:kill(npc)
end
local npc6 = level_object_by_sid(8633)
if npc6:alive() then
   npc6:kill(npc)
end
local npc7 = level_object_by_sid(8634)
if npc7:alive() then
   npc7:kill(npc)
end
end


function predb_kpp_rontrab_kill()
local npc1 = level_object_by_sid(8624)
if npc1:alive() then
   npc1:kill(npc)
end
local npc2 = level_object_by_sid(8635)
if npc2:alive() then
   npc2:kill(npc)
end
local npc3 = level_object_by_sid(8636)
if npc3:alive() then
   npc3:kill(npc)
end
local npc4 = level_object_by_sid(8637)
if npc4:alive() then
   npc4:kill(npc)
end
end


function predb_kpp_heli_patrol_start()
	start_real_timer(18, "timer_actions.predb_kpp_heli_action")
end

function predb_kontrab1actor_radhit()
local rad = db.actor.radiation
	--if rad > 0.002 then
		db.actor.radiation = 0.0007
	--end
end

----------------------------------------------------------------------------------------------------------------------------------
function spawn_capsula1items(actor, obj)
local sobj = alife():object(obj:id())
local pos = obj:position()
local snd = xr_sound.get_safe_sound_object([[anomaly\gravity_entrance]])
local fx_particle = "anomaly2\\teleport_out"
if sobj then
	snd:play_no_feedback(sobj, sound_object.s3d, 0, sobj.position, 1.0)
	fx_particle = particles_object(fx_particle)
	fx_particle:play_at_pos(pos)
	local level_name = level.name()
		if level_name == "predbannik" then
			--	с поверхности в пещеру(первый раз):
			if ( xr_conditions.actor_in_predb_cave_zone_big() == false and db.actor:dont_has_info("predb_cave_trap") ) then	
					alife():create("predb_to_cave_port", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			end
			--	из пещеры в пещеру:
			if ( xr_conditions.actor_in_predb_cave_zone_big() == true and has_alife_info("predb_cave_trap") and ( db.actor:dont_has_info("predb_hermit_live") and db.actor:dont_has_info("predb_hermit_execute") ) ) then	
				alife():create("predb_to_cave_port2", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			end
			--	из пещеры на поверхность(общие случаи):
			if ( xr_conditions.actor_in_predb_cave_zone_big() == true and has_alife_info("predb_cave_trap") and ( has_alife_info("predb_hermit_live") or has_alife_info("predb_hermit_execute") ) ) then	
				alife():create("predb_to_cave_port3", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			end
			--	с поверхности в пещеру(общие случаи):
			if ( xr_conditions.actor_in_predb_cave_zone_big() == false and has_alife_info("predb_cave_trap") and ( has_alife_info("predb_hermit_live") or has_alife_info("predb_hermit_execute") ) ) then	
					alife():create("predb_to_cave_port", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			end				
		end
		
		if level_name ~= "predbannik" then
			alife():create("af_capsula_1", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			news_manager.send_tip(db.actor, "af_capsula1_error_tip", nil, "anomal", 8000, nil)
		end
end
end

--------------

-- Зелёная обманка: --------------------------------
function spawn_capsula2items(actor, obj)
local sobj = alife():object(obj:id())
local pos = obj:position()
local snd = xr_sound.get_safe_sound_object([[anomaly\gravity_entrance]])
local fx_particle = "anomaly2\\teleport_out"
if sobj then
	snd:play_no_feedback(sobj, sound_object.s3d, 0, sobj.position, 1.0)
	fx_particle = particles_object(fx_particle)
	fx_particle:play_at_pos(pos)
		rnd = math.random(1, 14)
		if rnd == 1 then 
			alife():create("medkit", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("medkit_army", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("medkit_scientic", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 2 then 
			alife():create("bandage", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("bandage", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("bandage", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ibuprophen", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("antirad", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 3 then 
			alife():create("medkomplekt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("vint", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("yod", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 4 then 
			alife():create("mre", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("mre", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("bread", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("vodka", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 5 then 
			alife():create("syrok", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("kolbasa", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("conserva", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("kefir", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("suharik", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 6 then 
			alife():create("detector_advances", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("amk_metka", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("repair_kit", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 7 then 
			alife():create("mikstura", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("armor_remkit", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("matches", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("teapot_pack", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 8 then 
			alife():create("avtomobile_tank", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("equipment_bag", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("powder", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("weapon_remkit", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 9 then 
			alife():create("medic_bag", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("kartoshka", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("sigarets", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_9x18_pmm", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_9x18_pmm", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_9x18_pmm", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 10 then 
			alife():create("ammo_vog-25", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_7.62x39_fmj", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_12x70_buck", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_12x70_buck", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 11 then 
			alife():create("ammo_5.45x39_fmj", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_5.45x39_fmj", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_5.45x39_fmj", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_7.62x51_ap", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 12 then 
			alife():create("ammo_357_hp_mag", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_357_hp_mag", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_357_hp_mag", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_7.62x51_fmj", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 13 then 
			alife():create("ammo_9x19_fmj", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_9x19_fmj", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_7.62x54_7h1", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_7.62x54_7h1", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 14 then 
			alife():create("ammo_5.56x45_ss190", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("ammo_5.56x45_ap", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("grenade_rgd5", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
end
end


-- Синяя обманка: --------------------------------
function spawn_capsula3items(actor, obj)
local sobj = alife():object(obj:id())
local pos = obj:position()
local snd = xr_sound.get_safe_sound_object([[anomaly\gravity_entrance]])
local fx_particle = "anomaly2\\teleport_out"
if sobj then
	snd:play_no_feedback(sobj, sound_object.s3d, 0, sobj.position, 1.0)
	fx_particle = particles_object(fx_particle)
	fx_particle:play_at_pos(pos)
		rnd = math.random(1, 12)
		if rnd == 1 then 
			alife():create("af_coal", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 2 then 
			alife():create("af_scale", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 3 then 
			alife():create("af_bitum", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 4 then 
			alife():create("af_roll", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 5 then 
			alife():create("af_chicken_god", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 6 then 
			alife():create("handmade_zone_gravi_zone", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 7 then 
			alife():create("af_steel_nut", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("af_crown", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 8 then 
			alife():create("af_frog", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 9 then 
			alife():create("af_sagebrush", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 10 then 
			alife():create("af_glass", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 11 then 
			alife():create("handmade_zone_mincer", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 12 then 
			alife():create("handmade_zone_mosquito_bald", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
end
end


-- Красная обманка: --------------------------------
function spawn_capsula4items(actor, obj)
local sobj = alife():object(obj:id())
local pos = obj:position()
local snd = xr_sound.get_safe_sound_object([[anomaly\gravity_entrance]])
local fx_particle = "anomaly2\\teleport_out"
if sobj then
	snd:play_no_feedback(sobj, sound_object.s3d, 0, sobj.position, 1.0)
	fx_particle = particles_object(fx_particle)
	fx_particle:play_at_pos(pos)
		rnd = math.random(1, 12)
		if rnd == 1 then 
			alife():create("boar_friend", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			news_manager.send_tip(db.actor, "capsula3items_tip", nil, "anomal", 7000, nil)
		end
		if rnd == 2 then 
			alife():create("dog_friend", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			news_manager.send_tip(db.actor, "capsula3items_tip", nil, "anomal", 7000, nil)
		end
		if rnd == 3 then 
			alife():create("cat_friend", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("cat_friend", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			news_manager.send_tip(db.actor, "capsula3items_tip", nil, "anomal", 7000, nil)
		end
		if rnd == 4 then 
			alife():create("zombie_friend", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			news_manager.send_tip(db.actor, "capsula3items_tip", nil, "anomal", 7000, nil)
		end
		if rnd == 5 then 
			alife():create("bloodsucker_friend", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			news_manager.send_tip(db.actor, "capsula3items_tip", nil, "anomal", 7000, nil)
		end
		if rnd == 6 then 
			alife():create("chimera_weak", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 7 then 
			alife():create("pseudodog_weak", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("pseudodog_weak", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 8 then 
			alife():create("flesh_normal", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 9 then 
			alife():create("m_tushkano_normal", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("m_tushkano_normal", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
			alife():create("m_tushkano_normal", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 10 then 
			alife():create("fracture_weak", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 11 then 
			alife():create("snork_weak", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
		if rnd == 12 then 
			alife():create("headhunter1", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
		end
end
end


-------------------------------------------------------------------------------
function set_look(actor, npc, p)
if not (p and tonumber(p[1])) then 
return end
local st_obj = alife():story_object(p[1])
action( npc,
 look(look.point, st_obj.position), 
 cond(cond.look_end)
 )
end
------------------------------------------------------------------------------

function spawn_dead_npc1at_pos(actor, npc, p)	--	заспавнить мёртвого нпс на позиции
local sobj = alife():object(npc:id())
local pos = npc:position()
local snd = xr_sound.get_safe_sound_object([[characters_voice\human_01\stalker\fight\death\death_2]])
--if sobj then
--snd:play_no_feedback(sobj, sound_object.s3d, 0, sobj.position, 1.0)
local sobj2 = alife():create("faint_npc1", vector():set(pos.x, pos.y, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
sobj2:on_death()
--end
end

function spawn_alive_npc1at_pos(actor, npc, p)	--	заспавнить живого нпс на позиции
	local sim = alife()
	local sobj2 = sim:create("faint_npc1", npc:position(), npc:level_vertex_id(), npc:game_vertex_id())
	sim:assign_story_id( sobj2.id, story_ids.faint_npc1)
end

function faint_npc_use_interface()
	addon_devices.faint_npc_use_interface_start()
end

--------------------------------------------------------------------------------------------------------------------

function spawn_yan_bunker_atack_mobs()
	alife():create("yan_bunker_atack_mob1", vector():set (85.40,-10.32,-249.88), 83904, 1450)
	alife():create("yan_bunker_atack_mob2", vector():set (85.40,-10.32,-249.88), 83904, 1450)
	alife():create("yan_bunker_atack_mob3", vector():set (85.40,-10.32,-249.88), 83904, 1450)
	alife():create("yan_bunker_atack_mob4", vector():set (85.40,-10.32,-249.88), 83904, 1450)
	alife():create("yan_bunker_atack_mob5", vector():set (85.40,-10.32,-249.88), 83904, 1450)
	alife():create("yan_bunker_atack_mob6", vector():set (85.40,-10.32,-249.88), 83904, 1450)
	alife():create("yan_bunker_atack_mob7", vector():set (85.40,-10.32,-249.88), 83904, 1450)
	alife():create("yan_bunker_atack_mob8", vector():set (85.40,-10.32,-249.88), 83904, 1450)
	alife():create("yan_bunker_atack_mob9", vector():set (85.40,-10.32,-249.88), 83904, 1450)
	alife():create("yan_bunker_atack_mob10", vector():set (85.40,-10.32,-249.88), 83904, 1450)
end

function start_yan_bunker_atack_timer()
start_real_timer(17*60, "timer_actions.yan_bunker_atack_timer_action")
end



function yan_zavod_guard_burer1see_actor()
	if ( db.actor:dont_has_info("yan_zavod_burers_see_actor") and db.actor:dont_has_info("yan_burer_sold9_dead") and xr_conditions.actor_in_zone(nil,nil,{"yan_zavod_zone"}) ) then
		db.actor:give_info_portion ("yan_zavod_burers_see_actor")
		local st = get_hud():GetCustomStatic("yan_zavod_guard_burers_see_actor_think") or get_hud():AddCustomStatic("yan_zavod_guard_burers_see_actor_think",true)
		st.m_endTime = time_global()/1000 + 5
	end
	if has_alife_info("yan_sold6_on_position") then 
		start_real_timer(15, "timer_actions.yan_burer1sniper_kill")
		soundtrack.yan_burers_sniper_check()
		news_manager.send_tip(db.actor, "yan_burer_sniper_check_tip", nil, "soldier", 7000, nil)
	end
end

function yan_zavod_guard_burer2see_actor()
	if ( db.actor:dont_has_info("yan_zavod_burers_see_actor") and db.actor:dont_has_info("yan_burer_sold10_dead") and xr_conditions.actor_in_zone(nil,nil,{"yan_zavod_zone"}) ) then
		db.actor:give_info_portion ("yan_zavod_burers_see_actor")
		local st = get_hud():GetCustomStatic("yan_zavod_guard_burers_see_actor_think") or get_hud():AddCustomStatic("yan_zavod_guard_burers_see_actor_think",true)
		st.m_endTime = time_global()/1000 + 5
	end
	if has_alife_info("yan_sold6_on_position") then 
		start_real_timer(15, "timer_actions.yan_burer2sniper_kill")
		soundtrack.yan_burers_sniper_check()
		news_manager.send_tip(db.actor, "yan_burer_sniper_check_tip", nil, "soldier", 7000, nil)
	end
end

function yan_zavod_guard_burer3see_actor()
	if ( db.actor:dont_has_info("yan_zavod_burers_see_actor") and db.actor:dont_has_info("yan_burer_sold11_dead") and xr_conditions.actor_in_zone(nil,nil,{"yan_zavod_zone"}) ) then
		db.actor:give_info_portion ("yan_zavod_burers_see_actor")
		local st = get_hud():GetCustomStatic("yan_zavod_guard_burers_see_actor_think") or get_hud():AddCustomStatic("yan_zavod_guard_burers_see_actor_think",true)
		st.m_endTime = time_global()/1000 + 5
	end
	if has_alife_info("yan_sold6_on_position") then 
		start_real_timer(15, "timer_actions.yan_burer3sniper_kill")
		soundtrack.yan_burers_sniper_check()
		news_manager.send_tip(db.actor, "yan_burer_sniper_check_tip", nil, "soldier", 7000, nil)
	end
end



function yan_burer_scout_shron_spawn()
addon.script_spawn("yan_burer_scout_shron", "l08_yantar", vector():set(34.34,0.60,-193.18) )
end


function yan_burer_sold9dead()
	if ( db.actor:dont_has_info("yan_burer_sold10_dead") and 
	db.actor:dont_has_info("yan_burer_sold11_dead") and 
	db.actor:dont_has_info("yan_sold6_on_position") ) then
		db.actor:give_info_portion ("yan_zavod_burers_search")
			local st = get_hud():GetCustomStatic("yan_zavod_guard_burers_search_actor_think") or get_hud():AddCustomStatic("yan_zavod_guard_burers_search_actor_think",true)
			st.m_endTime = time_global()/1000 + 5
		end
end

function yan_burer_sold10dead()
	if ( db.actor:dont_has_info("yan_burer_sold9_dead") and 
	db.actor:dont_has_info("yan_burer_sold11_dead") and 
	db.actor:dont_has_info("yan_sold6_on_position") ) then
		db.actor:give_info_portion ("yan_zavod_burers_search")
			local st = get_hud():GetCustomStatic("yan_zavod_guard_burers_search_actor_think") or get_hud():AddCustomStatic("yan_zavod_guard_burers_search_actor_think",true)
			st.m_endTime = time_global()/1000 + 5
		end
end

function yan_burer_sold11dead()
	if ( db.actor:dont_has_info("yan_burer_sold9_dead") and 
	db.actor:dont_has_info("yan_burer_sold10_dead") and 
	db.actor:dont_has_info("yan_sold6_on_position") ) then
		db.actor:give_info_portion ("yan_zavod_burers_search")
			local st = get_hud():GetCustomStatic("yan_zavod_guard_burers_search_actor_think") or get_hud():AddCustomStatic("yan_zavod_guard_burers_search_actor_think",true)
			st.m_endTime = time_global()/1000 + 5
		end
end



function spawn_yan_zavod_trap_obj()
	addon.script_spawn("yan_zavod_trap_obj", "l08_yantar", vector():set(-7.23,33.30,-12.50) )
end



function actor_goto_yan_zavod_trap()
	db.actor:set_actor_position(patrol("yan_burer_king_look1"):point(0))
	local dir = patrol("yan_burer_king_walk1"):point(1):sub(patrol("yan_burer_king_walk1"):point(0))
	db.actor:set_actor_direction(-dir:getH())
	db.actor:hide_weapon()
	put_items_to_yan_burers_box()
end



function put_items_to_yan_burers_box()
--[[local box = level_object_by_sid(8729)
if box then
for i = 0, db.actor:object_count() - 1 do
local obj = db.actor:object(i)
if obj and not (system_ini():line_exist(obj:section(), "quest_item") and system_ini():r_bool(obj:section(), "quest_item"))
	and not (system_ini():line_exist(obj:section(), "is_pda") and system_ini():r_bool(obj:section(), "is_pda"))
 then db.actor:transfer_item(obj, box) end
end
end]]
transfer_to_box(8729)
end

function yan_burer_scout_lost()
	if db.actor:dont_has_info("yan_burer_sold12_dead") then
		db.actor:give_info_portion ("yan_zavod_burers_search")
	end
end


function start_burer_king_dialog()
	if db.actor:dont_has_info("yan_goto_lab") then
		addon_devices.burer_king_dialog1()
	elseif has_alife_info("x16_burers_visit") then
		addon_devices.burer_king_dialog11()
	end
end


function yan_zavod_zone_hands_effect()
	if has_alife_info("actor_in_yan_zavod_trap") then 
	db.actor:hide_weapon()
	local st = get_hud():GetCustomStatic("actor_arms_blocked_think") or get_hud():AddCustomStatic("actor_arms_blocked_think",true)
	st.m_endTime = time_global()/1000 + 1
	end
end



function start_burer_adviser_dialog()
	if db.actor:dont_has_info("x16_adviser_walk1") then
		addon_devices.burer_adviser_dialog1()
	elseif has_alife_info("x16_adviser_walk2") then
		addon_devices.burer_adviser_dialog2()
	end
end


function spawn_x16brain_npc()
 local sim = alife()
 local sobj = alife():create("x16brain_npc", vector():set (-42.76,19.20,-11.10), 2894, 1530)
 sim:assign_story_id(sobj.id, story_ids.x16_brain_npc)
end



function x16upper_room_door_trigger1use1()
	db.actor:set_actor_position(patrol("x16upper_room_door_point1"):point(0))
		if db.actor:object("wonder_doll") ~= nil then
		news_manager.send_tip(db.actor, "doll_help_tip21", nil, "doll", 6000, nil)
		xr_effects.give_dolltip2()
		soundtrack.wonderdoll_sucess_tip42()
		end
end

function x16upper_room_door_trigger1use2()
	db.actor:set_actor_position(patrol("x16upper_room_door_point2"):point(0))
end

function x16brain_init_dialog()
local npc = level_object_by_sid(8727)
if not db.actor:is_talking() then
	db.actor:run_talk_dialog(npc)
	if db.actor:dont_has_info("x16_brain_meet") then
		db.actor:give_info_portion ("x16_brain_meet")
	end
end
end


function x16tubes_strike_to_actor(actor, npc)
 local hit = hit()
 hit.type = hit.strike
 hit.power = 0
 hit.impulse = 20
 hit.draftsman = npc
 hit.direction = db.actor:position():sub(npc:position())	--	к актору
 npc:hit(hit)
end



function x16actor_saharov_info()
if db.actor:dont_has_info("x16_adviser_walk2") then
		db.actor:give_info_portion ("x16_adviser_walk2")
end
end



function spawn_x16barell_explosion()
local sim = alife()
 local sobj = sim:create("dynamite_bomb2", vector():set (-129.91,22.10,-23.01), 18, 1529)
 sim:assign_story_id(sobj.id, story_ids.x16_fuel_bomb)
end


function hit_x16barell_explosion()
local obj = alife():story_object(8734)
 local h = hit()
 h.type = hit.strike
 h.power = 1
 h.impulse = 1
 h.draftsman = db.actor
 obj:hit(h)
end



function x16burers_hit_from_actor(actor, npc)
	local h = hit()
	h.power = 0.01
	h.direction = npc:direction()
	h.draftsman = db.actor
	h.impulse = 1
	h.type = hit.wound
	npc:hit(h)
end

function x16burers_hit_from_saharov(actor, npc)
	local obj = level_object_by_sid (8678)
	local h = hit()
	h.power = 0.01
	h.direction = npc:direction()
	h.draftsman = obj 
	h.impulse = 1
	h.type = hit.wound
	npc:hit(h)
end


function spawn_x16fireball1()
	addon.script_spawn("x16fireball1", "l08u_brainlab", vector():set(-51.87,11.60,-13.18) )
end

function spawn_x16fireball2()
	addon.script_spawn("x16fireball2", "l08u_brainlab", vector():set(-46.17,3.50,-3.58) )
end

function spawn_x16fireball3()
	addon.script_spawn("x16fireball3", "l08u_brainlab", vector():set(-52.57,-4.10,-16.18) )
end


function x16burers_door_break_think()
	local st = get_hud():GetCustomStatic("x16burers_door_break_think") or get_hud():AddCustomStatic("x16burers_door_break_think",true)
	st.m_endTime = time_global()/1000 + 5
end




function yan_saharov_teleportate()
local obj = alife():story_object(8678)
if obj ~= nil and obj:alive() == true then
alife_teleport_object("_", vector():set(-237.75,-19.06,-42.70), 190, 1458, obj.id) 
end
end

function yan_sold9spawn_in()
	    local obj = level_object_by_sid(8743)
	    -- local pos = obj:position()
amk.spawn_item_in_inv("wpn_ak74u",obj)
amk.spawn_item_in_inv("ammo_5.45x39_fmj",obj)
amk.spawn_item_in_inv("ammo_5.45x39_fmj",obj)
amk.spawn_item_in_inv("ammo_5.45x39_fmj",obj)
amk.spawn_item_in_inv("ammo_5.45x39_ap",obj)
amk.spawn_item_in_inv("grenade_rgd5",obj)
amk.spawn_item_in_inv("soldier_outfit",obj)
amk.spawn_item_in_inv("medkit_army",obj)
amk.spawn_item_in_inv("antirad",obj)
amk.spawn_item_in_inv("bandage",obj)
amk.spawn_item_in_inv("bandage",obj)
amk.spawn_item_in_inv("ibuprophen",obj)
amk.spawn_item_in_inv("flyaga_full",obj)
amk.spawn_item_in_inv("irp-b",obj)
end


function yan_saharov_companion_off()
	local npc = level_object_by_sid(8678)
	if npc and npc:alive() then
		dialogs.companion_stop_following(npc, db.actor)
	end
end

function x16brain_goodbye_think()
	local st = get_hud():GetCustomStatic("x16brain_goodbye_think") or get_hud():AddCustomStatic("x16brain_goodbye_think",true)
	st.m_endTime = time_global()/1000 + 10
end


function x16diarys_collect()
if ( db.actor:dont_has_info("x16_diary1_info") and db.actor:dont_has_info("x16_diary2_info") and db.actor:dont_has_info("x16_diary3_info") and db.actor:dont_has_info("x16_diary4_info") and db.actor:dont_has_info("x16_diary5_info") ) then
db.actor:give_info_portion ("x16_diary1_info")
elseif ( has_alife_info("x16_diary1_info") and db.actor:dont_has_info("x16_diary2_info") ) then
db.actor:give_info_portion ("x16_diary2_info")
elseif ( has_alife_info("x16_diary1_info") and has_alife_info("x16_diary2_info") and db.actor:dont_has_info("x16_diary3_info") ) then
db.actor:give_info_portion ("x16_diary3_info")
elseif ( has_alife_info("x16_diary1_info") and has_alife_info("x16_diary2_info") and has_alife_info("x16_diary3_info") and db.actor:dont_has_info("x16_diary4_info") ) then
db.actor:give_info_portion ("x16_diary4_info")
elseif ( has_alife_info("x16_diary1_info") and has_alife_info("x16_diary2_info") and has_alife_info("x16_diary3_info") and has_alife_info("x16_diary4_info") and db.actor:dont_has_info("x16_diary5_info") ) then
db.actor:give_info_portion ("x16_diary5_info")
end
end


function start_ros_atack_mobs_timer()
if ( has_alife_info("ros_stroyka_atack_mob1dead") and
	has_alife_info("ros_stroyka_atack_mob2dead") and
	has_alife_info("ros_stroyka_atack_mob3dead") and
	has_alife_info("ros_stroyka_atack_mob4dead") and
	has_alife_info("ros_stroyka_atack_mob5dead") and
	has_alife_info("ros_stroyka_atack_mob6dead") and
	has_alife_info("ros_stroyka_atack_mob7dead") and
	has_alife_info("ros_stroyka_atack_mob8dead") ) then
		--if not timer_exists("ros_atack_timer") then
			start_real_timer(15*60, "timer_actions.ros_mobs_atack_timer_action", "ros_atack_timer")
		--end
end
end



function delete_ros_stroyka_atack_mobs()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("^ros_stroyka_atack_mob") then
	sim:release(sobj,true)
	return
	end
end
end


function spawn_yan_swamp_anomaly()
addon.script_spawn("yan_swamp_anomaly", "l08_yantar", vector():set(-46.07,-13.60,-264.67) )
end




function yan_lost_camp_pribor_use1()
addon.script_spawn("yan_lost_camp_scaner1", "l08_yantar", vector():set(133.70,-1.08,66.26) )
addon.script_spawn("yan_lost_camp_scaner2", "l08_yantar", vector():set(158.15,-1.99,72.92) )
addon.script_spawn("yan_lost_camp_scaner3", "l08_yantar", vector():set(136.23,-0.99,55.73) )
end

function yan_lost_camp_pribor_think()
	local st = get_hud():GetCustomStatic("yan_lost_camp_pribor_think") or get_hud():AddCustomStatic("yan_lost_camp_pribor_think",true)
	st.m_endTime = time_global()/1000 + 10
end




function spawn_yan_lost_camp_bodies()
addon.remove_items("yan_lost_scaner", 3)
local sim = alife()
local sobj = sim:create("faint_body2", vector():set (149.35,5.00,71.12), 123720, 1521)
sim:assign_story_id(sobj.id, story_ids.faint_body2)
end

function spawn_dead_npc2at_pos(actor, npc, p)	--	заспавнить мёртвого нпс на позиции
local sobj = alife():object(npc:id())
local pos = npc:position()
local snd = xr_sound.get_safe_sound_object([[characters_voice\human_01\stalker\fight\death\death_2]])
local sobj2 = alife():create("faint_npc2", vector():set(pos.x, pos.y, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
sobj2:on_death()
end

function spawn_alive_npc2at_pos(actor, npc, p)	--	заспавнить живого нпс на позиции
local sobj = alife():object(npc:id())
local pos = npc:position()
local sim = alife()
local sobj2 = alife():create("faint_npc2", vector():set(pos.x, pos.y, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
sim:assign_story_id(sobj2.id, story_ids.faint_npc2)
end


function yan_faint_companion_off()
	local npc = level_object_by_sid(8748)
	if npc and npc:alive() then
		dialogs.companion_stop_following(npc, db.actor)
	end
end


function actor_hit_halfhealth()
db.actor.health = - 0.5
end


function ros_hunter_behind_rescuer()
	if has_alife_info("lenin_bust_gathered") then 
		db.actor:give_info_portion ("ros_hunter_behind_rescuer")
	elseif has_alife_info("lenin_bust_destroyed") then 
		db.actor:give_info_portion ("ros_hunter_behind_rescuer2")
	end

end

function ros_rescuers_robbery_think()
	local st = get_hud():GetCustomStatic("ros_rescuers_robbery_think") or get_hud():AddCustomStatic("ros_rescuers_robbery_think",true)
	st.m_endTime = time_global()/1000 + 8
end

function spawn_ros_danger_anomaly()
 local sim = alife()
 local sobj = sim:create("ros_danger_anomaly", vector():set (-164.73,-0.00,142.52), 34425, 1314)
 sim:assign_story_id(sobj.id, story_ids.ros_danger_anomaly)
 	if db.actor.health > 0.85 then
		db.actor.health = - 0.8
	end
end

function drop_weapon()
local gun = db.actor:item_in_slot(2)
	if gun then
	db.actor:drop_item(gun)
	end
end




function spawn_ros_old_spirit()
addon.script_spawn("ros_old_spirit", "l06_rostok", vector():set(-239.51,0.00,47.38) )
end


function ros_old_spirit_think1()
	local st = get_hud():GetCustomStatic("ros_old_spirit_think1") or get_hud():AddCustomStatic("ros_old_spirit_think1",true)
	st.m_endTime = time_global()/1000 + 8
end

function ros_old_spirit_think2()
	local st = get_hud():GetCustomStatic("ros_old_spirit_think2") or get_hud():AddCustomStatic("ros_old_spirit_think2",true)
	st.m_endTime = time_global()/1000 + 8
end

function ros_old_spirit_surprise_spawn()
addon.script_spawn("ros_old_spirit_surprise", "l06_rostok", vector():set(-220.29,0.00,-42.26) )
end

function ros_af_chips_generate()
addon.remove_items("af_chip", 5)
amk.spawn_item_in_inv('af_tumbleweed')
news_manager.send_tip(db.actor, "af_tumbleweed_collected", nil, "artefact", 7000, nil)
end



function mil_separ_alarm_tip1()
if db.actor:dont_has_info("mil_separ_alarm") then
		db.actor:give_info_portion ("mil_separ_alarm")
		news_manager.send_tip(db.actor, "mil_separ_alarm_tip1", nil, "separ", 7000, nil)
end
end

function mil_separ_alarm_tip2()
if has_alife_info("mil_separ_alarm") then 
		db.actor:disable_info_portion("mil_separ_alarm")
		news_manager.send_tip(db.actor, "mil_separ_alarm_tip2", nil, "separ", 6000, nil)
end
end

function mil_separ_snipers_killactor()
if has_alife_info("mil_separ_alarm") then 
		local obj = level_object_by_sid(8793)
		local pos = obj:position()
		local snd_obj = xr_sound.get_safe_sound_object([[weapons\svu_shoot]])
		snd_obj:play_at_pos(obj, obj:position(), 0, sound_object.s3d)
		db.actor:kill(db.actor)
		news_manager.send_tip(db.actor, "mil_separ_alarm_tip3", nil, "separ", 6000, nil)
end
end


function mil_village_space_anomaly_actor_goback()
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
	db.actor:set_actor_position(patrol("mil_village_space_anomaly1_point"):point(0))
end


function mil_kazarma2zapiska_use()
addon_devices.mil_kazarma2zapiska_interface()
end


function mil_kazarma_port_actor_goback()
	level.add_pp_effector("teleport.ppe", 2009, false)
	soundtrack.lift_up()
	db.actor:set_actor_position(patrol("mil_kazarma2_point_goback"):point(0))
end



function mil_village_first_bloodsucker1respawn()
addon.script_spawn("mil_village_bloodsucker4", "l07_military", vector():set(-224.80,-21.37,226.08) )
end

function mil_village_first_bloodsucker2respawn()
addon.script_spawn("mil_village_bloodsucker3", "l07_military", vector():set(-255.83,-22.41,259.55) )
end

function mil_village_first_bloodsucker3respawn()
addon.script_spawn("mil_village_bloodsucker2", "l07_military", vector():set(-258.45,-22.55,199.32) )
end

function mil_village_first_bloodsucker4respawn()
addon.script_spawn("mil_village_bloodsucker1", "l07_military", vector():set(-213.33,-21.70,204.33) )
end



function spawn_mil_kazarma1polter()
addon.script_spawn("mil_kazarma1polter", "l07_military", vector():set(72.10,-7.90,18.99) )
end


function panteley_tube_laz_use()
	--level.add_pp_effector("agr_u_fade.ppe", 2107, false)
	db.actor:set_actor_position(patrol("mil_village_panteley_house_room_point"):point(0))
	addon.remove_items("mil_hatchet", 1)
end

function play_radio_noice_on_actor()
soundtrack.radio_noice()
end

function remove_mil_icon_parts()
addon.remove_items("icon_part1", 1)
addon.remove_items("icon_part2", 1)
addon.remove_items("icon_part3", 1)
addon.remove_items("icon_part4", 1)
amk.spawn_item_in_inv('mil_icon')
end

function mil_village_bloodsuckers_doll_tip()
if db.actor:object("wonder_doll") ~= nil then
	news_manager.send_tip(db.actor, "doll_help_tip25", nil, "doll", 6000, nil)
	xr_effects.give_dolltip2()
	soundtrack.wonderdoll_sucess_tip42()
end
end


function mil_base_antenna_pult_use()

end


function rad_port_to_secret_talk1()
	db.actor:hide_weapon()
	addon.actor_disable_inventory()
	level.add_pp_effector("deadcity_wake.ppe", 2107, false)
	db.actor:set_actor_position(patrol("rad_secret_talk_point"):point(0))
	local num = get_console():get_float("rs_vis_distance")
	SetVar("rs_vis_dist", num)
	get_console():execute("rs_vis_distance 0.400")
	--get_console():execute("rs_vis_distance 1.500")
end

function rad_back_to_secret_talk1()
	db.actor:restore_weapon()
	addon.actor_disable_inventory()
	level.add_pp_effector("deadcity_wake.ppe", 2107, false)
	db.actor:set_actor_position(patrol("rad_way_if_reject_to_mil"):point(0))
	--get_console():execute("rs_vis_distance 0.100")
	get_console():execute("rs_vis_distance "..GetVar("rs_vis_dist", 1.4))
	DelVar("rs_vis_dist")
end

function spawn_rad_secret_npc()
 local sim = alife()
 local sobj = alife():create("rad_secret_npc", vector():set (603.19,-91.13,-82.61), 201387, 1878)
 sim:assign_story_id(sobj.id, story_ids.rad_secret_npc)
end

function release_rad_secret_npc()
	local obj = alife():story_object(8841)
	if obj then
		alife():release(obj , true)
	end
end 

function rad_secret_npc_init_dialog()
	local npc = level_object_by_sid(8841)
	if not db.actor:is_talking() then
		db.actor:run_talk_dialog(npc)
	end
end

function rad_no_back()
	db.actor:set_actor_position(patrol("rad_way_if_reject_to_mil"):point(0))
end



function rad_ambush_spawns1()
 local sim = alife()
 local sobj = alife():create("rad_ambush_bomb", vector():set (607.67,-51.98,-316.83), 218107, 1881)
 sim:assign_story_id(sobj.id, story_ids.rad_ambush_bomb)
end

function rad_ambush_spawns2()
addon.script_spawn("rad_ambush_agent1", "l10_radar", vector():set(621.45,-52.27,-315.05) )
addon.script_spawn("rad_ambush_agent2", "l10_radar", vector():set(615.85,-52.17,-307.85) )
addon.script_spawn("rad_ambush_agent3", "l10_radar", vector():set(592.75,-50.57,-310.75) )
addon.script_spawn("rad_ambush_agent4", "l10_radar", vector():set(601.35,-52.17,-310.75) )
addon.script_spawn("rad_ambush_agent5", "l10_radar", vector():set(596.83,-53.48,-95.72) )
end


function spawn_rad_fenix()
rnd = math.random(1, 3)
if rnd == 1 then 
spawn_rad_fenix1()
end
if rnd == 2 then 
spawn_rad_fenix2()
end
if rnd == 3 then 
spawn_rad_fenix3()
end
end


function spawn_rad_fenix1()
local sim = alife()
	local sobj = sim:create("rad_fenix", vector():set (351.06,-50.17,-234.54), 218107, 1881)
	sim:assign_story_id(sobj.id, story_ids.rad_fenix)
end

function spawn_rad_fenix2()
local sim = alife()
	local sobj = sim:create("rad_fenix", vector():set (403.24,-50.34,-207.48), 218107, 1881)
	sim:assign_story_id(sobj.id, story_ids.rad_fenix)
end

function spawn_rad_fenix3()
local sim = alife()
	local sobj = sim:create("rad_fenix", vector():set (325.61,-47.36,-166.41), 218107, 1881)
	sim:assign_story_id(sobj.id, story_ids.rad_fenix)
end

 
function rad_fenix_spawn_in()
local obj = level_object_by_sid(8847)
local pos = obj:position()
alife():create("headhunter_outfit", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("antirad", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("antirad", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("antirad", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("medkit_army", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("medkit_army", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("bandage", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("dix", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("vint", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("sigarets", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("t_akumulator1", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("t_akumulator1", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("t_akumulator1", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("flyaga_full", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("flare_2", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("knife_4", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
end


function rad_abdul_lost_think()
	local st = get_hud():GetCustomStatic("rad_abdul_lost_think") or get_hud():AddCustomStatic("rad_abdul_lost_think",true)
	st.m_endTime = time_global()/1000 + 8
end



function rad_ambush_bomb_hit()
local obj = level_object_by_sid(8843)
	local hit = hit()
	hit.type = hit.strike
	hit.power = 1.0
	hit.impulse = 0
	hit.draftsman = db.actor
	obj:hit(hit)
end



-- Респавн мобов ------------------------------------------------------------------
function rad_mob1respawn()
addon.script_spawn("rad_mob1", "l10_radar", vector():set(557.63,-62.52,-204.90) )
end

function rad_mob2respawn()
addon.script_spawn("rad_mob2", "l10_radar", vector():set(557.63,-62.52,-204.90) )
end

function rad_mob3respawn()
addon.script_spawn("rad_mob3", "l10_radar", vector():set(557.63,-62.52,-204.90) )
end

function rad_mob4respawn()
addon.script_spawn("rad_mob4", "l10_radar", vector():set(490.64,-52.52,-269.35) )
end

function rad_mob5respawn()
addon.script_spawn("rad_mob5", "l10_radar", vector():set(490.64,-52.52,-269.35) )
end

function rad_mob6respawn()
addon.script_spawn("rad_mob6", "l10_radar", vector():set(490.64,-52.52,-269.35) )
end

function rad_mob7respawn()
addon.script_spawn("rad_mob7", "l10_radar", vector():set(403.24,-50.34,-207.48) )
end

function rad_mob8respawn()
addon.script_spawn("rad_mob8", "l10_radar", vector():set(403.24,-50.34,-207.48) )
end

function rad_mob9respawn()
addon.script_spawn("rad_mob9", "l10_radar", vector():set(403.24,-50.34,-207.48) )
end

function rad_mob10respawn()
addon.script_spawn("rad_mob10", "l10_radar", vector():set(314.82,-48.12,-129.08) )
end

function rad_mob11respawn()
addon.script_spawn("rad_mob11", "l10_radar", vector():set(314.82,-48.12,-129.08) )
end

function rad_mob12respawn()
addon.script_spawn("rad_mob12", "l10_radar", vector():set(314.82,-48.12,-129.08) )
end

function rad_mob13respawn()
addon.script_spawn("rad_mob13", "l10_radar", vector():set(383.99,-50.50,-110.50) )
end

function rad_mob14respawn()
addon.script_spawn("rad_mob14", "l10_radar", vector():set(383.99,-50.50,-110.50) )
end

function rad_mob15respawn()
addon.script_spawn("rad_mob15", "l10_radar", vector():set(383.99,-50.50,-110.50) )
end

function rad_mob16respawn()
addon.script_spawn("rad_mob16", "l10_radar", vector():set(513.63,-50.85,-78.36) )
end

function rad_mob17respawn()
addon.script_spawn("rad_mob17", "l10_radar", vector():set(513.63,-50.85,-78.36) )
end

function rad_mob18respawn()
addon.script_spawn("rad_mob18", "l10_radar", vector():set(513.63,-50.85,-78.36) )
end

function rad_mob19respawn()
addon.script_spawn("rad_mob19", "l10_radar", vector():set(570.40,-49.95,-6.49) )
end

function rad_mob20respawn()
addon.script_spawn("rad_mob20", "l10_radar", vector():set(636.73,-43.82,186.64) )
end

------------------------------
function predb_mob1respawn()
addon.script_spawn("predb_mob1", "predbannik", vector():set(-547.70,20.71,85.87) )
end

function predb_mob2respawn()
addon.script_spawn("predb_mob2", "predbannik", vector():set(-547.70,20.71,85.87) )
end

function predb_mob3respawn()
addon.script_spawn("predb_mob3", "predbannik", vector():set(-547.70,20.71,85.87) )
end

function predb_mob4respawn()
addon.script_spawn("predb_mob4", "predbannik", vector():set(-547.70,20.71,85.87) )
end



function predb_mob5respawn()
addon.script_spawn("predb_mob5", "predbannik", vector():set(-109.87,16.55,-136.51) )
end

function predb_mob6respawn()
addon.script_spawn("predb_mob6", "predbannik", vector():set(-109.87,16.55,-136.51) )
end

function predb_mob7respawn()
addon.script_spawn("predb_mob7", "predbannik", vector():set(-109.87,16.55,-136.51) )
end

function predb_mob8respawn()
addon.script_spawn("predb_mob8", "predbannik", vector():set(-109.87,16.55,-136.51) )
end


function predb_mob9respawn()
addon.script_spawn("predb_mob9", "predbannik", vector():set(-339.80,9.06,21.63) )
end

function predb_mob10respawn()
addon.script_spawn("predb_mob10", "predbannik", vector():set(-339.80,9.06,21.63) )
end

function predb_mob11respawn()
addon.script_spawn("predb_mob11", "predbannik", vector():set(-339.80,9.06,21.63) )
end


function predb_mob12respawn()
addon.script_spawn("predb_mob12", "predbannik", vector():set(-204.83,3.75,406.61) )
end

function predb_mob13respawn()
addon.script_spawn("predb_mob13", "predbannik", vector():set(-204.83,3.75,406.61) )
end

function predb_mob14respawn()
addon.script_spawn("predb_mob14", "predbannik", vector():set(-204.83,3.75,406.61) )
end


function predb_mob15respawn()
addon.script_spawn("predb_mob15", "predbannik", vector():set(-587.08,2.83,-103.76) )
end

function predb_mob16respawn()
addon.script_spawn("predb_mob16", "predbannik", vector():set(-587.08,2.83,-103.76) )
end


function predb_mob17respawn()
addon.script_spawn("predb_mob17", "predbannik", vector():set(109.69,-15.76,-253.13) )
end

function predb_mob18respawn()
addon.script_spawn("predb_mob18", "predbannik", vector():set(109.69,-15.76,-253.13) )
end


function predb_mob19respawn()
addon.script_spawn("predb_mob19", "predbannik", vector():set(76.04,2.50,-0.19) )
end

function predb_mob20respawn()
addon.script_spawn("predb_mob20", "predbannik", vector():set(-153.08,26.59,286.08) )
end











function rad_fenix_teleport_think1()
	local st = get_hud():GetCustomStatic("rad_fenix_teleport_think") or get_hud():AddCustomStatic("rad_fenix_teleport_think",true)
	st.m_endTime = time_global()/1000 + 5
end

function rad_fenix_teleport_think()
if db.actor:dont_has_info("rad_fenix_teleport_think") then
	db.actor:give_info_portion ("rad_fenix_teleport_think")
end
end


function radar_lost_pda_collect()
if ( db.actor:dont_has_info("rad_lost_pda1_info") and db.actor:dont_has_info("rad_lost_pda2_info") and db.actor:dont_has_info("rad_lost_pda3_info") and db.actor:dont_has_info("rad_lost_pda4_info") ) then
	db.actor:give_info_portion ("rad_lost_pda1_info")
elseif ( has_alife_info("rad_lost_pda1_info") and db.actor:dont_has_info("rad_lost_pda2_info") ) then
	db.actor:give_info_portion ("rad_lost_pda2_info")
elseif ( has_alife_info("rad_lost_pda1_info") and has_alife_info("rad_lost_pda2_info") and db.actor:dont_has_info("rad_lost_pda3_info") ) then
	db.actor:give_info_portion ("rad_lost_pda3_info")
elseif ( has_alife_info("rad_lost_pda1_info") and has_alife_info("rad_lost_pda2_info") and has_alife_info("rad_lost_pda3_info") and db.actor:dont_has_info("rad_lost_pda4_info") ) then
	db.actor:give_info_portion ("rad_lost_pda4_info")
end
end


function rad_fenix_dollhelp_tip()
if db.actor:object("wonder_doll") ~= nil then
	news_manager.send_tip(db.actor, "doll_help_tip26", nil, "doll", 8000, nil)
	xr_effects.give_dolltip2()
	soundtrack.wonderdoll_sucess_tip42()
end
end

function rad_fenix_wounded_tip()
	news_manager.send_tip(db.actor, "rad_fenix_wounded_tip", nil, "stalker", 9000, nil)
end

function rad_agents_actor_check()
if ( xr_conditions.actor_wears_headhunter_outfit() ~= true and not inventory.belt["antigas"] ) then
	if db.actor:dont_has_info("rad_headhunters_actor_alarm") then
		db.actor:give_info_portion ("rad_headhunters_actor_alarm")
	end
end
end


---------------------------------------------------------------------------------------------------

function deadmask_soundobj_respawn()
if db.actor:dont_has_info("deadmask_teleport") then
	addon_dialogs.deadmask_soundobj_respawn2()
end
end


function esc_deadmask_trap_zone_goback()
	timer_actions.deadmask_timer_action()
	level.add_pp_effector("deadcity_wake.ppe", 2007, false)
end

function esc_deadmask_actor_back()
	db.actor:restore_weapon()
	level.show_indicators()
	db.actor:set_actor_position(patrol("izgoy_look9"):point(0))
end


function garb_deadmask_trap_zone_goback()
	db.actor:set_actor_position(patrol("garb_deadmask_zone_point"):point(0))
	level.add_pp_effector("deadcity_wake.ppe", 2007, false)
end

function garb_deadmask_actor_back()
	db.actor:restore_weapon()
	level.show_indicators()
	db.actor:set_actor_position(patrol("gar_way_if_reject_to_esc"):point(0))
end



function agro_deadmask_trap_zone_goback()
	db.actor:set_actor_position(patrol("agro_deadmask_zone_point"):point(0))
	level.add_pp_effector("deadcity_wake.ppe", 2007, false)
end

function agro_deadmask_actor_back()
	db.actor:restore_weapon()
	level.show_indicators()
	db.actor:set_actor_position(patrol("arg_way_if_reject_to_gar"):point(0))
end


function predb_deadmask_trap_zone_goback()
	db.actor:set_actor_position(patrol("predb_deadmask_zone_point"):point(0))
	level.add_pp_effector("deadcity_wake.ppe", 2007, false)
end

function predb_deadmask_actor_back()
if has_alife_info("predb_kpp_soldiers_atacked") then
	db.actor:restore_weapon()
	level.show_indicators()
	db.actor:set_actor_position(patrol("predb_courier1_walk2"):point(0))
end
if has_alife_info("predb_kpp_kontrab_atacked") then	
	db.actor:restore_weapon()
	level.show_indicators()
	db.actor:set_actor_position(patrol("predbannik_way_if_reject"):point(0))
end
end



function spawn_esc_deadmask_habar()
addon.script_spawn("deadmask_habar1", "l01_escape", vector():set(-36.74,-18.17,-191.62) )
end

function spawn_garb_deadmask_habar()
addon.script_spawn("deadmask_habar2", "l02_garbage", vector():set(-193.40,2.22,204.11) )
end

function spawn_agro_deadmask_habar()
addon.script_spawn("deadmask_habar3", "l03_agroprom", vector():set(90.14,10.30,186.10) )
end

function spawn_predb_deadmask_habar()
addon.script_spawn("deadmask_habar4", "predbannik", vector():set(-347.78,12.40,146.66) )
end



function esc_secret_art_dollhelp()
if db.actor:object("wonder_doll") ~= nil then
	news_manager.send_tip(db.actor, "doll_help_tip27", nil, "doll", 8000, nil)
	xr_effects.give_dolltip2()
	soundtrack.wonderdoll_sucess_tip42()
end
end


function rad_tunnel_door_think()
local st = get_hud():GetCustomStatic("rad_tunnel_door_think") or get_hud():AddCustomStatic("rad_tunnel_door_think",true)
st.m_endTime = time_global()/1000 + 6
addon.script_spawn("rad_tunnel_mob1", "l10_radar", vector():set(561.72,-42.63,175.45) )
addon.script_spawn("rad_tunnel_mob2", "l10_radar", vector():set(561.72,-42.63,175.45) )
addon.script_spawn("rad_tunnel_mob3", "l10_radar", vector():set(561.72,-42.63,175.45) )
end


function rad_base_house_door_trigger_use()
	db.actor:set_actor_position(patrol("rad_base_house_door_trigger_point"):point(0))
end


function x10agent4pda_spawn()
local obj = level_object_by_sid(8864)
-- local pos = obj:position()
amk.spawn_item_in_inv("x10agent4pda", obj)-- alife():create("x10agent4pda", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
end


function pri_detsad_teleport_work()
	if db.actor:object("pri_detsad_bottle") == nil then
		level.add_pp_effector("teleport.ppe", 2009, false)
		soundtrack.lift_up()
		db.actor:set_actor_position(patrol("pri_detsad_start_point"):point(0))
	elseif db.actor:object("pri_detsad_bottle") ~= nil then
		level.add_pp_effector("teleport.ppe", 2009, false)
		soundtrack.lift_up()
		db.actor:set_actor_position(patrol("pri_detsad_scelet1_point"):point(0))
	end
end


function pri_detsad_brownie1death_spawn(actor, npc, p)
local sobj = alife():object(npc:id())
local pos = npc:position()
local snd = xr_sound.get_safe_sound_object([[soundtrack\agro_u_bloodsucker_meet]])
if sobj then
alife():create("scelet_bone1", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone2", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone2", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone3", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone3", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone4", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("pri_detsad_medroom_key", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
snd:play_no_feedback(sobj, sound_object.s3d, 0, sobj.position, 1.0)
end
end

function pri_detsad_brownie2death_spawn(actor, npc, p)
local sobj = alife():object(npc:id())
local pos = npc:position()
local snd = xr_sound.get_safe_sound_object([[soundtrack\agro_u_bloodsucker_meet]])
if sobj then
alife():create("scelet_bone1", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone2", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone2", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone3", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone3", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone4", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("pri_detsad_freezer_key", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
snd:play_no_feedback(sobj, sound_object.s3d, 0, sobj.position, 1.0)
end
end

function pri_detsad_brownie3death_spawn(actor, npc, p)
local sobj = alife():object(npc:id())
local pos = npc:position()
local snd = xr_sound.get_safe_sound_object([[soundtrack\agro_u_bloodsucker_meet]])
if sobj then
alife():create("scelet_bone1", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone2", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone2", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone3", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone3", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone4", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("af_bile", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("pri_detsad_door_key", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
snd:play_no_feedback(sobj, sound_object.s3d, 0, sobj.position, 1.0)
end
end

function pri_brownie1trap()
local obj = level_object_by_sid(8900)
local pos = obj:position()
if db.actor:dont_has_info("pri_brownie1_dead") and db.actor:alive() then
	db.actor:set_actor_position( vector():set(pos.x, pos.y-1, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
end
end

function pri_brownie2trap()
local obj = level_object_by_sid(8901)
local pos = obj:position()
if db.actor:dont_has_info("pri_brownie2_dead") and db.actor:alive() then
	db.actor:set_actor_position( vector():set(pos.x, pos.y-1, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
end
end

function pri_brownie3trap()
local obj = level_object_by_sid(8902)
local pos = obj:position()
if db.actor:dont_has_info("pri_brownie3_dead") and db.actor:alive() then
	db.actor:set_actor_position( vector():set(pos.x, pos.y-1, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
end
end

function pri_detsad_director_door_trigger_use()
	level.show_indicators()
	db.actor:set_actor_position(patrol("pri_detsad_director_door_trigger_point"):point(0))
end


function pri_avtostation_mob_spawn()
 local sim = alife()
 local sobj = alife():create("pri_avtostation_mob", vector():set (607.67,-51.98,-316.83), 218107, 1881)
 sim:assign_story_id(sobj.id, story_ids.pri_avtostation_mob)
end


function pri_detsad_secret_door_trigger_use1()
	level.show_indicators()
	db.actor:set_actor_position(patrol("pri_detsad_secret_door_trigger_point1"):point(0))
end

function pri_detsad_secret_door_trigger_use2()
	level.show_indicators()
	db.actor:set_actor_position(patrol("pri_detsad_secret_door_trigger_point2"):point(0))
end


function remove_with_shield(actor,npc,p)	--	Для босса-кровососа в Припяти;
local pos = npc:position()
local sobj = alife():object( npc:id() )
if sobj then
	--local fx_particle = particles_object("monsters\\group\\pseudo_phantom_birth_dist")
	local fx_particle = particles_object("anomaly2\\burer_wave")
	fx_particle:play_at_pos(pos)
	local snd = xr_sound.get_safe_sound_object("anomaly\\gravity_entrance")
	snd:play_at_pos(db.actor, pos, 0, sound_object.s3d)
	alife():release(sobj,true)
end
end


function pri_avtostaion_mob_respawn()
if db.actor:dont_has_info("pri_avtostation_mob_dead") and not alife():story_object(8904) then -- удалено из-за бага двойного назначения сида
	local sim = alife()
	local pos = db.actor:position()
	local n = math.random(-2,2)
	local sobj = alife():create("avtostation_mob", vector():set(pos.x+n, pos.y, pos.z-n), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	sim:assign_story_id(sobj.id, story_ids.pri_avtostation_mob)
end
end


function pri_avtostation_mob_spawn_in()
local obj = level_object_by_sid(8904)
-- local pos = obj:position()
amk.spawn_item_in_inv("bloodsucker_nail", obj) --alife():create("bloodsucker_nail", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
end


function set_half_health(actor,npc)
local npc_hlth = npc.health
	npc_hlth = 0.5
end

function pri_abdul_init_dialod()
	local npc = level_object_by_sid(8886)
	db.actor:run_talk_dialog(npc)
end



function pri_detsad_help_think1()
	local st = get_hud():GetCustomStatic("pri_detsad_help_think1") or get_hud():AddCustomStatic("pri_detsad_help_think1",true)
	st.m_endTime = time_global()/1000 + 8
end

function pri_detsad_help_think2()
	local st = get_hud():GetCustomStatic("pri_detsad_help_think2") or get_hud():AddCustomStatic("pri_detsad_help_think2",true)
	st.m_endTime = time_global()/1000 + 8
end

function pri_detsad_help_think3()
	local st = get_hud():GetCustomStatic("pri_detsad_help_think3") or get_hud():AddCustomStatic("pri_detsad_help_think3",true)
	st.m_endTime = time_global()/1000 + 8
end


function pri_detsad_secret_door2trigger_use1()
	level.show_indicators()
	db.actor:set_actor_position(patrol("pri_detsad_secret_door2trigger_point1"):point(0))
end

function pri_detsad_secret_door2trigger_use2()
	level.show_indicators()
	db.actor:set_actor_position(patrol("pri_detsad_secret_door2trigger_point2"):point(0))
end


function pri_detsad_secret_door3trigger_use1()
	level.show_indicators()
	db.actor:set_actor_position(patrol("pri_detsad_secret_door3trigger_point1"):point(0))
end

function pri_detsad_secret_door3trigger_use2()
	level.show_indicators()
	db.actor:set_actor_position(patrol("pri_detsad_secret_door3trigger_point2"):point(0))
end


function pri_detsad_wonderdoll_secret_port_snd()
if db.actor:object("wonder_doll") ~= nil then
	xr_effects.give_dolltip2()
	soundtrack.pri_detsad_wonderdoll_secret_port_snd()
end
end


function pri_detsad_secret_room3info()
	if db.actor:dont_has_info("pri_detsad_secret_room3_info") then
		db.actor:give_info_portion ("pri_detsad_secret_room3_info")
	end
end


function pri_anomal_phone_use()
addon_devices.pri_anomal_phone_use()
end

function pri_sold_monument_table_use()
addon_devices.pri_sold_monument_table()
	if db.actor:dont_has_info("pri_monument_spawn") then
		db.actor:give_info_portion ("pri_monument_spawn")
	end
end


function spawn_pri_ball1()
addon.script_spawn("pri_ball1", "l11_pripyat", vector():set(-50.90,-0.60,-3.09) )
end

function spawn_pri_ball2()
addon.script_spawn("pri_ball2", "l11_pripyat", vector():set(-41.98,-0.60,-5.18) )
end

function spawn_pri_ball3()
addon.script_spawn("pri_ball3", "l11_pripyat", vector():set(-26.13,-2.49,-6.03) )
end

function spawn_pri_ball4()
addon.script_spawn("pri_ball4", "l11_pripyat", vector():set(-10.96,-2.30,-0.18) )
end

function spawn_pri_ball5()
addon.script_spawn("pri_ball5", "l11_pripyat", vector():set(-4.38,-2.33,11.92) )
end

function spawn_pri_ball6()
addon.script_spawn("pri_ball6", "l11_pripyat", vector():set(4.94,-2.23,13.60) )
end

function pri_sold_tomb_think()
	local st = get_hud():GetCustomStatic("pri_sold_tomb_think") or get_hud():AddCustomStatic("pri_sold_tomb_think",true)
	st.m_endTime = time_global()/1000 + 8
end



function pri_agents_meet_task_think()
	local st = get_hud():GetCustomStatic("pri_agents_meet_task_think") or get_hud():AddCustomStatic("pri_agents_meet_task_think",true)
	st.m_endTime = time_global()/1000 + 8
end

function pri_hall_agents_teleport()
	db.actor:set_actor_position(patrol("pri_hall_agents_tribe_point"):point(0))
	local dir = patrol("pri_agents_hall_look"):point(0)
	db.actor:set_actor_direction(-dir:getH())
end

function pri_anomal_ball_use()
	local sim = alife()
	local sobj = sim:create("pri_anomal_ball", vector(),0,0,0)
	sim:assign_story_id(sobj.id, story_ids.pri_anomal_ball)
		if db.actor:object("wonder_doll") ~= nil then
			xr_effects.give_dolltip2()
			soundtrack.wonderdoll_anomal_ball_replik()
		end
end


function pri_timecapsula_not_finded_think()
	local st = get_hud():GetCustomStatic("pri_timecapsula_not_finded_think") or get_hud():AddCustomStatic("pri_timecapsula_not_finded_think",true)
	st.m_endTime = time_global()/1000 + 2
end

function pri_stadion_timecapsula_zone_action()
if ( db.actor:dont_has_info("pri_timecapsula_zone1_info") and db.actor:dont_has_info("pri_timecapsula_zone2_info") and db.actor:dont_has_info("pri_timecapsula_zone3_info") and db.actor:dont_has_info("pri_timecapsula_zone4_info") ) then
	db.actor:give_info_portion ("pri_timecapsula_zone1_info")
	pri_timecapsula_not_finded_think()
elseif ( has_alife_info("pri_timecapsula_zone1_info") and db.actor:dont_has_info("pri_timecapsula_zone2_info") ) then
	db.actor:give_info_portion ("pri_timecapsula_zone2_info")
	pri_timecapsula_not_finded_think()
elseif ( has_alife_info("pri_timecapsula_zone1_info") and has_alife_info("pri_timecapsula_zone2_info") and db.actor:dont_has_info("pri_timecapsula_zone3_info") ) then
	db.actor:give_info_portion ("pri_timecapsula_zone3_info")
	pri_timecapsula_not_finded_think()
elseif ( has_alife_info("pri_timecapsula_zone1_info") and has_alife_info("pri_timecapsula_zone2_info") and has_alife_info("pri_timecapsula_zone3_info") and db.actor:dont_has_info("pri_timecapsula_zone4_info") ) then
	db.actor:give_info_portion ("pri_timecapsula_zone4_info")
end
end

function spawn_pri_timecapsula()
alife():create('pri_timecapsula', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	local st = get_hud():GetCustomStatic("pri_timecapsula_finded_think") or get_hud():AddCustomStatic("pri_timecapsula_finded_think",true)
	st.m_endTime = time_global()/1000 + 6
end


function actor_teleport_to_pri_hotel_roofzone()
	db.actor:set_actor_position(patrol("pri_hotel_roof_point1"):point(0))
end


function pri_actors_mind_dead()
	if db.actor:dont_has_info("pri_actors_mind_dead") then
		db.actor:give_info_portion ("pri_actors_mind_dead")
	end
end


function actor_teleport_after_rooftop()
	level.add_pp_effector("deadcity_wake.ppe", 2007, false)
	db.actor:set_actor_position(patrol("pri_agents_base_pray_point2"):point(0))
end


function pri_heli_hunt_dollhelp_tip()
	if db.actor:object("wonder_doll") ~= nil then
		news_manager.send_tip(db.actor, "doll_help_tip31", nil, "doll", 12000, nil)
		xr_effects.give_dolltip2()
		soundtrack.wonderdoll_sucess_tip86()
	end
end

function pri_no_abdul_think()
	local st = get_hud():GetCustomStatic("pri_no_abdul_think") or get_hud():AddCustomStatic("pri_no_abdul_think",true)
	st.m_endTime = time_global()/1000 + 9
end


function pri_rooftop_ghosts1wave_spawn()
	pri_rooftop_ghosts1spawn()
	pri_rooftop_ghosts2spawn()
	pri_rooftop_ghosts3spawn()
end

function pri_rooftop_ghosts2wave_spawn()
	pri_rooftop_ghosts4spawn()
	pri_rooftop_ghosts5spawn()
	pri_rooftop_ghosts6spawn()
end

function pri_rooftop_ghosts3wave_spawn()
	pri_rooftop_ghosts7spawn()
	pri_rooftop_ghosts8spawn()
	pri_rooftop_ghosts9spawn()
	pri_rooftop_ghosts10spawn()
end


function pri_rooftop_ghosts1spawn()
 local sim = alife()
 local sobj = alife():create("pri_rooftop_ghost1", vector():set (109.10,24.25,113.36), 220272, 2180)
 sim:assign_story_id(sobj.id, story_ids.pri_rooftop_ghost1)
end

function pri_rooftop_ghosts2spawn()
 local sim = alife()
 local sobj = alife():create("pri_rooftop_ghost2", vector():set (109.10,24.25,113.36), 220272, 2180)
 sim:assign_story_id(sobj.id, story_ids.pri_rooftop_ghost2)
end

function pri_rooftop_ghosts3spawn()
 local sim = alife()
 local sobj = alife():create("pri_rooftop_ghost3", vector():set (109.10,24.25,113.36), 220272, 2180)
 sim:assign_story_id(sobj.id, story_ids.pri_rooftop_ghost3)
end

function pri_rooftop_ghosts4spawn()
 local sim = alife()
 local sobj = alife():create("pri_rooftop_ghost4", vector():set (109.10,24.25,113.36), 220272, 2180)
 sim:assign_story_id(sobj.id, story_ids.pri_rooftop_ghost4)
end

function pri_rooftop_ghosts5spawn()
 local sim = alife()
 local sobj = alife():create("pri_rooftop_ghost5", vector():set (109.10,24.25,113.36), 220272, 2180)
 sim:assign_story_id(sobj.id, story_ids.pri_rooftop_ghost5)
end

function pri_rooftop_ghosts6spawn()
 local sim = alife()
 local sobj = alife():create("pri_rooftop_ghost6", vector():set (109.10,24.25,113.36), 220272, 2180)
 sim:assign_story_id(sobj.id, story_ids.pri_rooftop_ghost6)
end

function pri_rooftop_ghosts7spawn()
 local sim = alife()
 local sobj = alife():create("pri_rooftop_ghost7", vector():set (109.10,24.25,113.36), 220272, 2180)
 sim:assign_story_id(sobj.id, story_ids.pri_rooftop_ghost7)
end

function pri_rooftop_ghosts8spawn()
 local sim = alife()
 local sobj = alife():create("pri_rooftop_ghost8", vector():set (109.10,24.25,113.36), 220272, 2180)
 sim:assign_story_id(sobj.id, story_ids.pri_rooftop_ghost8)
end

function pri_rooftop_ghosts9spawn()
 local sim = alife()
 local sobj = alife():create("pri_rooftop_ghost9", vector():set (109.10,24.25,113.36), 220272, 2180)
 sim:assign_story_id(sobj.id, story_ids.pri_rooftop_ghost9)
end

function pri_rooftop_ghosts10spawn()
 local sim = alife()
 local sobj = alife():create("pri_rooftop_ghost10", vector():set (109.10,24.25,113.36), 220272, 2180)
 sim:assign_story_id(sobj.id, story_ids.pri_rooftop_ghost10)
end




function pri_rooftop_battle_doll_tip()
	if db.actor:object("wonder_doll") ~= nil then
		news_manager.send_tip(db.actor, "doll_help_tip32", nil, "doll", 12000, nil)
		xr_effects.give_dolltip2()
		soundtrack.wonderdoll_sucess_tip15()
	end
end


function actor_aes_radiation_hit()
   local scientvisuals =
   {
      ["scientific_outfit"] = true,
      ["ecolog_outfit"] = true
   }
if db.actor:alive() then
local suit = db.actor:item_in_slot(6)
local hit = hit()
hit.direction = vector():set(0, 0, 0)
hit.impulse = 0
hit.draftsman = db.actor
hit.power = 0.03
hit.type = hit.radiation
	if suit ~= nil and scientvisuals[db.actor:item_in_slot(6):section()] and suit:condition() > 0.6 then	--	костюм одет и он исправен(нет хита);
		soundtrack.geiger()
		db.actor.radiation = 0.0005
		--level.add_pp_effector("bast.ppe", 2015, false)
	elseif suit ~= nil and scientvisuals[db.actor:item_in_slot(6):section()] and suit:condition() < 0.6 then	--	костюм одет, но неисправен, даём хит и статик;
		db.actor:hit(hit)
		db.actor.radiation = 0.3
		soundtrack.geiger()
		level.add_pp_effector("radiation.ppe", 2015, false)
		aes_suit_damaged_think()
	elseif suit == nil then				-- 	нет костюма вообще;
		db.actor:hit(hit)
		db.actor.radiation = 0.3
		soundtrack.geiger()
		level.add_pp_effector("radiation.ppe", 2015, false)
	elseif suit ~= nil then				--	костюм есть, но не научный;
		db.actor:hit(hit)
		db.actor.radiation = 0.3
		soundtrack.geiger()
		level.add_pp_effector("radiation.ppe", 2015, false)
	end
end
end

function aes_suit_damaged_think()
	local st = get_hud():GetCustomStatic("aes_suit_damaged_think") or get_hud():AddCustomStatic("aes_suit_damaged_think",true)
	st.m_endTime = time_global()/1000 + 1
end


function aes_vagon_door_use()
	db.actor:set_actor_position(patrol("aes_vagon_door_point"):point(0))
end


function spawn_aes_radwinds()

end


function aes_radwind_effect()
	local outfit = db.actor:item_in_slot(6)
	local h = hit()
	h.power = 0.9
	h.direction = vector():set (0, 0, 0)
	h.impulse = 0
	h.draftsman = db.actor
	h.type = hit.wound
	if outfit ~= nil and outfit:condition() >=0.30 then
		outfit:hit(h)
	elseif outfit == nil then 
		return false
	end
end


function actor_rad_up()
	db.actor.radiation = 0.5
end

function start_aes_tube_timer()
	start_real_timer(30, "timer_actions.aes_tube_timer1action")
end


function aes_radstorm()
	local outfit = db.actor:item_in_slot(6)
	local h = hit()
	h.power = 0.15
	h.direction = vector():set (0, 0, 0)
	h.impulse = 0
	h.draftsman = db.actor
	h.type = hit.wound
	if db.actor:object("aes_kristall") == nil then
		if outfit ~= nil and outfit:condition() >=0.10 then
			outfit:hit(h)
		elseif outfit == nil then 
		end
		db.actor.radiation = 0.3
		soundtrack.geiger()
		level.add_pp_effector("bast.ppe", 2015, false)
	end
end

function mark_aes_altar()
   local obj = alife():story_object(8933)
   local obj_id = obj.id
   if obj_id then
   text = "Алтарь"
	level.map_add_object_spot_ser(obj_id,"green_location",text)
   end
  end


function aes_storm_dollhelp()
	if db.actor:object("wonder_doll") ~= nil then
		news_manager.send_tip(db.actor, "doll_help_tip33", nil, "doll", 10000, nil)
		xr_effects.give_dolltip2()
		soundtrack.wonderdoll_sucess_tip21()
	end
end


function play_aes_radstorm_particle()
--local pos = db.actor:position()
--local fx_particle = particles_object("nature\\fog_stormy_03")
--fx_particle:play_at_pos(pos)
end


function set_aes_radstorm_weather1()	-- Шторм;
level.set_weather("surge",true)
end

function set_aes_radstorm_weather2()	-- Затишье;
level.set_weather("default",true)
end

function aes_pagan_altar_obj_use()	--	затишье;
level.set_weather("default",true)
end


function general_scientist_dialog_start()
local npc = level_object_by_sid(8939)
	if not db.actor:is_talking() then
		db.actor:run_talk_dialog(npc)
	end
end

function mon_general_komp_use()
addon_devices.mon_general_komp_interface()
end


function goldsphere_destroyed_think()
	local st = get_hud():GetCustomStatic("goldsphere_destroyed_think") or get_hud():AddCustomStatic("goldsphere_destroyed_think",true)
	st.m_endTime = time_global()/1000 + 1
end



function game_over1(actor, npc)	--	прикоснулись к Шару;
	game.start_tutorial("goldsphere_end1")
end

function game_over2(actor, npc)	--	уничтожили Шар и свалили;
	game.start_tutorial("goldsphere_end2")
end


function teleport_faint_npc1to_actor()
if has_alife_info("faint_man1_companion") then
	if db.actor:dont_has_info("faint_npc1_dead") then
		if db.actor:dont_has_info("faint_man1_rest") then
			if db.actor:dont_has_info("faint_man1_goodbye") then
				local sobj = alife():story_object(8666)
				alife_teleport_object("_", db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), sobj.id)
			end
		end
	end
end
end


function current_level_nightmobs_spawn()
	local level_name = level.name()
		if level_name == "l01_escape" then
			spawn_nightmobs()
			if has_alife_info("esc_lost_man_pda_done") then 
				delete_esc_novice_scelet()
			end
		end
		if level_name == "l02_garbage" then
			spawn_nightmobs()
		end
		if level_name == "l03_agroprom" then
			spawn_nightmobs()
		end
		if level_name == "l04_darkvalley" then
			spawn_nightmobs()
		end
		if level_name == "l07_military" then
			spawn_nightmobs()
		end
		if level_name == "l08_yantar" then
			
		end
		if level_name == "l10_radar" then
			
		end
		if level_name == "predbannik" then
			spawn_nightmobs()
		end
		if level_name == "l11_pripyat" then
			
		end
end

function spawn_nightmobs()
local pos = db.actor:position()
local n = math.random(-10,10)
rnd = math.random(1, 5)
if rnd == 1 then 
	alife():create("night_mob1", vector():set(pos.x+n, pos.y, pos.z-n), db.actor:level_vertex_id(), db.actor:game_vertex_id())
end
if rnd == 2 then 
	alife():create("night_mob2", vector():set(pos.x+n, pos.y, pos.z-n), db.actor:level_vertex_id(), db.actor:game_vertex_id())
end
if rnd == 3 then 
	alife():create("night_mob3", vector():set(pos.x+n, pos.y, pos.z-n), db.actor:level_vertex_id(), db.actor:game_vertex_id())
end
if rnd == 4 then 
	alife():create("night_mob4", vector():set(pos.x+n, pos.y, pos.z-n), db.actor:level_vertex_id(), db.actor:game_vertex_id())
end
if rnd == 5 then 
	alife():create("night_mob5", vector():set(pos.x+n, pos.y, pos.z-n), db.actor:level_vertex_id(), db.actor:game_vertex_id())
end

end


function night_mob1delete()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("^night_mob1") then
	sim:release(sobj,true)
	return
	end
end
end

function night_mob2delete()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("^night_mob2") then
	sim:release(sobj,true)
	return
	end
end
end

function night_mob3delete()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("^night_mob3") then
	sim:release(sobj,true)
	return
	end
end
end

function night_mob4delete()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("^night_mob4") then
	sim:release(sobj,true)
	return
	end
end
end

function night_mob5delete()
local sim = alife()
for i=1,65534 do
local sobj = sim:object(i)
	if sobj and sobj:name():find("^night_mob5") then
	sim:release(sobj,true)
	return
	end
end
end


function wonderdoll_nightzones_help()
	if db.actor:object("wonder_doll") ~= nil then
		soundtrack.wonderdoll_nightzones_snd()
	end
end


function delete_esc_novice_scelet()
local obj = alife():story_object(8537)
  if obj and obj ~= nil then
   alife():release(obj , true)
  end
end 



function deadmask_diary_info_action()
if ( db.actor:dont_has_info("deadmask_diary1_info") and db.actor:dont_has_info("deadmask_diary2_info") and db.actor:dont_has_info("deadmask_diary3_info") and db.actor:dont_has_info("deadmask_diary4_info") ) then
	db.actor:give_info_portion ("deadmask_diary1_info")
elseif ( has_alife_info("deadmask_diary1_info") and db.actor:dont_has_info("deadmask_diary2_info") ) then
	db.actor:give_info_portion ("deadmask_diary2_info")
elseif ( has_alife_info("deadmask_diary1_info") and has_alife_info("deadmask_diary2_info") and db.actor:dont_has_info("deadmask_diary3_info") ) then
	db.actor:give_info_portion ("deadmask_diary3_info")
elseif ( has_alife_info("deadmask_diary1_info") and has_alife_info("deadmask_diary2_info") and has_alife_info("deadmask_diary3_info") and db.actor:dont_has_info("deadmask_diary4_info") ) then
	db.actor:give_info_portion ("deadmask_diary4_info")
end
end






function predb_fabrik_barrel_hit()
--local hit = hit()
--hit.direction = vector():set(0, 0, 0)
--hit.impulse = 0
--hit.draftsman = db.actor
--hit.power = 0.03
--hit.type = hit.radiation
--db.actor:hit(hit)
db.actor.radiation = 1.0
level.add_cam_effector("camera_effects\\fusker.anm", 999, false, "")
soundtrack.sick_4()

end



function start_predb_hermit_timer()
	start_real_timer(5*60, "timer_actions.predb_hermit_timer_action")
end


function kontrab4dialog_start()
local npc = level_object_by_sid(8623)
	if not db.actor:is_talking() then
		db.actor:run_talk_dialog(npc)
	end
end


function predb_hutor_well_use1()

end

function predb_hutor_well_use2()

end




function predb_hermit_spawn_in()
local obj = level_object_by_sid(8652)
-- local pos = obj:position()
amk.spawn_item_in_inv("af_capsula_1", obj)-- alife():create("af_capsula_1", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
end

function predb_kontrabander4spawn_in()
local obj = level_object_by_sid(8623)
amk.spawn_item_in_inv("victims_outfit", obj)
for i=1,30 do
amk.spawn_item_in_inv("ammo_arbolt", obj)
end
--[[
local pos = obj:position()
alife():create("victims_outfit", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
alife():create("ammo_arbolt", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
]]
end



function predb_fabrik_garage_door_trigger1use()
	db.actor:set_actor_position(patrol("predb_fabrik_garage_door_trigger_point1"):point(0))
end

function predb_fabrik_garage_door_trigger2use()
	db.actor:set_actor_position(patrol("predb_fabrik_garage_door_trigger_point2"):point(0))
end




function spawn_predb_village_trap_obj2()
start_real_timer(2, "timer_actions.predb_village_trap_timer_action1")
end

function spawn_predb_village_trap_obj22()
 local sim = alife()
 local sobj = alife():create("predb_village_trap_obj2", vector():set (17.99,13.99,25.41), 971502, 2922)
 sim:assign_story_id(sobj.id, story_ids.predb_village_trap_obj)
end


function spawn_predb_village_trap_obj3()
start_real_timer(2, "timer_actions.predb_village_trap_timer_action2")
end

function spawn_predb_village_trap_obj33()
 local sim = alife()
 local sobj = alife():create("predb_village_trap_obj3", vector():set (23.70,2.70,8.31), 980218, 2917)
 sim:assign_story_id(sobj.id, story_ids.predb_village_trap_obj)
end


function spawn_predb_village_trap_obj4()
start_real_timer(2, "timer_actions.predb_village_trap_timer_action3")
end

function spawn_predb_village_trap_obj44()
 local sim = alife()
 local sobj = alife():create("predb_village_trap_obj4", vector():set (31.51,10.20,-33.33), 992685, 2925)
 sim:assign_story_id(sobj.id, story_ids.predb_village_trap_obj)
end


function predb_village_trap_action()
soundtrack.predb_village_trap_snd1()
level.disable_input()
addon.actor_disable_inventory()
level.add_pp_effector("deadcity_wake.ppe", 2007, false)
start_real_timer(5, "timer_actions.predb_village_trap_action_timer_action")
end

function predb_village_trap_action2()
soundtrack.predb_village_trap_snd3()
level.disable_input()
addon.actor_disable_inventory()
level.add_pp_effector("deadcity_wake.ppe", 2007, false)
start_real_timer(5, "timer_actions.predb_village_trap_action_timer_action")
end


function sawn_predb_village_magazine_art()
addon.script_spawn("af_drink", "predbannik", vector():set(-40.90,3.60,-11.87) )
end


function predb_village_polter_alarm_think()
	local st = get_hud():GetCustomStatic("predb_village_polter_alarm_think") or get_hud():AddCustomStatic("predb_village_polter_alarm_think",true)
	st.m_endTime = time_global()/1000 + 5
end

function predb_village_polter_kill_think()
	local st = get_hud():GetCustomStatic("predb_village_polter_kill_think") or get_hud():AddCustomStatic("predb_village_polter_kill_think",true)
	st.m_endTime = time_global()/1000 + 5
end

function polter_voice_alarm_snd()
soundtrack.polter_voice_alarm()
end

function polter_voice_kill_snd()
soundtrack.polter_voice_kill()
end

function predb_rogue_npc_init_dialog1()
local npc = level_object_by_sid(8945)
	if npc and npc ~= nil and not db.actor:is_talking() then
		db.actor:run_talk_dialog(npc)
	end
end

function predb_rogue_npc_init_dialog2()
local npc = level_object_by_sid(8952)
	if npc and npc ~= nil and not db.actor:is_talking() then
		db.actor:run_talk_dialog(npc)
	end
end

function predb_rogue_npc_init_dialog3()
local npc = level_object_by_sid(8953)
	if npc and npc ~= nil and not db.actor:is_talking() then
		db.actor:run_talk_dialog(npc)
	end
end



function spawn_predb_village_fireart()
addon.script_spawn("af_homefire", "predbannik", vector():set(4.58,9.19,-66.76) )
end

function predb_village_first_entry_dolltip()
	if db.actor:object("wonder_doll") ~= nil then
		news_manager.send_tip(db.actor, "predb_village_first_entry_doll_tip", nil, "doll", 8000, nil)
		xr_effects.give_dolltip2()
		soundtrack.doll_secret_call()
	end
end


function spawn_predb_base_guard_turret()
	turret_spawn.predb_base_guard_turret_spawn()
end

function spawn_predb_base_guard_turret2()
	turret_spawn.predb_base_guard_turret_spawn2()
end

function predb_firest_stairs_port_snd()
if db.actor:object("wonder_doll") ~= nil then
	xr_effects.give_dolltip2()
end
end

function predb_firest_undegr_door_think()
	local st = get_hud():GetCustomStatic("predb_firest_undegr_door_think") or get_hud():AddCustomStatic("predb_firest_undegr_door_think",true)
	st.m_endTime = time_global()/1000 + 8
end

function predb_marouder_mobs_spawn()
addon.script_spawn("predb_marouder_mob1", "predbannik", vector():set(-460.05,7.65,-76.21) )
addon.script_spawn("predb_marouder_mob1", "predbannik", vector():set(-460.05,7.65,-76.21) )
addon.script_spawn("predb_marouder_mob2", "predbannik", vector():set(-460.05,7.65,-76.21) )
addon.script_spawn("predb_marouder_mob2", "predbannik", vector():set(-460.05,7.65,-76.21) )
addon.script_spawn("predb_marouder_mob2", "predbannik", vector():set(-460.05,7.65,-76.21) )
end

function spawn_predb_firest_rust_anomaly()
addon.script_spawn("firest_rust_anomaly", "predbannik", vector():set(-440.42,-5.74,-143.60) )
end

function actor_teleport_at_predb_vishka()
	db.actor:set_actor_position(patrol("predb_vishka_top_point"):point(0))
	level.add_pp_effector("teleport.ppe", 2007, false)
	soundtrack.lift_up()
end

function predb_firest_vishka_dollhelp()
	if db.actor:object("wonder_doll") ~= nil then
		news_manager.send_tip(db.actor, "predb_firest_vishka_doll_tip", nil, "doll", 9000, nil)
		xr_effects.give_dolltip2()
		soundtrack.wonderdoll_sucess_tip41()
	end
end


function spawn_predb_firest_teleport2()
addon.script_spawn("predb_firest_teleport2", "predbannik", vector():set(-498.40,12.01,-193.95) )
end


function predb_firest_vishka_radio_use_think()
	local st = get_hud():GetCustomStatic("predb_firest_vishka_radio_use_think") or get_hud():AddCustomStatic("predb_firest_vishka_radio_use_think",true)
	st.m_endTime = time_global()/1000 + 5
end

function predb_marouders_unmake_invulnerable()
local npc1 = level_object_by_sid(8957)
if npc1:alive() then
   npc1:invulnerable(false)
end
local npc2 = level_object_by_sid(8958)
if npc2:alive() then
   npc2:invulnerable(false)
end
local npc3 = level_object_by_sid(8959)
if npc3:alive() then
   npc3:invulnerable(false)
end
end

function predb_firest_rust_anomaly_hit()
	local item_s6 = db.actor:item_in_slot(6)
	if item_s6 ~= nil then
	cond6 = item_s6:condition()
		if cond6 > 0.10 then
			item_s6:set_condition(cond6-0.1)
		end
	end
	local item_s2 = db.actor:item_in_slot(2)
	if item_s2 ~= nil then
	cond2 = item_s2:condition()
		if cond2 > 0.10 then
			item_s2:set_condition(cond2-0.1)
		end
	end
	local item_s3 = db.actor:item_in_slot(3)
	if item_s3 ~= nil then
	cond3 = item_s3:condition()
		if cond3 > 0.10 then
			item_s3:set_condition(cond3-0.1)
		end
	end
end

function predb_heli_crash_use_think()
	local st = get_hud():GetCustomStatic("predb_heli_crash_use_think") or get_hud():AddCustomStatic("predb_heli_crash_use_think",true)
	st.m_endTime = time_global()/1000 + 7
end


function predb_base_body_spawns(actor, npc, p)
local sobj = alife():object(npc:id())
local pos = npc:position()
if sobj then
alife():create("scelet_bone1", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone2", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone2", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone3", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone3", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("scelet_bone4", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
alife():create("predb_base_key1", vector():set(pos.x, pos.y+1, pos.z), npc:level_vertex_id(), npc:game_vertex_id())
end
end


function predb_base_chimera_spawn()
 local sim = alife()
 local sobj = alife():create("predb_base_chimera", vector():set (-207.19,28.60,-96.16), 897661, 2910)
 sim:assign_story_id(sobj.id, story_ids.predb_base_chimera)
end

function predb_base_generator_use_think()
	local st = get_hud():GetCustomStatic("predb_base_generator_use_think") or get_hud():AddCustomStatic("predb_base_generator_use_think",true)
	st.m_endTime = time_global()/1000 + 7
end

function predb_base_comp_use()
addon_devices.predb_base_comp_interface()
end

function predb_firest_arsenal_door_think()
	local st = get_hud():GetCustomStatic("predb_firest_arsenal_door_think") or get_hud():AddCustomStatic("predb_firest_arsenal_door_think",true)
	st.m_endTime = time_global()/1000 + 7
end


function predb_firest_stairs_info()
if db.actor:dont_has_info("predb_firest_stairs") then
	db.actor:give_info_portion ("predb_firest_stairs")
end
end

function start_predb_marouder1base_dialog()
local npc = level_object_by_sid(8957)
	if npc and npc ~= nil and not db.actor:is_talking() then
		db.actor:run_talk_dialog(npc)
	end
end


function predb_heli_dollhelp()
start_real_timer(5, "timer_actions.predb_heli_dollhelp_timer_action")
end


function predb_courier_ambush1()
addon.script_spawn("predb_courier_mob1", "predbannik", vector():set(-353.58,-5.38,327.39) )
addon.script_spawn("predb_courier_mob1", "predbannik", vector():set(-353.58,-5.38,327.39) )
addon.script_spawn("predb_courier_mob1", "predbannik", vector():set(-353.58,-5.38,327.39) )
addon.script_spawn("predb_courier_mob2", "predbannik", vector():set(-353.58,-5.38,327.39) )
--addon.script_spawn("predb_courier_mob2", "predbannik", vector():set(-353.58,-5.38,327.39) )
end


function predb_courier_ambush2()
addon.script_spawn("predb_courier_mob3", "predbannik", vector():set(-334.35,34.44,222.03) )
addon.script_spawn("predb_courier_mob3", "predbannik", vector():set(-334.35,34.44,222.03) )
addon.script_spawn("predb_courier_mob4", "predbannik", vector():set(-334.35,34.44,222.03) )
end

function predb_courier_ambush3()
addon.script_spawn("predb_courier_mob5", "predbannik", vector():set(-287.97,0.31,85.14) )
addon.script_spawn("predb_courier_mob5", "predbannik", vector():set(-287.97,0.31,85.14) )
addon.script_spawn("predb_courier_mob5", "predbannik", vector():set(-287.97,0.31,85.14) )
addon.script_spawn("predb_courier_mob5", "predbannik", vector():set(-287.97,0.31,85.14) )
--addon.script_spawn("predb_courier_mob5", "predbannik", vector():set(-287.97,0.31,85.14) )
end

function predb_courier_ambush4()
addon.script_spawn("predb_courier_mob6", "predbannik", vector():set(-420.55,-5.76,-285.58) )
--addon.script_spawn("predb_courier_mob6", "predbannik", vector():set(-420.55,-5.76,-285.58) )
end


function spawn_predb_hutor_weel_ghost()
addon.script_spawn("hutor_weel_ghost", "predbannik", vector():set(-83.36,1.51,349.47) )
end

function anomal_lamp_doll_help()
	if db.actor:object("wonder_doll") ~= nil then
		news_manager.send_tip(db.actor, "anomal_lamp_doll_help_tip", nil, "doll", 8000, nil)
		xr_effects.give_dolltip2()
		soundtrack.wonderdoll_sucess_tip34()
	end
end

function predb_courier1spawn_in()
if db.actor:dont_has_info("predb_courier_on_place") then
	local obj = level_object_by_sid(8625)
	local pos = obj:position()
	alife():create("cargo_exo_outfit", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
	--alife():create("predb_couriers_seif", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
end
end

function spawn_predb_firest_dogs()
addon.script_spawn("predb_firest_dog", "predbannik", vector():set(-475.75,-0.72,-158.96) )
addon.script_spawn("predb_firest_dog", "predbannik", vector():set(-475.75,-0.72,-158.96) )
addon.script_spawn("predb_firest_dog", "predbannik", vector():set(-475.75,-0.72,-158.96) )
addon.script_spawn("predb_firest_dog", "predbannik", vector():set(-475.75,-0.72,-158.96) )
addon.script_spawn("predb_firest_dog", "predbannik", vector():set(-475.75,-0.72,-158.96) )
addon.script_spawn("predb_firest_dog", "predbannik", vector():set(-475.75,-0.72,-158.96) )
addon.script_spawn("predb_firest_dog", "predbannik", vector():set(-475.75,-0.72,-158.96) )
addon.script_spawn("predb_firest_dog", "predbannik", vector():set(-475.75,-0.72,-158.96) )
addon.script_spawn("predb_firest_dog", "predbannik", vector():set(-475.75,-0.72,-158.96) )
addon.script_spawn("predb_firest_dog", "predbannik", vector():set(-475.75,-0.72,-158.96) )
end


function spawn_predb_cat_queen()
	local obj = level_object_by_sid(8963)
	local pos = obj:position()
	alife():create("predb_cat_queen", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id())
	addon.script_spawn("predb_ambush_cat", "predbannik", vector():set(-184.67,3.43,124.77) )
	addon.script_spawn("predb_ambush_cat", "predbannik", vector():set(-184.67,3.43,124.77) )
	addon.script_spawn("predb_ambush_cat", "predbannik", vector():set(-184.67,3.43,124.77) )
	addon.script_spawn("predb_ambush_cat", "predbannik", vector():set(-184.67,3.43,124.77) )
	addon.script_spawn("predb_ambush_cat", "predbannik", vector():set(-184.67,3.43,124.77) )
	addon.script_spawn("predb_ambush_cat", "predbannik", vector():set(-184.67,3.43,124.77) )
	addon.script_spawn("predb_ambush_cat", "predbannik", vector():set(-184.67,3.43,124.77) )
	--addon.script_spawn("predb_ambush_cat", "predbannik", vector():set(-184.67,3.43,124.77) )
	--addon.script_spawn("predb_ambush_cat", "predbannik", vector():set(-184.67,3.43,124.77) )
	--addon.script_spawn("predb_ambush_cat", "predbannik", vector():set(-184.67,3.43,124.77) )
end



function predb_marod1spawn_in()
	local obj = level_object_by_sid(8967)
	amk.spawn_item_in_inv("predb_marod1_pda", obj)
	amk.spawn_item_in_inv("old_moneta", obj)
	amk.spawn_item_in_inv("maroders_outfit",obj)
end


function predb_megaboar_health_think()
	local st = get_hud():GetCustomStatic("predb_megaboar_health_think") or get_hud():AddCustomStatic("predb_megaboar_health_think",true)
	st.m_endTime = time_global()/1000 + 7
end


function tree_bags_unpack()
local karma = starvation.get_karma()
	if karma>0.4 then	--	повезло;
		rnd = math.random(1, 10)
			if rnd == 1 then 
				amk.spawn_item_in_inv("flyaga_full")
				amk.spawn_item_in_inv("medkit")
				amk.spawn_item_in_inv("af_spiral")
				news_manager.send_tip(db.actor, "tree_bag_items1_tip", nil, "habar", 10000, nil)
				if db.actor:object("wonder_doll") ~= nil then
					soundtrack.wonderdoll_tree_bags_habar1()
				end
			end
			if rnd == 2 then 
				amk.spawn_item_in_inv("bread")
				amk.spawn_item_in_inv("ammo_12x70_buck")
				amk.spawn_item_in_inv("af_coal")
				amk.spawn_item_in_inv("yod")
				news_manager.send_tip(db.actor, "tree_bag_items2_tip", nil, "habar", 10000, nil)
				if db.actor:object("wonder_doll") ~= nil then
					soundtrack.wonderdoll_tree_bags_habar1()
				end
			end
			if rnd == 3 then 
				amk.spawn_item_in_inv("ibuprophen")
				amk.spawn_item_in_inv("af_frog")
				amk.spawn_item_in_inv("syrok")
				amk.spawn_item_in_inv("vodka")
				news_manager.send_tip(db.actor, "tree_bag_items3_tip", nil, "habar", 10000, nil)
				if db.actor:object("wonder_doll") ~= nil then
					soundtrack.wonderdoll_tree_bags_habar1()
				end
			end
			if rnd == 4 then 
				amk.spawn_item_in_inv("medkomplekt")
				amk.spawn_item_in_inv("antirad")
				amk.spawn_item_in_inv("antirad")
				amk.spawn_item_in_inv("dix")
				news_manager.send_tip(db.actor, "tree_bag_items4_tip", nil, "habar", 10000, nil)
				if db.actor:object("wonder_doll") ~= nil then
					soundtrack.wonderdoll_tree_bags_habar1()
				end
			end
			if rnd == 5 then 
				amk.spawn_item_in_inv("mre")
				amk.spawn_item_in_inv("sigarets")
				amk.spawn_item_in_inv("sigarets")
				amk.spawn_item_in_inv("af_steel_nut")
				news_manager.send_tip(db.actor, "tree_bag_items5_tip", nil, "habar", 10000, nil)
				if db.actor:object("wonder_doll") ~= nil then
					soundtrack.wonderdoll_tree_bags_habar1()
				end
			end
			if rnd == 6 then 
				amk.spawn_item_in_inv("kolbasa")
				amk.spawn_item_in_inv("af_glass")
				amk.spawn_item_in_inv("armor_remkit")
				amk.spawn_item_in_inv("flare_1")
				news_manager.send_tip(db.actor, "tree_bag_items6_tip", nil, "habar", 10000, nil)
				if db.actor:object("wonder_doll") ~= nil then
					soundtrack.wonderdoll_tree_bags_habar1()
				end
			end
			if rnd == 7 then 
				amk.spawn_item_in_inv("conserva")
				amk.spawn_item_in_inv("af_cristallic")
				amk.spawn_item_in_inv("matches")
				amk.spawn_item_in_inv("medkit_army")
				news_manager.send_tip(db.actor, "tree_bag_items7_tip", nil, "habar", 10000, nil)
				if db.actor:object("wonder_doll") ~= nil then
					soundtrack.wonderdoll_tree_bags_habar1()
				end
			end
			if rnd == 8 then 
				amk.spawn_item_in_inv("salo")
				amk.spawn_item_in_inv("af_chestnut")
				amk.spawn_item_in_inv("teapot_pack")
				amk.spawn_item_in_inv("ibuprophen")
				news_manager.send_tip(db.actor, "tree_bag_items8_tip", nil, "habar", 10000, nil)
				if db.actor:object("wonder_doll") ~= nil then
					soundtrack.wonderdoll_tree_bags_habar1()
				end
			end
			if rnd == 9 then 
				amk.spawn_item_in_inv("pivo")
				amk.spawn_item_in_inv("af_ballast")
				amk.spawn_item_in_inv("weapon_remkit")
				amk.spawn_item_in_inv("gidroperit")
				news_manager.send_tip(db.actor, "tree_bag_items9_tip", nil, "habar", 10000, nil)
				if db.actor:object("wonder_doll") ~= nil then
					soundtrack.wonderdoll_tree_bags_habar1()
				end
			end
			if rnd == 10 then 
				amk.spawn_item_in_inv("energy_drink")
				amk.spawn_item_in_inv("af_bearing")
				amk.spawn_item_in_inv("ammo_9x18_pmm")
				amk.spawn_item_in_inv("medkit_scientic")
				news_manager.send_tip(db.actor, "tree_bag_items10_tip", nil, "habar", 10000, nil)
				if db.actor:object("wonder_doll") ~= nil then
					soundtrack.wonderdoll_tree_bags_habar1()
				end
			end
	elseif karma<0.4 then	--	не повезло;
			rnd = math.random(1, 2)
			if rnd == 1 then 
				amk.spawn_item_in_inv("mutant_rat_corp")
				news_manager.send_tip(db.actor, "tree_bag_items11_tip", nil, "habar", 10000, nil)
				if db.actor:object("wonder_doll") ~= nil then
					soundtrack.wonderdoll_tree_bags_habar2()
				end
			end	
			if rnd == 2 then 
				news_manager.send_tip(db.actor, "tree_bag_items12_tip", nil, "habar", 10000, nil)
				if db.actor:object("wonder_doll") ~= nil then
					soundtrack.wonderdoll_tree_bags_habar2()
				end
			end	
	end
end

function wonderdoll_tree_bags_see()
soundtrack.doll_secret_call()
end

function predb_kontrabander1spawn_in()
if has_alife_info("predb_kpp_kontrab_atacked") then
	local obj = level_object_by_sid(8620)
	local pos = obj:position()
	alife():create("predb_kontrab_bloknot", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
end
end


function predb_good_izlom_think()
	local st = get_hud():GetCustomStatic("predb_good_izlom_think") or get_hud():AddCustomStatic("predb_good_izlom_think",true)
	st.m_endTime = time_global()/1000 + 3
end

function fallen_star_lost_think()
	local st = get_hud():GetCustomStatic("fallen_star_lost_think") or get_hud():AddCustomStatic("fallen_star_lost_think",true)
	st.m_endTime = time_global()/1000 + 9
end


function spawn_predb_kontrab_ambush()
	addon.script_spawn("predb_kontrab1", "predbannik", vector():set(-49.71,13.72,129.49) )
	addon.script_spawn("predb_kontrab2", "predbannik", vector():set(-49.71,13.72,129.49) )
	addon.script_spawn("predb_kontrab3", "predbannik", vector():set(-49.71,13.72,129.49) )
	addon.script_spawn("predb_kontrab4", "predbannik", vector():set(-49.71,13.72,129.49) )
	addon.script_spawn("predb_kontrab5", "predbannik", vector():set(-49.71,13.72,129.49) )
	addon.script_spawn("predb_kontrab6", "predbannik", vector():set(-49.71,13.72,129.49) )
end

function village_sold_stop_companion()
	local npc = level_object_by_sid(8972)
	if npc and npc:alive() then
		dialogs.companion_stop_following(npc, db.actor)
	end
end




function actor_mil_vsu_zone_blow()
if xr_conditions.actor_in_zone(nil,nil,{"mil_hutor1_alarm_zone"}) then
	actor_on_mine_blow()
end
end


function mil_start_spawn()
	addon.script_spawn("mil_mob1", "l07_military", vector():set(98.62,0.00,302.43) )
	addon.script_spawn("mil_mob2", "l07_military", vector():set(98.62,0.00,302.43) )
	addon.script_spawn("mil_mob3", "l07_military", vector():set(98.62,0.00,302.43) )
	addon.script_spawn("mil_mob4", "l07_military", vector():set(98.62,0.00,302.43) )
	addon.script_spawn("mil_mob5", "l07_military", vector():set(98.62,0.00,302.43) )
	addon.script_spawn("mil_mob6", "l07_military", vector():set(98.62,0.00,302.43) )
	
	addon.script_spawn("mil_mob13", "l07_military", vector():set(-112.84,-19.32,295.42) )
	addon.script_spawn("mil_mob14", "l07_military", vector():set(-112.84,-19.32,295.42) )
	addon.script_spawn("mil_mob15", "l07_military", vector():set(-112.84,-19.32,295.42) )
	
	addon.script_spawn("mil_mob19", "l07_military", vector():set(-27.30,-20.29,375.57) )
	
	addon.script_spawn("mil_guard_dog", "l07_military", vector():set(-371.16,-14.05,396.46) )
end


function mil_mob1respawn()
	addon.script_spawn("mil_mob1", "l07_military", vector():set(98.62,0.00,302.43) )
end

function mil_mob2respawn()
	addon.script_spawn("mil_mob2", "l07_military", vector():set(98.62,0.00,302.43) )
end

function mil_mob3respawn()
	addon.script_spawn("mil_mob3", "l07_military", vector():set(98.62,0.00,302.43) )
end

function mil_mob4respawn()
	addon.script_spawn("mil_mob4", "l07_military", vector():set(98.62,0.00,302.43) )
end

function mil_mob5respawn()
	addon.script_spawn("mil_mob5", "l07_military", vector():set(98.62,0.00,302.43) )
end

function mil_mob6respawn()
	addon.script_spawn("mil_mob6", "l07_military", vector():set(98.62,0.00,302.43) )
end


function mil_mob7respawn()
	addon.script_spawn("mil_mob7", "l07_military", vector():set(-91.25,-20.32,230.33) )
end

function mil_mob8respawn()
	addon.script_spawn("mil_mob8", "l07_military", vector():set(-91.25,-20.32,230.33) )
end

function mil_mob9respawn()
	addon.script_spawn("mil_mob9", "l07_military", vector():set(-91.25,-20.32,230.33) )
end


function mil_mob10respawn()
	addon.script_spawn("mil_mob10", "l07_military", vector():set(107.73,-11.36,231.64) )
end

function mil_mob11respawn()
	addon.script_spawn("mil_mob11", "l07_military", vector():set(107.73,-11.36,231.64) )
end

function mil_mob12respawn()
	addon.script_spawn("mil_mob12", "l07_military", vector():set(107.73,-11.36,231.64) )
end


function mil_mob13respawn()
	addon.script_spawn("mil_mob13", "l07_military", vector():set(-112.84,-19.32,295.42) )
end

function mil_mob14respawn()
	addon.script_spawn("mil_mob14", "l07_military", vector():set(-112.84,-19.32,295.42) )
end

function mil_mob15respawn()
	addon.script_spawn("mil_mob15", "l07_military", vector():set(-112.84,-19.32,295.42) )
end


function mil_mob16respawn()
	addon.script_spawn("mil_mob16", "l07_military", vector():set(-74.45,-19.36,159.11) )
end

function mil_mob17respawn()
	addon.script_spawn("mil_mob17", "l07_military", vector():set(-74.45,-19.36,159.11) )
end

function mil_mob18respawn()
	addon.script_spawn("mil_mob18", "l07_military", vector():set(-74.45,-19.36,159.11) )
end

function mil_mob19respawn()
	addon.script_spawn("mil_mob19", "l07_military", vector():set(-27.30,-20.29,375.57) )
end

function mil_mob20respawn()
	addon.script_spawn("mil_mob20", "l07_military", vector():set(38.43,-12.22,234.16) )
end


function mil_hunter_dog_tip()
if db.actor:dont_has_info("mil_aviatrs_fail") then
	news_manager.send_tip(db.actor, "mil_hunter_dog_tip", nil, "stalker", 5000, nil)
end
end

function mil_aviator1spawn_in()
	local obj = level_object_by_sid(8833)
	-- local pos = obj:position()
	amk.spawn_item_in_inv("af_gravitsappa", obj)-- alife():create("af_gravitsappa", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
end


function mil_swamp_krovosos_obj_use()
	addon.script_spawn("mil_swamp_krovosos", "l07_military", vector():set(105.49,-8.38,166.86) )
end

function spawn_mil_pepelatz()
 local sim = alife()
 local sobj = sim:create("mil_pepelatz", vector():set (-162.76,25.00,240.49), 157853, 1749)
 sim:assign_story_id(sobj.id, story_ids.mil_pepelatz)
 news_manager.send_tip(db.actor, "mil_aviators_goodbye_tip", nil, "stalker", 9000, nil)
end


function mil_sold1init_dialog()
local npc = level_object_by_sid(8787)
	if npc and npc ~= nil and not db.actor:is_talking() then
		db.actor:run_talk_dialog(npc)
	end
end

function set_actor_to_vsu_saray()
	db.actor:set_actor_position(patrol("mil_vsu_saray_point"):point(0))
	db.actor:give_info_portion ("mil_vsu_fail")
	put_items_to_mil_vsu_box()
end


function put_items_to_mil_vsu_box()
--[[local box = level_object_by_sid(8837)
if box then
for i = 0, db.actor:object_count() - 1 do
local obj = db.actor:object(i)
if obj and not (system_ini():line_exist(obj:section(), "quest_item") and system_ini():r_bool(obj:section(), "quest_item")) then db.actor:transfer_item(obj, box) end
end
end]]
transfer_to_box(8837)
end






function rad_agent5spawn_in()
	local obj = level_object_by_sid(8855)
	-- local pos = obj:position()
	amk.spawn_item_in_inv("rad_vagon_door_key", obj) -- alife():create("rad_vagon_door_key", vector():set(pos.x, pos.y, pos.z), obj:level_vertex_id(), obj:game_vertex_id(), obj:id())
end


function garb_vagon_zone_action()
db.actor:give_info_portion ("actor_at_garb_vagon")
--if ( db.actor:dont_has_info("esc_hunter_dead") or db.actor:dont_has_info("helicrash_survival_dead") ) then
if ( has_alife_info("esc_hunter_dead") or has_alife_info("esc_hunter_dead") ) then
	db.actor:give_info_portion ("not_all_garbage_companions_on_place")
else
	db.actor:give_info_portion ("garbage_companions_on_place")
end
end


function spawn_mil_base_zombies()
addon.script_spawn("mil_base_zombie", "l07_military", vector():set(44.29,-8.87,-45.83) )
addon.script_spawn("mil_base_zombie", "l07_military", vector():set(44.29,-8.87,-45.83) )
addon.script_spawn("mil_base_zombie", "l07_military", vector():set(44.29,-8.87,-45.83) )
addon.script_spawn("mil_base_zombie", "l07_military", vector():set(44.29,-8.87,-45.83) )
addon.script_spawn("mil_base_zombie", "l07_military", vector():set(44.29,-8.87,-45.83) )
addon.script_spawn("mil_base_zombie", "l07_military", vector():set(44.29,-8.87,-45.83) )
addon.script_spawn("mil_base_zombie", "l07_military", vector():set(44.29,-8.87,-45.83) )
addon.script_spawn("mil_base_zombie", "l07_military", vector():set(44.29,-8.87,-45.83) )
addon.script_spawn("mil_base_zombie", "l07_military", vector():set(44.29,-8.87,-45.83) )
addon.script_spawn("mil_base_zombie", "l07_military", vector():set(44.29,-8.87,-45.83) )
end



function mil_grav_solds_control()
local zone = level_object_by_sid(8801)
local obj1 = level_object_by_sid(8810)
local obj2 = level_object_by_sid(8811)
local obj3 = level_object_by_sid(8812)
if zone and obj1 and obj2 and obj3 then
if zone:position():distance_to_sqr(obj1:position()) >= 60*60 then
	alife_teleport_object("_", vector():set(-47.56,-5.41,233.58), 261852, 1736, obj1.id)
end
if zone:position():distance_to_sqr(obj2:position()) >= 60*60 then
	alife_teleport_object("_", vector():set(-47.56,-5.41,233.58), 261852, 1736, obj2.id)
end
if zone:position():distance_to_sqr(obj3:position()) >= 60*60 then
	alife_teleport_object("_", vector():set(-47.56,-5.41,233.58), 261852, 1736, obj3.id)
end
end
end



function agr_powerbox_using()
if ( db.actor:dont_has_info("agr_fabrik_power_box_trap1") and db.actor:dont_has_info("agr_fabrik_power_box_trap2") and db.actor:dont_has_info("agr_fabrik_power_box_trap3") ) then
	db.actor:give_info_portion ("agr_fabrik_power_box_trap1")
	agr_fabrik_power_box_trap1()
	agr_fabrik_power_box_think()
elseif ( has_alife_info("agr_fabrik_power_box_trap1") and db.actor:dont_has_info("agr_fabrik_power_box_trap2") ) then
	db.actor:give_info_portion ("agr_fabrik_power_box_trap2")
	agr_fabrik_power_box_trap2()
	agr_fabrik_power_box_think()
elseif ( has_alife_info("agr_fabrik_power_box_trap1") and has_alife_info("agr_fabrik_power_box_trap2") and db.actor:dont_has_info("agr_fabrik_power_box_trap3") ) then
	db.actor:give_info_portion ("agr_fabrik_power_box_trap3")
	agr_fabrik_power_box_trap3()
end
end


function spawn_mil_aviators_mobs()
addon.script_spawn("mil_aviators_mob", "l07_military", vector():set(-305.65,-12.97,388.81) )
addon.script_spawn("mil_aviators_mob", "l07_military", vector():set(-305.65,-12.97,388.81) )
addon.script_spawn("mil_aviators_mob", "l07_military", vector():set(-305.65,-12.97,388.81) )
addon.script_spawn("mil_aviators_mob", "l07_military", vector():set(-305.65,-12.97,388.81) )
addon.script_spawn("mil_aviators_mob", "l07_military", vector():set(-305.65,-12.97,388.81) )
addon.script_spawn("mil_aviators_mob", "l07_military", vector():set(-305.65,-12.97,388.81) )
addon.script_spawn("mil_aviators_mob", "l07_military", vector():set(-305.65,-12.97,388.81) )
addon.script_spawn("mil_aviators_mob", "l07_military", vector():set(-305.65,-12.97,388.81) )
end


--function spawn_garb_minefield_btr()
--addon.script_spawn("garb_minefield_btr", "l02_garbage", vector():set(15.22,0.25,237.59) )
--end

function spawn_garb_minefield_btr()
 local sim = alife()
 local sobj = alife():create("garb_minefield_btr", vector():set (14.65,0.47,237.04), 188026, 359)
 sim:assign_story_id(sobj.id, story_ids.garb_minefield_btr2)
end



function yan_camerer_dialog_start()
if ( db.actor:dont_has_info("yan_camerer_yes") and db.actor:dont_has_info("yan_camerer_end") and db.actor:dont_has_info("yan_camerer_reward") and db.actor:dont_has_info("yan_camerer_no") ) then
	soundtrack.yan_camerer_hello()
	addon_devices.yan_camerer_dialog_start()
elseif ( has_alife_info("yan_camerer_end") and db.actor:dont_has_info("yan_camerer_reward") ) then
	addon_devices.yan_camerer_dialog13()	--	после уничтожения Куклы, до получения награды;
	soundtrack.yan_camerer_hello2()
elseif has_alife_info("yan_camerer_reward") then
	addon_devices.yan_camerer_dialog15()	--	после уничтожения Куклы + награда получена;
	soundtrack.yan_camerer_hello()
end
end


function agr_brownie2gohome()
local obj = alife():story_object(8262)
alife_teleport_object("_", vector():set(-4.08,7.49,16.17), 235990, 488, obj.id)
end


function yan_sold9spawn_in()
	   local obj = level_object_by_sid(8186)
amk.spawn_item_in_inv("mil_shtab_key",obj)
end



